


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Getting Started &mdash; Apache Traffic Server 10.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/override.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Release Notes" href="../release-notes/index.en.html" />
    <link rel="prev" title="Preface" href="../preface/index.en.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Apache Traffic Server
          

          
            
            <img src="../_static/trans_logo_tm_380x69.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../preface/index.en.html">Preface</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-scenario">Example Scenario</a></li>
<li class="toctree-l3"><a class="reference internal" href="#terminology">Terminology</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#installing-from-distribution-packages">Installing From Distribution Packages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ubuntu">Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rhel-centos">RHEL / CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#omnios-illumos">OmniOS (illumos)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#installing-from-source-code">Installing From Source Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-a-reverse-proxy">Configuring A Reverse Proxy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enable-reverse-proxying">Enable Reverse Proxying</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-origin-location">Configure Origin Location</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adjust-cache-parameters">Adjust Cache Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="#final-configurations">Final Configurations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-a-forward-proxy">Configuring A Forward Proxy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enable-forward-proxying">Enable Forward Proxying</a></li>
<li class="toctree-l4"><a class="reference internal" href="#explicit-versus-transparent">Explicit Versus Transparent</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#logging-and-monitoring">Logging and Monitoring</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-log-output">Configuring Log Output</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#further-steps">Further Steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer-guide/index.en.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/index.en.html">Appendices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache Traffic Server</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Getting Started</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/getting-started/index.en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="getting-started">
<span id="id1"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Apache Traffic Server™ provides a high-performance and scalable software solution for both
forward and reverse proxying of HTTP/HTTPS traffic, and may be configured to
run in either or both modes simultaneously. This Getting Started guide explains
the basic steps an administrator new to Traffic Server will need to perform to get the
software up and running in a minimal configuration as quickly as possible.</p>
<div class="section" id="example-scenario">
<h3>Example Scenario<a class="headerlink" href="#example-scenario" title="Permalink to this headline">¶</a></h3>
<p>In this guide, we will use the fictional company Acme Widgets as a basis for the
configuration examples. Acme Widgets has a product brochure website (assumed to reside
at the domain <code class="docutils literal notranslate"><span class="pre">www.acme.com</span></code>) that performs very poorly. The content management
software they chose takes an unbearable amount of time to generate pages on
every request and their engineering team has chosen Traffic Server as a caching proxy
layer to improve site performance.</p>
<p>Separately, Acme Widgets has decided to use Traffic Server to help improve the performance of
their office’s Internet access, which is hobbled by their reliance on an aging
leased line and certain employees’ predilection for extracurricular web
browsing.</p>
</div>
<div class="section" id="terminology">
<h3>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h3>
<p>This guide uses some terms which may be unfamiliar to administrators new to
proxy servers.</p>
<dl class="simple">
<dt>Origin Server</dt><dd><p>The server which generates the content you wish to proxy (and optionally
cache) with Traffic Server. In a forward proxy configuration, the origin server may be
any remote server to which a proxied client attempts to connect. In a
reverse proxy configuration, the origin servers are typically a known set of
servers for which you are using Traffic Server as a performance-enhancing caching
layer.</p>
</dd>
<dt>Reverse Proxy</dt><dd><p>A reverse proxy appears to outside users as if it were the origin server,
though it does not generate the content itself. Instead, it intercepts the
requests and, based on the configured rules and contents of its cache, will
either serve a cached copy of the requested content itself, or forward the
request to the origin server, possibly caching the content returned for use
with future requests.</p>
</dd>
<dt>Forward Proxy</dt><dd><p>A forward proxy brokers access to external resources, intercepting all
matching outbound traffic from a network. Forward proxies may be used to
speed up external access for locations with slow connections (by caching the
external resources and using those cached copies to service requests
directly in the future), or may be used to restrict or monitor external
access.</p>
</dd>
<dt>Transparent Proxy</dt><dd><p>A transparent proxy may be either a reverse or forward proxy (though nearly
all reverse proxies are deployed transparently), the defining feature being
the use of network routing to send requests through the proxy without any
need for clients to configure themselves to do so, and often without the
ability for those clients to bypass the proxy.</p>
</dd>
</dl>
<p>For a more complete list of definitions, please see the <a class="reference internal" href="../appendices/glossary.en.html#glossary"><span class="std std-ref">Glossary</span></a>.</p>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>As with many other software packages, you may have the option of installing
Apache Traffic Server™ from your operating system distribution’s packages, or compiling and
installing from the source code yourself. Distribution packages may lag behind
the current stable release of Traffic Server, sometimes by a significant amount. While
we will cover briefly the packages required for common operating system
distributions, the remainder of this guide will be assuming the latest stable
release of Traffic Server when discussing configuration parameters and available features.</p>
<div class="section" id="installing-from-distribution-packages">
<span id="gs-install-from-package"></span><h3>Installing From Distribution Packages<a class="headerlink" href="#installing-from-distribution-packages" title="Permalink to this headline">¶</a></h3>
<p>It is recommended that you install from source code, as described in the section
below, rather than rely on your distribution’s packages if you wish to have
access to the latest features and fixes in Traffic Server.</p>
<div class="section" id="ubuntu">
<h4>Ubuntu<a class="headerlink" href="#ubuntu" title="Permalink to this headline">¶</a></h4>
<p>The Canonical repositories up through, and including, Utopic Unicorn only
provide Traffic Server v3.2.x.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">trafficserver</span>
</pre></div>
</div>
</div>
<div class="section" id="rhel-centos">
<h4>RHEL / CentOS<a class="headerlink" href="#rhel-centos" title="Permalink to this headline">¶</a></h4>
<p>Traffic Server is available through the EPEL repositories. If you do not have those
configured on your machine yet, you must install them first with the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">dl</span><span class="o">.</span><span class="n">fedoraproject</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">pub</span><span class="o">/</span><span class="n">epel</span><span class="o">/</span><span class="n">epel</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">latest</span><span class="o">-</span><span class="mf">7.</span><span class="n">noarch</span><span class="o">.</span><span class="n">rpm</span>
<span class="n">sudo</span> <span class="n">rpm</span> <span class="o">-</span><span class="n">Uvh</span> <span class="n">epel</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="mi">7</span><span class="o">*.</span><span class="n">rpm</span>
</pre></div>
</div>
<p>Ensuring that you replace the release number with a value that is appropriate
for your system. Once you have EPEL installed, you may install Traffic Server itself.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">yum</span> <span class="n">install</span> <span class="n">trafficserver</span>
</pre></div>
</div>
</div>
<div class="section" id="omnios-illumos">
<h4>OmniOS (illumos)<a class="headerlink" href="#omnios-illumos" title="Permalink to this headline">¶</a></h4>
<p>OmniOS (an illumos-based distribution) provides the Traffic Server package in its public
<em>OmniTI-MS</em> publisher.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pkg</span> <span class="nb">set</span><span class="o">-</span><span class="n">publisher</span> <span class="o">-</span><span class="n">g</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">pkg</span><span class="o">.</span><span class="n">omniti</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">omniti</span><span class="o">-</span><span class="n">ms</span><span class="o">/</span> <span class="n">ms</span><span class="o">.</span><span class="n">omniti</span><span class="o">.</span><span class="n">com</span>
<span class="n">sudo</span> <span class="n">pkg</span> <span class="n">install</span> <span class="n">omniti</span><span class="o">/</span><span class="n">server</span><span class="o">/</span><span class="n">trafficserver</span>
</pre></div>
</div>
<p>The latest release published, at the time of this writing, is Traffic Server v4.2.1.</p>
</div>
</div>
<div class="section" id="installing-from-source-code">
<span id="gs-install-from-source"></span><h3>Installing From Source Code<a class="headerlink" href="#installing-from-source-code" title="Permalink to this headline">¶</a></h3>
<p>To install from source code, you will need to have the following tools and
libraries on the machine used to build Traffic Server:</p>
<ul class="simple">
<li><p>pkgconfig</p></li>
<li><p>libtool</p></li>
<li><p>C++ compiler (gcc &gt;= 4.3 or clang &gt; 3.0)</p></li>
<li><p>GNU make</p></li>
<li><p>OpenSSL or BoringSSL</p></li>
<li><p>pcre</p></li>
<li><p>libcap</p></li>
<li><p>flex (for TPROXY)</p></li>
<li><p>hwloc</p></li>
<li><p>lua</p></li>
<li><p>zlib</p></li>
<li><p>curses (for traffic_top)</p></li>
<li><p>curl (for traffic_top)</p></li>
</ul>
<p>To build Traffic Server from a Git clone (the method we will be using in this guide), you
will also need the following:</p>
<ul class="simple">
<li><p>git</p></li>
<li><p>autoconf</p></li>
<li><p>automake</p></li>
</ul>
<p>In this guide, Traffic Server will be built to use the default <code class="docutils literal notranslate"><span class="pre">nobody</span></code> user and group
and will be installed to <code class="docutils literal notranslate"><span class="pre">/opt/ts</span></code>. It is assumed that all of the dependencies
are located in standard paths. If this is not the case, you may need to use the
appropriate <code class="docutils literal notranslate"><span class="pre">--with-&lt;package&gt;</span></code> options as detailed in the output of
<code class="docutils literal notranslate"><span class="pre">./configure</span> <span class="pre">--help</span></code>.</p>
<ol class="arabic">
<li><p>Clone the repository (you may skip this if you have downloaded an archive of
the source code to build a specific official release of Traffic Server instead of the
HEAD from source control):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">git</span><span class="o">-</span><span class="n">wip</span><span class="o">-</span><span class="n">us</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">repos</span><span class="o">/</span><span class="n">asf</span><span class="o">/</span><span class="n">trafficserver</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
</li>
<li><p>Change to the cloned (or unarchived) directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">trafficserver</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p>If you have cloned the repository from Git, you will need to generate the
<code class="docutils literal notranslate"><span class="pre">configure</span></code> script before proceeding:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">autoreconf</span> <span class="o">-</span><span class="k">if</span>
</pre></div>
</div>
</li>
<li><p>Configure the source tree:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">configure</span> <span class="o">--</span><span class="n">prefix</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">ts</span>
</pre></div>
</div>
</li>
<li><p>Build Traffic Server with the generated Makefiles, and test the results:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
<span class="n">make</span> <span class="n">check</span>
</pre></div>
</div>
</li>
<li><p>Install Traffic Server to the configured location:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</li>
<li><p>Optionally, you may find it prudent to run the regression tests on your newly
installed Traffic Server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">ts</span>
<span class="n">sudo</span> <span class="nb">bin</span><span class="o">/</span><span class="n">traffic_server</span> <span class="o">-</span><span class="n">R</span> <span class="mi">1</span>
</pre></div>
</div>
</li>
</ol>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>We will be tackling two separate configuration scenarios in the following
sections. The first is the most common application of a performance-enhancing
caching proxy for externally-facing websites, a transparent and caching reverse
proxy which forwards all requests presented to it to a single origin address
and caches the responses based on their cache control headers (as well as some
simple heuristics for specific content types when cache control headers are not
present).</p>
<p>The second configuration we will review is a very basic transparent forward
proxy, typically used in situations where you either need to improve the
performance of a local network’s use of external resources, or you wish to have
the capability of monitoring or filtering the traffic.</p>
<div class="section" id="configuring-a-reverse-proxy">
<h3>Configuring A Reverse Proxy<a class="headerlink" href="#configuring-a-reverse-proxy" title="Permalink to this headline">¶</a></h3>
<p>A minimal reverse proxy configuration requires changes to only a few
configuration files, which will all be located in the
<code class="docutils literal notranslate"><span class="pre">/opt/ts/etc/trafficserver</span></code> directory if you have configured your installation
per the instructions in <a class="reference internal" href="#gs-install-from-source"><span class="std std-ref">Installing From Source Code</span></a> above.</p>
<p>For these examples, we will be assuming that Traffic Server is running on the same host
machine as the origin website. This is not a requirement, and you may choose to
run Traffic Server on an entirely different host, even connected to entirely different
networks, as long as Traffic Server is able to reach the origin host.</p>
<div class="section" id="enable-reverse-proxying">
<h4>Enable Reverse Proxying<a class="headerlink" href="#enable-reverse-proxying" title="Permalink to this headline">¶</a></h4>
<p>Within the <a class="reference internal" href="../admin-guide/files/records.config.en.html#std-configfile-records.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">records.config</span></code></a> configuration file, ensure that the following
settings have been configured as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">http</span> <span class="n">INT</span> <span class="mi">1</span>
<span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reverse_proxy</span><span class="o">.</span><span class="n">enabled</span> <span class="n">INT</span> <span class="mi">1</span>
<span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">url_remap</span><span class="o">.</span><span class="n">remap_required</span> <span class="n">INT</span> <span class="mi">1</span>
<span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">url_remap</span><span class="o">.</span><span class="n">pristine_host_hdr</span> <span class="n">INT</span> <span class="mi">1</span>
<span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">server_ports</span> <span class="n">STRING</span> <span class="mi">8080</span> <span class="mi">8080</span><span class="p">:</span><span class="n">ipv6</span>
</pre></div>
</div>
<dl class="simple">
<dt><a class="reference internal" href="../admin-guide/files/records.config.en.html#proxy-config-http-cache-http" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.http.cache.http</span></code></a></dt><dd><p>Enables caching of proxied HTTP requests.</p>
</dd>
<dt><a class="reference internal" href="../admin-guide/files/records.config.en.html#proxy-config-reverse-proxy-enabled" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.reverse_proxy.enabled</span></code></a></dt><dd><p>Enables reverse proxying support.</p>
</dd>
<dt><a class="reference internal" href="../admin-guide/files/records.config.en.html#proxy-config-url-remap-remap-required" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.url_remap.remap_required</span></code></a></dt><dd><p>This setting requires that a remap rule exist before Traffic Server will proxy the
request and ensures that your proxy cannot be used to access the content of
arbitrary websites (allowing someone of malicious intent to potentially
mask their identity to an unknowing third party).</p>
</dd>
<dt><a class="reference internal" href="../admin-guide/files/records.config.en.html#proxy-config-url-remap-pristine-host-hdr" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.url_remap.pristine_host_hdr</span></code></a></dt><dd><p>This setting causes Traffic Server to keep the <code class="docutils literal notranslate"><span class="pre">Host:</span></code> client request header intact
which is necessary in cases where your origin servers may be performing
domain-based virtual hosting, or taking other actions dependent upon the
contents of that header.</p>
</dd>
<dt><a class="reference internal" href="../admin-guide/files/records.config.en.html#proxy-config-http-server-ports" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.http.server_ports</span></code></a></dt><dd><p>This configures Traffic Server to bind itself to the port <code class="docutils literal notranslate"><span class="pre">8080</span></code> for HTTP traffic,
for both IPv4 and IPv6.</p>
</dd>
</dl>
</div>
<div class="section" id="configure-origin-location">
<h4>Configure Origin Location<a class="headerlink" href="#configure-origin-location" title="Permalink to this headline">¶</a></h4>
<p>The previous settings enable reverse proxying (and prevent flagrant abuse of
it), but now Traffic Server needs to know what to proxy. This is achieved by writing
remap rules, which make use of the core <a class="reference internal" href="../admin-guide/plugins/conf_remap.en.html#admin-plugins-conf-remap"><span class="std std-ref">Configuration Remap Plugin</span></a>. For
our Getting Started guide’s Acme Widgets example scenario, we have very simple needs
and want little more than to proxy all requests to our single origin server.
This is accomplished with the following rule added to the <a class="reference internal" href="../admin-guide/files/remap.config.en.html#std-configfile-remap.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">remap.config</span></code></a>
configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">80</span><span class="o">/</span>
</pre></div>
</div>
<p>With this mapping rule, all paths that Traffic Server receives with a Host: header of
<code class="docutils literal notranslate"><span class="pre">www.acme.com</span></code> will be proxied to <code class="docutils literal notranslate"><span class="pre">localhost:80</span></code>. For instance, a request
for <code class="docutils literal notranslate"><span class="pre">http://www.acme.com/foo/bar</span></code> will be proxied to <code class="docutils literal notranslate"><span class="pre">http://localhost:80/foo/bar</span></code>,
while requests with other Host: headers will be rejected.</p>
<p>It is worth pausing at this point to note that in a reverse proxying scenario,
it is Traffic Server itself which should be responding to HTTP requests made to your
public domain. While you first configure and evaluate whether Traffic Server will meet
your needs, your origin server will continue to reside at the public-facing
domain name on the default ports, should you move your Traffic Server configuration into
production your DNS records for the domain(s) you wish to proxy and cache should
resolve to the host(s) running Traffic Server (in the event that you run it on a separate
host from your origin). Your origin should be accessible at a different address
(or bind to different ports if you are running both your origin service and Traffic Server
on the same host) and should no longer receive requests sent to the primary
domain on its default ports.</p>
<p>In our Acme Widgets scenario, they ultimately decide to deploy Traffic Server at which point,
since they are running both Traffic Server and their origin web server on the same host,
they reconfigure their origin service to listen on port <code class="docutils literal notranslate"><span class="pre">8080</span></code> instead of the
default, and change Traffic Server to bind to <code class="docutils literal notranslate"><span class="pre">80</span></code> itself. Updating the remap is thus
required, and it should now be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span>
</pre></div>
</div>
<p>Now all requests made to <code class="docutils literal notranslate"><span class="pre">www.acme.com</span></code> are received by Traffic Server which knows to
proxy those requests to <code class="docutils literal notranslate"><span class="pre">localhost:8080</span></code> if it cannot already serve them from
its cache. Because we enabled pristine host headers earlier, the origin service
will continue to receive <code class="docutils literal notranslate"><span class="pre">Host:</span> <span class="pre">www.acme.com</span></code> in the HTTP request.</p>
<p>If Acme Widgets decides to use Traffic Server to reverse proxy a second domain <code class="docutils literal notranslate"><span class="pre">static.acme.com</span></code>
with a different origin server than the original, they need to make further
changes, as a new remap line needs to be added to handle the additional domain:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">static</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">origin</span><span class="o">-</span><span class="n">static</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
</pre></div>
</div>
<p>If they also decide to have requests to <code class="docutils literal notranslate"><span class="pre">www.acme.com</span></code> with paths that start with
<code class="docutils literal notranslate"><span class="pre">/api</span></code> to a different origin server. The api origin server shouldn’t get the <code class="docutils literal notranslate"><span class="pre">/api</span></code>,
they will remap it away. And, since the above remap rules catch all paths,
this remap rule needs to be above it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">-</span><span class="n">origin</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
</pre></div>
</div>
<p>With this remap rule in place, a request to <code class="docutils literal notranslate"><span class="pre">http://www.acme.com/api/example/foo</span></code>
will be proxied to <code class="docutils literal notranslate"><span class="pre">http://api-origin.acme.com/example/foo</span></code>.</p>
<p>Finally, if Acme Widgets decides to secure their site with https, they will need two
additional remap rules to handle the https requests. Traffic Server can translate an inbound
https request to an http request to origin. So, they would have additional remap
rules like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span>
<span class="nb">map</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">static</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">origin</span><span class="o">-</span><span class="n">static</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
</pre></div>
</div>
<p>This will require installing a certificate, and adding a line to
<a class="reference internal" href="../admin-guide/files/ssl_multicert.config.en.html#std-configfile-ssl_multicert.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">ssl_multicert.config</span></code></a>. Assuming the cert has the static.acme.com alternate
name, and that cert should be presented by default:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dest_ip</span><span class="o">=*</span> <span class="n">ssl_cert_name</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">secret</span><span class="o">/</span><span class="n">privatekey</span><span class="o">/</span><span class="n">acme</span><span class="o">.</span><span class="n">rsa</span>
</pre></div>
</div>
<p>Further information about configuring Traffic Server for TLS can be found <a class="reference internal" href="../admin-guide/security/index.en.html#admin-ssl-termination"><span class="std std-ref">Basic SSL Termination</span></a>
section of the documentation.</p>
</div>
<div class="section" id="adjust-cache-parameters">
<h4>Adjust Cache Parameters<a class="headerlink" href="#adjust-cache-parameters" title="Permalink to this headline">¶</a></h4>
<p>The default Traffic Server configuration will provide a 256 MB disk cache, located in
<code class="docutils literal notranslate"><span class="pre">var/trafficserver/</span></code> underneath your install prefix. You may wish to adjust
either or both of the size and location of this cache. This is done with the
<a class="reference internal" href="../admin-guide/files/storage.config.en.html#std-configfile-storage.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">storage.config</span></code></a> configuration file. In our example, Acme Widgets has dedicated
a large storage pool on their cache server which is mounted at <code class="docutils literal notranslate"><span class="pre">/cache</span></code>. To
use this, and to disable the default cache storage setting, the following will
be the sole entry in <a class="reference internal" href="../admin-guide/files/storage.config.en.html#std-configfile-storage.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">storage.config</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="n">trafficserver</span> <span class="mi">500</span><span class="n">G</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Changes to the cache configuration require a restart of Traffic Server.</p>
</div>
<p>You may also wish to use raw devices, or partition your cache storage. Details
on these features may be found in the <a class="reference internal" href="../admin-guide/configuration/index.en.html#admin-configuration"><span class="std std-ref">Proxy Cache Configuration</span></a> section of
the Administrator’s Guide.</p>
</div>
<div class="section" id="final-configurations">
<h4>Final Configurations<a class="headerlink" href="#final-configurations" title="Permalink to this headline">¶</a></h4>
<p>Once completed, the following configuration files for Acme Widgets contain the following
entries:</p>
<p><a class="reference internal" href="../admin-guide/files/records.config.en.html#std-configfile-records.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">records.config</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">http</span> <span class="n">INT</span> <span class="mi">1</span>
<span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reverse_proxy</span><span class="o">.</span><span class="n">enabled</span> <span class="n">INT</span> <span class="mi">1</span>
<span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">url_remap</span><span class="o">.</span><span class="n">remap_required</span> <span class="n">INT</span> <span class="mi">1</span>
<span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">url_remap</span><span class="o">.</span><span class="n">pristine_host_hdr</span> <span class="n">INT</span> <span class="mi">1</span>
<span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">server_ports</span> <span class="n">STRING</span> <span class="mi">80</span> <span class="mi">80</span><span class="p">:</span><span class="n">ipv6</span>
</pre></div>
</div>
<p><a class="reference internal" href="../admin-guide/files/remap.config.en.html#std-configfile-remap.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">remap.config</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">-</span><span class="n">origin</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
<span class="nb">map</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">api</span><span class="o">-</span><span class="n">origin</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
<span class="nb">map</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span>
<span class="nb">map</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span>
<span class="nb">map</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">static</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">origin</span><span class="o">-</span><span class="n">static</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
<span class="nb">map</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">static</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">origin</span><span class="o">-</span><span class="n">static</span><span class="o">.</span><span class="n">acme</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
</pre></div>
</div>
<p><a class="reference internal" href="../admin-guide/files/storage.config.en.html#std-configfile-storage.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">storage.config</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="n">trafficserver</span> <span class="mi">500</span><span class="n">G</span>
</pre></div>
</div>
<p><a class="reference internal" href="../admin-guide/files/ssl_multicert.config.en.html#std-configfile-ssl_multicert.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">ssl_multicert.config</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssl_cert_name</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">secret</span><span class="o">/</span><span class="n">acme</span><span class="o">.</span><span class="n">rsa</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuring-a-forward-proxy">
<h3>Configuring A Forward Proxy<a class="headerlink" href="#configuring-a-forward-proxy" title="Permalink to this headline">¶</a></h3>
<p>Configuring a forward proxy with Traffic Server is somewhat more straightforward, though
there are two main approaches for how to direct client traffic through the
proxy: explicit or transparent.</p>
<p>More detail on the process is also available in the Administrator’s Guide in
the <a class="reference internal" href="../admin-guide/configuration/transparent-forward-proxying.en.html#forward-proxy"><span class="std std-ref">Forward Proxy</span></a> section. This guide will cover only a minimal
configuration.</p>
<div class="section" id="enable-forward-proxying">
<h4>Enable Forward Proxying<a class="headerlink" href="#enable-forward-proxying" title="Permalink to this headline">¶</a></h4>
<p>Contrary to a reverse proxy, where you have a defined list of origin servers for
which you wish to proxy (and optionally cache), a forward proxy is used to
proxy (and optionally cache) for arbitrary remote hosts. As such, the following
settings in <a class="reference internal" href="../admin-guide/files/records.config.en.html#std-configfile-records.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">records.config</span></code></a> are the base configuration for a minimal
forward proxy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">url_remap</span><span class="o">.</span><span class="n">remap_required</span> <span class="n">INT</span> <span class="mi">0</span>
<span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">http</span> <span class="n">INT</span> <span class="mi">1</span>
</pre></div>
</div>
<dl class="simple">
<dt><a class="reference internal" href="../admin-guide/files/records.config.en.html#proxy-config-url-remap-remap-required" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.url_remap.remap_required</span></code></a></dt><dd><p>Disables the requirement for a remap rule to exist and match the incoming
request before Traffic Server will proxy the request to the remote host.</p>
</dd>
<dt><a class="reference internal" href="../admin-guide/files/records.config.en.html#proxy-config-http-cache-http" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.http.cache.http</span></code></a></dt><dd><p>Enables caching of proxied HTTP requests.</p>
</dd>
</dl>
<p>If your installation will be strictly a forwarding proxy, then reverse proxying
should be explicitly disabled:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONFIG</span> <span class="n">proxy</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">reverse_proxy</span><span class="o">.</span><span class="n">enabled</span> <span class="n">INT</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="explicit-versus-transparent">
<h4>Explicit Versus Transparent<a class="headerlink" href="#explicit-versus-transparent" title="Permalink to this headline">¶</a></h4>
<p>With forward proxying enabled, the next step is deciding how clients will
connect through the proxy server. Explicit forward proxying requires that every
client application be configured (manually or through whatever configuration
management system you may employ) to use the proxy. The presence of the proxy
will be known to clients, and any clients not configured to use the proxy will
bypass it entirely unless you otherwise block network access for unproxied
traffic.</p>
<p>With transparent proxying, clients require no configuration and may be given no
option to bypass the proxy. This configuration requires your network to route
all requests automatically to the proxy. The details of how to accomplish this
routing are entirely dependent upon the layout of your network and the routing
devices you use.</p>
<p>For a more detailed discussion of the options, and starting points for
configuring each in your network environment, please refer to the
<a class="reference internal" href="../admin-guide/configuration/transparent-forward-proxying.en.html#forward-proxy"><span class="std std-ref">Forward Proxy</span></a> section of the Administrator’s Guide.</p>
</div>
</div>
</div>
<div class="section" id="logging-and-monitoring">
<h2>Logging and Monitoring<a class="headerlink" href="#logging-and-monitoring" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuring-log-output">
<h3>Configuring Log Output<a class="headerlink" href="#configuring-log-output" title="Permalink to this headline">¶</a></h3>
<p>The log formats used by Traffic Server are highly configurable. While this guide will not
go into full detail of this versatility, it is useful to consider what style of
logging you would like to perform. If your organization already makes use of
log monitoring or analysis tools that understand, for example, <em>Netscape
Extended-2</em> format you may wish to enable that logging format in addition to,
or instead of, the default Traffic Server logs.</p>
<p>The Administrator’s Guide discusses logging options in great detail in
<a class="reference internal" href="../admin-guide/logging/index.en.html#admin-logging"><span class="std std-ref">Logging</span></a>.</p>
</div>
</div>
<div class="section" id="further-steps">
<h2>Further Steps<a class="headerlink" href="#further-steps" title="Permalink to this headline">¶</a></h2>
<p>By this point, you should have a fully functioning caching proxy, whether to
help improve the customer facing performance of your website, or to assist in
speeding up Internet access for your office while allowing for the possibility
of access control, content filtering, and/or usage monitoring. However, it is
quite likely that your installation is not yet tuned properly and may not be
providing the best experience Apache Traffic Server™ has to offer. It is strongly recommended
that you consult the <a class="reference internal" href="../admin-guide/performance/index.en.html#performance-tuning"><span class="std std-ref">Performance Tuning</span></a> guide.</p>
<p>You may also want to learn more about <a class="reference internal" href="../admin-guide/monitoring/index.en.html#admin-monitoring"><span class="std std-ref">Monitoring</span></a>, or ensuring
that your installation is properly secured by reading the <a class="reference internal" href="../admin-guide/security/index.en.html#admin-security"><span class="std std-ref">Security</span></a>
section. Properly sizing your cache, both the on-disk cache and the companion
memory cache, are important topics covered in <a class="reference internal" href="../admin-guide/configuration/index.en.html#admin-configuration"><span class="std std-ref">Proxy Cache Configuration</span></a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../release-notes/index.en.html" class="btn btn-neutral float-right" title="Release Notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../preface/index.en.html" class="btn btn-neutral float-left" title="Preface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, dev@trafficserver.apache.org

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>
 


</body>
</html>