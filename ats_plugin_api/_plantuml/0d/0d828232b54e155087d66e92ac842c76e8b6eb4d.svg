<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="703px" preserveAspectRatio="none" style="width:534px;height:703px;" version="1.1" viewBox="0 0 534 703" width="534px" zoomAndPan="magnify"><defs><filter height="300%" id="f1ownzzq4iw4a7" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="264" x="134.5" y="22.9951">AcidPtr Writer/Reader Contention</text><rect fill="#DDDDDD" height="657.7188" style="stroke: #A80036; stroke-width: 1.0;" width="139" x="50" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="84.5" y="46.3638">MemLock</text><rect fill="#008000" filter="url(#f1ownzzq4iw4a7)" height="127.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="83" y="297.2578"/><rect fill="#FF0000" filter="url(#f1ownzzq4iw4a7)" height="104.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="83" y="454.0547"/><rect fill="#FF0000" filter="url(#f1ownzzq4iw4a7)" height="410.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="153.5" y="176.7266"/><rect fill="#FFFFFF" filter="url(#f1ownzzq4iw4a7)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="394.5" y="205.8594"/><rect fill="#FFFFFF" filter="url(#f1ownzzq4iw4a7)" height="221.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="455.5" y="375.6563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="88" x2="88" y1="116.5938" y2="605.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="158" x2="158" y1="116.5938" y2="605.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="228.5" x2="228.5" y1="116.5938" y2="605.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="399.5" x2="399.5" y1="116.5938" y2="605.7188"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="460.5" x2="460.5" y1="116.5938" y2="605.7188"/><rect fill="#FEFECE" filter="url(#f1ownzzq4iw4a7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="54" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="61" y="101.292">Access</text><rect fill="#FEFECE" filter="url(#f1ownzzq4iw4a7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="54" y="604.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="61" y="624.7139">Access</text><rect fill="#FEFECE" filter="url(#f1ownzzq4iw4a7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="49" x="132" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="139" y="101.292">Write</text><rect fill="#FEFECE" filter="url(#f1ownzzq4iw4a7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="49" x="132" y="604.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="139" y="624.7139">Write</text><rect fill="#FEFECE" filter="url(#f1ownzzq4iw4a7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="195.5" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="202.5" y="101.292">AcidPtr</text><rect fill="#FEFECE" filter="url(#f1ownzzq4iw4a7)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="195.5" y="604.7188"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="202.5" y="624.7139">AcidPtr</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="376.5" y="113.292">Writer</text><ellipse cx="399.5" cy="43.2969" fill="#FF0000" filter="url(#f1ownzzq4iw4a7)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M399.5,51.2969 L399.5,78.2969 M386.5,59.2969 L412.5,59.2969 M399.5,78.2969 L386.5,93.2969 M399.5,78.2969 L412.5,93.2969 " fill="none" filter="url(#f1ownzzq4iw4a7)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="376.5" y="617.7139">Writer</text><ellipse cx="399.5" cy="631.0156" fill="#FF0000" filter="url(#f1ownzzq4iw4a7)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M399.5,639.0156 L399.5,666.0156 M386.5,647.0156 L412.5,647.0156 M399.5,666.0156 L386.5,681.0156 M399.5,666.0156 L412.5,681.0156 " fill="none" filter="url(#f1ownzzq4iw4a7)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="432.5" y="113.292">Reader</text><ellipse cx="460.5" cy="43.2969" fill="#008000" filter="url(#f1ownzzq4iw4a7)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M460.5,51.2969 L460.5,78.2969 M447.5,59.2969 L473.5,59.2969 M460.5,78.2969 L447.5,93.2969 M460.5,78.2969 L473.5,93.2969 " fill="none" filter="url(#f1ownzzq4iw4a7)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="432.5" y="617.7139">Reader</text><ellipse cx="460.5" cy="631.0156" fill="#008000" filter="url(#f1ownzzq4iw4a7)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M460.5,639.0156 L460.5,666.0156 M447.5,647.0156 L473.5,647.0156 M460.5,666.0156 L447.5,681.0156 M460.5,666.0156 L473.5,681.0156 " fill="none" filter="url(#f1ownzzq4iw4a7)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#008000" filter="url(#f1ownzzq4iw4a7)" height="127.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="83" y="297.2578"/><rect fill="#FF0000" filter="url(#f1ownzzq4iw4a7)" height="104.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="83" y="454.0547"/><rect fill="#FF0000" filter="url(#f1ownzzq4iw4a7)" height="410.8594" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="153.5" y="176.7266"/><rect fill="#FFFFFF" filter="url(#f1ownzzq4iw4a7)" height="120.5313" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="394.5" y="205.8594"/><rect fill="#FFFFFF" filter="url(#f1ownzzq4iw4a7)" height="221.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="455.5" y="375.6563"/><polygon fill="#A80036" points="239.5,143.5938,229.5,147.5938,239.5,151.5938,235.5,147.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="233.5" x2="398.5" y1="147.5938" y2="147.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="245.5" y="142.6606">startCommit()</text><polygon fill="#A80036" points="216.5,172.7266,226.5,176.7266,216.5,180.7266,220.5,176.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="163.5" x2="222.5" y1="176.7266" y2="176.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="170.5" y="171.7935">lock</text><polygon fill="#A80036" points="382.5,201.8594,392.5,205.8594,382.5,209.8594,386.5,205.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="228.5" x2="388.5" y1="205.8594" y2="205.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="235.5" y="200.9263">copy to AcidCommitPtr</text><polygon fill="#FFC0CB" filter="url(#f1ownzzq4iw4a7)" points="325,218.9922,474,218.9922,484,229.9922,474,241.9922,325,241.9922,315,229.9922,325,218.9922" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="327" y="235.0591">update AcidCommitPtr</text><polygon fill="#008000" points="239.5,264.125,229.5,268.125,239.5,272.125,235.5,268.125" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="233.5" x2="459.5" y1="268.125" y2="268.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="245.5" y="263.1919">getPtr()</text><polygon fill="#008000" points="216.5,293.2578,226.5,297.2578,216.5,301.2578,220.5,297.2578" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="93" x2="222.5" y1="297.2578" y2="297.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="100" y="292.3247">lock</text><polygon fill="#A80036" points="239.5,322.3906,229.5,326.3906,239.5,330.3906,235.5,326.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="233.5" x2="398.5" y1="326.3906" y2="326.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="245.5" y="321.4575">~AcidCommitPtr()</text><polygon fill="#008000" points="443.5,371.6563,453.5,375.6563,443.5,379.6563,447.5,375.6563" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="228.5" x2="449.5" y1="375.6563" y2="375.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="235.5" y="370.7231">copy const shared_ptr</text><path d="M8,339.5234 L8,394.5234 L220,394.5234 L220,349.5234 L210,339.5234 L8,339.5234 " fill="#FBFB77" filter="url(#f1ownzzq4iw4a7)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M210,339.5234 L210,349.5234 L220,349.5234 L210,339.5234 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="14" y="356.5903">Contention limited to duration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="14" y="371.7231">of shared_ptr copy/reset.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="14" y="386.856">(internally defined)</text><polygon fill="#008000" points="99,420.9219,89,424.9219,99,428.9219,95,424.9219" style="stroke: #008000; stroke-width: 1.0;"/><line style="stroke: #008000; stroke-width: 1.0;" x1="93" x2="227.5" y1="424.9219" y2="424.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="105" y="419.9888">unlock</text><polygon fill="#A80036" points="216.5,450.0547,226.5,454.0547,216.5,458.0547,220.5,454.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="93" x2="222.5" y1="454.0547" y2="454.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="100" y="449.1216">lock</text><polygon fill="#90EE90" filter="url(#f1ownzzq4iw4a7)" points="406,467.1875,515,467.1875,525,478.1875,515,490.1875,406,490.1875,396,478.1875,406,467.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="408" y="483.2544">use shared copy</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="228.5" x2="270.5" y1="516.4531" y2="516.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="270.5" x2="270.5" y1="516.4531" y2="529.4531"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="229.5" x2="270.5" y1="529.4531" y2="529.4531"/><polygon fill="#A80036" points="239.5,525.4531,229.5,529.4531,239.5,533.4531,235.5,529.4531" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="235.5" y="511.3872">reset shared_ptr</text><polygon fill="#A80036" points="99,554.4531,89,558.4531,99,562.4531,95,558.4531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="93" x2="227.5" y1="558.4531" y2="558.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="105" y="553.52">unlock</text><polygon fill="#A80036" points="169.5,583.5859,159.5,587.5859,169.5,591.5859,165.5,587.5859" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="163.5" x2="227.5" y1="587.5859" y2="587.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="175.5" y="582.6528">unlock</text><!--
@startuml
Title AcidPtr Writer/Reader Contention
box "MemLock"
participant "Access" as AccessMutex
participant "Write" as WriteMutex
end box
participant AcidPtr
actor Writer #red
actor Reader #green

Writer -> AcidPtr: startCommit()
AcidPtr <- WriteMutex: lock
activate WriteMutex #red
AcidPtr -> Writer: copy to AcidCommitPtr
activate Writer
hnote over Writer #pink
  update AcidCommitPtr
end hnote
Reader -[#green]> AcidPtr: getPtr()
AcidPtr <[#green]- AccessMutex: lock
activate AccessMutex #green

Writer -> AcidPtr: ~AcidCommitPtr()
deactivate Writer
AcidPtr -[#green]> Reader: copy const shared_ptr
activate Reader
note left
  Contention limited to duration
  of shared_ptr copy/reset.
  (internally defined)
end note
AcidPtr -[#green]> AccessMutex: unlock
deactivate AccessMutex

AcidPtr <- AccessMutex: lock
activate AccessMutex #red
hnote over Reader #lightgreen
  use shared copy
end hnote
AcidPtr -> AcidPtr: reset shared_ptr
AcidPtr -> AccessMutex: unlock
deactivate AccessMutex
AcidPtr -> WriteMutex: unlock
deactivate WriteMutex

@enduml

PlantUML version 1.2018.01(Sun Jan 28 18:08:22 GMT 2018)
(APACHE source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.9.1+11
Operating System: Linux
OS Version: 5.10.7-200.fc33.x86_64
Default Encoding: UTF-8
Language: en
Country: IE
--></g></svg>