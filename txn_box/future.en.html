

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Future Work &mdash; Transaction Box</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Miscellaneous" href="misc.en.html" />
    <link rel="prev" title="Modifier Reference" href="user/ModifierReference.en.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Transaction Box Plugin
          

          
            
            <img src="_static/balcora-gate-400x400.jpg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="txn_box.en.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="txn_box.en.html#configuration">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.en.html">Building</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.en.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="expr.en.html">Feature Expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="directive.en.html">Directives</a></li>
<li class="toctree-l1"><a class="reference internal" href="selection.en.html">Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide.en.html">Usage Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.en.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="arch.en.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/ExtractorReference.en.html">Extractor Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/ExtractorReference.en.html#extractors">Extractors</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/DirectiveReference.en.html">Directive Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/ComparisonReference.en.html">Comparison Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/ModifierReference.en.html">Modifier Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Future Work</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#session">Session</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#feature-modifiers">Feature Modifiers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#comparisons">Comparisons</a></li>
<li class="toctree-l3"><a class="reference internal" href="#directives">Directives</a></li>
<li class="toctree-l3"><a class="reference internal" href="#feature-tuples">Feature Tuples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="misc.en.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev/dev-guide.en.html">Developer Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="reference.en.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Transaction Box Plugin</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Future Work</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/future.en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="future-work">
<span id="future"></span><h1>Future Work<a class="headerlink" href="#future-work" title="Permalink to this headline">¶</a></h1>
<p>This is future intended work and so may change radically. The essence should remain similar.</p>
<div class="section" id="session">
<h2>Session<a class="headerlink" href="#session" title="Permalink to this headline">¶</a></h2>
<p>inbound-local-addr</p>
<p>inbound-remote-port</p>
<p>inbound-local-port</p>
<div class="section" id="features">
<h3>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>ts-uuid</dt><dd><p>Process UUID for Traffic Server.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="feature-modifiers">
<h2>Feature Modifiers<a class="headerlink" href="#feature-modifiers" title="Permalink to this headline">¶</a></h2>
<p>The extracted feature can be post processed using options in the <a class="reference internal" href="user/DirectiveReference.en.html#with" title="with"><code class="xref txb txb-drtv docutils literal notranslate"><span class="pre">with</span></code></a>. This is done by
having a pair where the first element is the feature extraction, and the second is a map of options.
Currently the only planned modifier is “hash”.</p>
<dl>
<dt>hash</dt><dd><p>“hash: &lt;number&gt;”</p>
<p>Hash the feature and reduce it to the range 1 .. :<code class="code docutils literal notranslate"><span class="pre">number</span></code>. Something like</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">with</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="s">&quot;{creq.url}&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">hash</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4096</span>
</pre></div>
</div>
<p>This will get the client request URL, hash it, then (as evenly as possibl) reduce it to a number
in the range 1 .. 4096.</p>
</dd>
<dt>slice</dt><dd><p>Extract elements of a list. This takes two arguments, the left and right slice points. These are
positions between elements of a list. Position 0 is before any element, and position -0
(represented by “*”) is past the last element. Other slice points count up from 0 (1, 2, 3, …)
left to right and down from -0 ( -1, -2, -3, …) right to left.</p>
</dd>
</dl>
<div class="section" id="comparisons">
<h3>Comparisons<a class="headerlink" href="#comparisons" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="directives">
<h3>Directives<a class="headerlink" href="#directives" title="Permalink to this headline">¶</a></h3>
<dl>
<dt>apply</dt><dd><p>“apply: [ &lt;regex&gt;, &lt;string&gt; ]”</p>
<p>Apply the regular expression :<code class="code docutils literal notranslate"><span class="pre">regex</span></code> to :<code class="code docutils literal notranslate"><span class="pre">string</span></code>. This updates the extraction argument
list such that capture groups in the regular expression can be extracted via numbered extractors.
E.g. “{2}” is replaced by the second capture group. Groups that do not exist or were not part of
the regular expression match yield the empty string.</p>
</dd>
<dt>call</dt><dd><p>“call: &lt;plugin&gt;”</p>
<p>“call: [ &lt;plugin&gt;, &lt;args&gt;, … ]”</p>
<p>Invoke a callback provided by a plugin.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Implementation</p>
<p>Should the entry point be specifiable in the directive? That could be very nice.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="feature-tuples">
<h3>Feature Tuples<a class="headerlink" href="#feature-tuples" title="Permalink to this headline">¶</a></h3>
<p>Do_with a list feature, the matching is done across elements of the list. This can be done in an iterative
style where a comparison is made against each element in the list, or tuple style where there is a
different comparison for each element in the list.</p>
<p>The list style matching operators require a value that is another comparison.</p>
<dl class="simple">
<dt><code class="code docutils literal notranslate"><span class="pre">for-all</span></code></dt><dd><p>The match succeeds if the base comparison succeeds for every element.</p>
</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">for-any</span></code></dt><dd><p>The match succeeds if the base comparison succeeds for any element.</p>
</dd>
<dt><code class="code docutils literal notranslate"><span class="pre">for-none</span></code></dt><dd><p>The match succeeds if the base comparison fails for all elements.</p>
</dd>
</dl>
<p>The tuple style match is <code class="code docutils literal notranslate"><span class="pre">tuple</span></code>. It requires a list of comparisons and applies the
comparisons against the list in the same order. It matches if all of the comparisons match. Elements
that do not have a comparison do not match. This means by default if the feature list is a different
length that the comparison list, the match will fail. This is the common case. For less common cases
there are other options.</p>
<p>Tuple elements can be skipped with the <code class="code docutils literal notranslate"><span class="pre">whatever</span></code> comparison which accepts any feature type
and always matches.</p>
<p>Trailing elements can be matched with any of the list comparisons. This must always be the last
comparison in a tuple and applies to all elements that do not have an explicit comparison.</p>
<p>These can be combined to ignore all elements past a fixed initial set by using a list comparison
after the last significant comparison.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span>  <span class="nt">for-all</span><span class="p">:</span>
   <span class="p p-Indicator">-</span>  <span class="nt">otherwise</span><span class="p">:</span>
</pre></div>
</div>
<p>This is useful if there are different comparisons in the same selection. Otherwise it might be
better to use modifiers to shape the list. E.g., if only the first two elements are relevant then
the <code class="code docutils literal notranslate"><span class="pre">slice</span></code> modifier can be used to reduce the list to the first two elements. Using
modifiers is faster and more compact but has the cost of limiting all of the comparisons in the
selection.</p>
<p>Matching can be done in a more explicitly iterative style by use of <code class="code docutils literal notranslate"><span class="pre">...</span></code> and modifiers. This
can be used to process successively smaller subsequences of the list.</p>
<p>For examples of all this, consider working with the <cite>Via</cite> header. This is a multi-valued field.
Suppose it was required to check for having been through the local instance of Traffic Server by
looking for the process UUID in the fields. If the first element is the current instance, that’s
a direct loop and an error. Otherwise, if the UUID is any other element that is an error unless
the <cite>k8-routing</cite> field is present, indicating that there is active routing that sent it back.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is a real life example.</p>
</div>
<p>The design here is to split the <cite>Via</cite> header and then work with the list. The <code class="code docutils literal notranslate"><span class="pre">ts-uuid</span></code>
extractor gets the UUID for the Traffic Server process which is used in the <cite>Via</cite> header.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">with</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="nv">creq-field@Via</span> <span class="p p-Indicator">,</span> <span class="p p-Indicator">{</span><span class="nt"> split</span><span class="p">:</span> <span class="s">&quot;,&quot;</span> <span class="p p-Indicator">}</span> <span class="p p-Indicator">]</span> <span class="c1"># split in to list</span>
<span class="nt">select</span><span class="p">:</span>
<span class="p p-Indicator">-</span>  <span class="nt">tuple</span><span class="p">:</span>
   <span class="p p-Indicator">-</span>  <span class="nt">contains</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ts-uuid</span> <span class="c1"># only check first</span>
   <span class="p p-Indicator">-</span>  <span class="nt">for-all</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">whatever</span><span class="p">:</span>
   <span class="nt">do</span><span class="p">:</span>
   <span class="p p-Indicator">-</span>  <span class="nt">txn-status</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="nv">400</span> <span class="p p-Indicator">,</span> <span class="s">&quot;Loop</span><span class="nv"> </span><span class="s">detected&quot;</span> <span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span>  <span class="nt">tuple</span><span class="p">:</span>
   <span class="p p-Indicator">-</span>  <span class="nt">whatever</span><span class="p">:</span> <span class="c1"># skip first element.</span>
   <span class="p p-Indicator">-</span>  <span class="nt">for-any</span><span class="p">:</span> <span class="c1"># otherwise, see if it&#39;s any other element.</span>
      <span class="p p-Indicator">-</span>  <span class="nt">contains</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ts-uuid</span>
   <span class="nt">do</span><span class="p">:</span> <span class="c1"># found it, fail if there&#39;s no routing flag.</span>
   <span class="p p-Indicator">-</span>  <span class="nt">with</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">creq-field@k8-routing::present</span>
      <span class="nt">select</span><span class="p">:</span>
      <span class="p p-Indicator">-</span>   <span class="nt">eq</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
          <span class="nt">do</span><span class="p">:</span>
             <span class="nt">txn-status</span><span class="p">:</span> <span class="p p-Indicator">[</span> <span class="nv">400</span> <span class="p p-Indicator">,</span> <span class="s">&quot;Loop</span><span class="nv"> </span><span class="s">detected&quot;</span> <span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>Issues</p>
<ul class="simple">
<li><p>Matching on just the first value is annoyingly verbose. This would be noticeably better if there
was an “apply” directive which loaded the <code class="code docutils literal notranslate"><span class="pre">with</span></code> context, e.g. regular expression groups
and <code class="code docutils literal notranslate"><span class="pre">...</span></code> without even trying to do matches.e43se</p></li>
<li><p>Do_with support for <code class="code docutils literal notranslate"><span class="pre">do</span></code> in each comparison, this may be of more limited utility. But that
would be verbose to (for instance) do something for every tuple with a specific first element
if there are multiple cases that match with that element.</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="misc.en.html" class="btn btn-neutral float-right" title="Miscellaneous" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="user/ModifierReference.en.html" class="btn btn-neutral float-left" title="Modifier Reference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Verizon Media.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>