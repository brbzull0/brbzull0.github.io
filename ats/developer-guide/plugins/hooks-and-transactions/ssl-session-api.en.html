


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TLS Session Plugin API &mdash; Apache Traffic Server 10.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/override.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="HTTP Transaction Timers" href="trafficserver-timers.en.html" />
    <link rel="prev" title="TLS User Agent Hooks" href="ssl-hooks.en.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Apache Traffic Server
          

          
            
            <img src="../../../_static/trans_logo_tm_380x69.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.en.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release-process/index.en.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/index.en.html">Contributing to Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing-with-vagrant/index.en.html">Using Vagrant to Test Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debugging/index.en.html">Debugging and Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../threads-and-events.en.html">Threads and Event Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cache-architecture/index.en.html">Cache Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging-architecture/index.en.html">Logging Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-libraries/index.en.html">Internal libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.en.html">Plugin Development</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../introduction.en.html">Plugin Development Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../building-plugins.en.html">Building Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configuration.en.html">Plugin Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugin-management/index.en.html">Plugin Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../actions/index.en.html">Actions</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.en.html">Hooks and Transactions</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="adding-hooks.en.html">Adding Hooks</a></li>
<li class="toctree-l4"><a class="reference internal" href="http-sessions.en.html">HTTP Sessions</a></li>
<li class="toctree-l4"><a class="reference internal" href="http-transactions.en.html">HTTP Transactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="intercepting-http-transactions.en.html">Intercepting HTTP Transactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="initiate-http-connection.en.html">Initiate HTTP Connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="http-alternate-selection.en.html">HTTP Alternate Selection</a></li>
<li class="toctree-l4"><a class="reference internal" href="ssl-hooks.en.html">TLS User Agent Hooks</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">TLS Session Plugin API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#utility-functions">Utility Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-use-case">Example Use Case</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.en.html#hooks">Hooks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../continuations/index.en.html">Continuations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mutexes.en.html">Mutexes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../io/index.en.html">IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http-headers/index.en.html">HTTP Headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../http-transformations/index.en.html">HTTP Transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../remap-plugins.en.html">Remap Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../new-protocol-plugins.en.html">New Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugin-interfaces.en.html">Plugin Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adding-statistics.en.html">Adding Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../example-plugins/index.en.html">Example Plugins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../config-vars.en.html">Configuration Variable Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/index.en.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../continuous-integration/index.en.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/index.en.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../host-resolution-proposal.en.html">Host Resolution Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client-session-architecture.en.html">An Overview Client Sessions and Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core-architecture/index.en.html">Core Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../design-documents/index.en.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../layout/index.en.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.en.html">Testing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonrpc/index.en.html">JSONRPC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendices/index.en.html">Appendices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Apache Traffic Server</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.en.html">Developer’s Guide</a> &raquo;</li>
        
          <li><a href="../index.en.html">Plugin Development</a> &raquo;</li>
        
          <li><a href="index.en.html">Hooks and Transactions</a> &raquo;</li>
        
      <li>TLS Session Plugin API</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/developer-guide/plugins/hooks-and-transactions/ssl-session-api.en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tls-session-plugin-api">
<span id="developer-plugins-ssl-session-hooks"></span><h1>TLS Session Plugin API<a class="headerlink" href="#tls-session-plugin-api" title="Permalink to this headline">¶</a></h1>
<p>These interfaces enable a plugin to hook into operations on the ATS TLS session cache.  ATS also provides API’s
to enable the plugin to update the session cache based on outside information, e.g. peer servers.</p>
<dl class="c macro">
<dt id="c.TS_SSL_SESSION_HOOK">
<code class="sig-name descname">TS_SSL_SESSION_HOOK</code><a class="headerlink" href="#c.TS_SSL_SESSION_HOOK" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This hook is invoked when a change has been made to the ATS session cache or a session has been accessed
from ATS via openssl.  These hooks are only activated if the ATS implementation of the session cache is in
use.  This means <a class="reference internal" href="../../../admin-guide/files/records.config.en.html#proxy-config-ssl-session-cache" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.ssl.session_cache</span></code></a> has been set to 2.</p>
<p>The hook callback has the following signature</p>
<dl class="c function">
<dt id="c.SSL_session_callback">
int <code class="sig-name descname">SSL_session_callback</code><span class="sig-paren">(</span><a class="reference internal" href="../../api/functions/TSTypes.en.html#c.TSCont" title="TSCont">TSCont</a> <em>contp</em>, <a class="reference internal" href="../../api/types/TSEvent.en.html#c.TSEvent" title="TSEvent">TSEvent</a> <em>event</em>, void *<em>edata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.SSL_session_callback" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>The edata parameter is a pointer to a <a class="reference internal" href="../../api/types/TSSslSession.en.html#c.TSSslSessionID" title="TSSslSessionID"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSSslSessionID</span></code></a>.</p>
<p>This callback in synchronous since the underlying openssl callback is unable to pause processing.</p>
<p>The following events can be sent to this callback</p>
<dl class="c macro">
<dt id="c.TS_EVENT_SSL_SESSION_NEW">
<code class="sig-name descname">TS_EVENT_SSL_SESSION_NEW</code><a class="headerlink" href="#c.TS_EVENT_SSL_SESSION_NEW" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Sent after a new session has been inserted into the SSL session cache.  The plugin can call <a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionGet" title="TSSslSessionGet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionGet()</span></code></a> to retrieve the actual session object.  The plugin could communicate information about the new session to other processes or update additional logging or statistics.</p>
</dd></dl>

<dl class="c macro">
<dt id="c.TS_EVENT_SSL_SESSION_GET">
<code class="sig-name descname">TS_EVENT_SSL_SESSION_GET</code><a class="headerlink" href="#c.TS_EVENT_SSL_SESSION_GET" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Sent after a session has been fetched from the SSL session cache by a client request.  The plugin could update additional logging and statistics.</p>
</dd></dl>

<dl class="c macro">
<dt id="c.TS_EVENT_SSL_SESSION_REMOVE">
<code class="sig-name descname">TS_EVENT_SSL_SESSION_REMOVE</code><a class="headerlink" href="#c.TS_EVENT_SSL_SESSION_REMOVE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Sent after a session has been removed from the SSL session cache.  The plugin could communication information about the session removal to other processes or update additional logging and statistics.</p>
</dd></dl>

</div>
<div class="section" id="utility-functions">
<h1>Utility Functions<a class="headerlink" href="#utility-functions" title="Permalink to this headline">¶</a></h1>
<p>A number of API functions will likely be used with this hook.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionGet" title="TSSslSessionGet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionGet()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionGetBuffer" title="TSSslSessionGetBuffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionGetBuffer()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionInsert" title="TSSslSessionInsert"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionInsert()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionRemove" title="TSSslSessionRemove"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionRemove()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslTicketKeyUpdate" title="TSSslTicketKeyUpdate"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslTicketKeyUpdate()</span></code></a></p></li>
</ul>
</div>
<div class="section" id="example-use-case">
<h1>Example Use Case<a class="headerlink" href="#example-use-case" title="Permalink to this headline">¶</a></h1>
<p>Consider deploying a set of ATS servers as a farm behind a layer 4 load balancer.  The load balancer does not
guarantee that all the requests from a single client are directed to the same ATS box.  Therefore, to maximize TLS session
reuse, the servers should share session state via some external communication library like redis or rabbitmq.</p>
<p>To do this, they write a plugin that sets the <a class="reference internal" href="#c.TS_SSL_SESSION_HOOK" title="TS_SSL_SESSION_HOOK"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TS_SSL_SESSION_HOOK</span></code></a>.  When the hook is triggered, the plugin function sends the
updated session state to the other ATS servers via the communication library.</p>
<p>The plugin also has thread that listens for updates and calls <a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionInsert" title="TSSslSessionInsert"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionInsert()</span></code></a> and <a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionRemove" title="TSSslSessionRemove"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionRemove()</span></code></a> to update the local session cache accordingly.</p>
<p>The plugin can also engage in a protocol to periodically update the session ticket encryption key and communicate the new key to its
peers.  The plugin calls <a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslTicketKeyUpdate" title="TSSslTicketKeyUpdate"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslTicketKeyUpdate()</span></code></a> to update the local ATS process with the newest keys and the last N keys.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="trafficserver-timers.en.html" class="btn btn-neutral float-right" title="HTTP Transaction Timers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ssl-hooks.en.html" class="btn btn-neutral float-left" title="TLS User Agent Hooks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, dev@trafficserver.apache.org

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>
 


</body>
</html>