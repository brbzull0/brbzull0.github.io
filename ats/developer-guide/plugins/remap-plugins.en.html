


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Remap Plugins &mdash; Apache Traffic Server 10.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/override.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="New Protocol Plugins" href="new-protocol-plugins.en.html" />
    <link rel="prev" title="Sample Buffered Null Transform Plugin" href="http-transformations/sample-buffered-null-transformation-plugin.en.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Apache Traffic Server
          

          
            
            <img src="../../_static/trans_logo_tm_380x69.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.en.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction/index.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release-process/index.en.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributing/index.en.html">Contributing to Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing-with-vagrant/index.en.html">Using Vagrant to Test Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debugging/index.en.html">Debugging and Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../threads-and-events.en.html">Threads and Event Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cache-architecture/index.en.html">Cache Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging-architecture/index.en.html">Logging Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internal-libraries/index.en.html">Internal libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.en.html">Plugin Development</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.en.html">Plugin Development Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="building-plugins.en.html">Building Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="configuration.en.html">Plugin Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin-management/index.en.html">Plugin Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="actions/index.en.html">Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="hooks-and-transactions/index.en.html">Hooks and Transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="continuations/index.en.html">Continuations</a></li>
<li class="toctree-l3"><a class="reference internal" href="mutexes.en.html">Mutexes</a></li>
<li class="toctree-l3"><a class="reference internal" href="io/index.en.html">IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="http-headers/index.en.html">HTTP Headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="http-transformations/index.en.html">HTTP Transformations</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Remap Plugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initialization">Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#runtime">Runtime</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cleanup">Cleanup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="new-protocol-plugins.en.html">New Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin-interfaces.en.html">Plugin Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="adding-statistics.en.html">Adding Statistics</a></li>
<li class="toctree-l3"><a class="reference internal" href="example-plugins/index.en.html">Example Plugins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../config-vars.en.html">Configuration Variable Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/index.en.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../continuous-integration/index.en.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../documentation/index.en.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../host-resolution-proposal.en.html">Host Resolution Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../client-session-architecture.en.html">An Overview Client Sessions and Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core-architecture/index.en.html">Core Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design-documents/index.en.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layout/index.en.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../testing/index.en.html">Testing Traffic Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/index.en.html">Appendices</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apache Traffic Server</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.en.html">Developer’s Guide</a> &raquo;</li>
        
          <li><a href="index.en.html">Plugin Development</a> &raquo;</li>
        
      <li>Remap Plugins</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/developer-guide/plugins/remap-plugins.en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="remap-plugins">
<span id="developer-plugins-remap"></span><h1>Remap Plugins<a class="headerlink" href="#remap-plugins" title="Permalink to this headline">¶</a></h1>
<p>Remap plugins are called during remap (URL rewriting). The particular plugins and the order is
determined by the remap rule. The <a class="reference internal" href="../../admin-guide/files/remap.config.en.html#std-configfile-remap.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">remap.config</span></code></a> file can contain explicit references to
remap plugins in a rule and the presence of such a reference in a rule causes the plugin to be
invoked when the rule is matched. For example, a rule such as</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>map http://example.one/ http://example.two/ @plugin=example.so @pparam=first_arg @pparm=second_arg
</pre></div>
</div>
<p>will, if matched, cause the plugin “example.so” to be called with parameters <cite>http://example.one/</cite>,
<cite>http://example.two/</cite>, “first_arg” and “second_arg”. Please keep in mind that “from” URL and “to” URL
will be converted to their canonical view.</p>
<p>A key difference between global and remap plugins is reconfiguration and reloading. If
<a class="reference internal" href="../../admin-guide/files/remap.config.en.html#std-configfile-remap.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">remap.config</span></code></a> is reloaded, then all remap plugins are reconfigured based on the new version
of the file. Global plugins need to handle their own configuration reloading, if any.</p>
<p>In addition, as of Traffic Server 9.0, remap plugins can be reloaded during runtime. During a
<a class="reference internal" href="../../admin-guide/files/remap.config.en.html#std-configfile-remap.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">remap.config</span></code></a> reload, if the plugin image file has changed, a new one is loaded and used.</p>
<p>All of the externally invoked functions must be declared as <code class="code docutils literal notranslate"><span class="pre">extern</span> <span class="pre">&quot;C&quot;</span></code> in order to be
correctly located by the Traffic Server core. This is already done if <a class="reference external" href="https://github.com/apache/trafficserver/blob/master/include/ts/remap.h">include/ts/remap.h</a>
is included, otherwise it must be done explicitly.</p>
<div class="section" id="initialization">
<h2>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h2>
<p>If any rule uses a plugin, the remap configuration loading will load the dynamic library and then
call <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapInit" title="TSRemapInit"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapInit()</span></code></a>. The plugin must return <a class="reference internal" href="../api/types/TSReturnCode.en.html#c.TS_SUCCESS" title="TS_SUCCESS"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TS_SUCCESS</span></code></a> or the configuration loading
will fail. If there is an error during the invocation of this function a C string style message
should be placed in <em>errbuff</em>, taking note of the maximum size of the buffer passed in
<em>errbuff_size</em>. The message is checked if the function returns a value other than
<a class="reference internal" href="../api/types/TSReturnCode.en.html#c.TS_SUCCESS" title="TS_SUCCESS"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TS_SUCCESS</span></code></a>.</p>
<p>If <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapInit" title="TSRemapInit"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapInit()</span></code></a> returns <a class="reference internal" href="../api/types/TSReturnCode.en.html#c.TS_ERROR" title="TS_ERROR"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TS_ERROR</span></code></a> then the remap configuration loading
is aborted immediately.</p>
<p>This function should perform any plugin global initialization, such as setting up static data
tables. It only be called immediately after the dynamic library is loaded from disk.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>For each plugin invocation in a remap rule, <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a> is called.</p>
<p>The parameters <em>argc</em>, <em>argv</em> specify an array of arguments to the invocation instance in
the standard way. <em>argc</em> is the number of arguments present and <em>argv</em> is an array of
pointers, each of which points to a plugin parameter. The number of valid elements is <em>argc</em>.
Note these pointers are valid only for the duration of the function call. If any part of them need
persistent storage, that must be provided by the plugin.</p>
<p><em>ih</em> is for invocation instance storage data. This initially points at a <code class="code docutils literal notranslate"><span class="pre">nullptr</span></code>. If
that pointer is updated the new value will be preserved and passed back to the plugin in later
callbacks. This enables it to serve to identify which particular rule was matched and provide
context data. The standard use is to allocate a class instance, store rule relevant context data in
that instance, and update <em>ih</em> to point at the instance. The most common data is that derived
from the invocation arguments passed in <em>argc</em>, <em>argv</em>.</p>
<p><em>errbuff</em> and <em>errbuff_size</em> specify a writeable buffer used to report errors. Error
messages must be C strings and must fit in the buffer, including the terminating null.</p>
<p>In essence, <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a> is called to create an invocation instance for the plugin to
store rule local data. If the plugin is invoked multiples time on a rule, this will be called
multiple times for the rule, once for each invocation. Only the value store in <em>ih</em> will be
available when the rule is actually matched. In particular the plugin arguments will not be
available.</p>
<p>Calls to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a> are guaranteed to be serialized. All calls to
<a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a> for a given new configuration are guaranteed to be called and
completed before any calls to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapDoRemap" title="TSRemapDoRemap"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapDoRemap()</span></code></a>.</p>
<p>If there is an error then the callback should return <a class="reference internal" href="../api/types/TSReturnCode.en.html#c.TS_ERROR" title="TS_ERROR"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TS_ERROR</span></code></a> and fill in the
<em>errbuff</em> with a C-string describing the error. Otherwise the function must return
<a class="reference internal" href="../api/types/TSReturnCode.en.html#c.TS_SUCCESS" title="TS_SUCCESS"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TS_SUCCESS</span></code></a>.</p>
<p>If <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a> returns <a class="reference internal" href="../api/types/TSReturnCode.en.html#c.TS_ERROR" title="TS_ERROR"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TS_ERROR</span></code></a> then the remap configuration loading
is aborted immediately.</p>
<div class="section" id="configuration-reload-notifications">
<h3>Configuration reload notifications<a class="headerlink" href="#configuration-reload-notifications" title="Permalink to this headline">¶</a></h3>
<p>Most of the plugins is assumed to use per-plugin-instance data-structures when reloading their
configs and only a few of them that wish to optimize performance or deal with the complexities
of using a per-plugin DSO “global” data-structures would use plugin configuration reload
notifications like <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPreConfigReload" title="TSRemapPreConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPreConfigReload()</span></code></a> and <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPostConfigReload" title="TSRemapPostConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPostConfigReload()</span></code></a>.</p>
<p>Instead of trying to foresee the needs or the expectations of each use-case, a more “open-ended”
and straight-forward design was chosen for the configuration reload notifications.
The notifications are broadcast to all loaded plugins at the moments before and after
the reload attempt, regardless of whether a plugin is part of the new configuration or not.</p>
<p><a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPreConfigReload" title="TSRemapPreConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPreConfigReload()</span></code></a> is called <em>before</em> the parsing of a new remap configuration starts
to notify plugins of the coming configuration reload. It is called on all already loaded plugins,
invoked by current and all previous still used configurations. This is an optional entry point.</p>
<p><a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPostConfigReload" title="TSRemapPostConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPostConfigReload()</span></code></a> is called to indicate the end of the new remap configuration
load. It is called on the newly and previously loaded plugins, invoked by the new, current and
previous still used configurations. It also indicates whether the configuration reload was successful
by passing <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapReloadStatus.TSREMAP_CONFIG_RELOAD_FAILURE" title="TSREMAP_CONFIG_RELOAD_FAILURE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TSREMAP_CONFIG_RELOAD_FAILURE</span></code></a> in case of failure and to notify the plugins if they
are going to be part of the new configuration by passing <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapReloadStatus.TSREMAP_CONFIG_RELOAD_SUCCESS_PLUGIN_USED" title="TSREMAP_CONFIG_RELOAD_SUCCESS_PLUGIN_USED"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TSREMAP_CONFIG_RELOAD_SUCCESS_PLUGIN_USED</span></code></a>
or <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapReloadStatus.TSREMAP_CONFIG_RELOAD_SUCCESS_PLUGIN_UNUSED" title="TSREMAP_CONFIG_RELOAD_SUCCESS_PLUGIN_UNUSED"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TSREMAP_CONFIG_RELOAD_SUCCESS_PLUGIN_UNUSED</span></code></a>. This is an optional entry point.</p>
<p>These calls are called per <em>plugin</em>, not per invocation of the plugin in <a class="reference internal" href="../../admin-guide/files/remap.config.en.html#std-configfile-remap.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">remap.config</span></code></a>
and only will be called if the plugin was instantiated by at least one configuration loaded
after the traffic server started and at least one configuration using it is still loaded.</p>
<p><a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPreConfigReload" title="TSRemapPreConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPreConfigReload()</span></code></a> will be called serially for all loaded plugins
before any call to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a> during parsing of the new configuration.</p>
<p><a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPostConfigReload" title="TSRemapPostConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPostConfigReload()</span></code></a> will be called serially for all plugins after
all calls to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a> during parsing of the new configuration.</p>
<p>The intention of these callbacks can be demonstrated with the following use-case.
A plugin could use <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPreConfigReload" title="TSRemapPreConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPreConfigReload()</span></code></a> as a signal to drop (or allocate) temporary
per plugin data structures. These structures can be created (or updated) as needed
when a plugin invocation instance is loaded (<a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a> is called).
Then it could be used in subsequent invocation instances loading. After the configuration
reload is done <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPostConfigReload" title="TSRemapPostConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPostConfigReload()</span></code></a> could be used to confirm the data
structures update if reload was successful, recover / clean-up after a failed
reload attempt, or if so wishes to ignore the notification if plugin is not part
of the new configuration..</p>
</div>
</div>
<div class="section" id="runtime">
<h2>Runtime<a class="headerlink" href="#runtime" title="Permalink to this headline">¶</a></h2>
<p>At runtime, if a remap rule is matched, the plugin is invoked by calling <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapDoRemap" title="TSRemapDoRemap"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapDoRemap()</span></code></a>.
This function is responsible for performing the plugin operation for the transaction.</p>
<p><em>ih</em> is the same value set in <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a> for the invocation instance. This is
not examined or checked by the core. <em>rh</em> is the transaction for which the rule matched.
<em>rri</em> is information about the rule and the transaction.</p>
<p>The callback is required to return a <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapStatus" title="TSRemapStatus"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSRemapStatus</span></code></a> indicating whether it performed a remap.
This is used for verifying a request was remapped if remapping is required. This can also be used
to prevent further remapping, although this should be used with caution.</p>
<p>Calls to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapDoRemap" title="TSRemapDoRemap"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapDoRemap()</span></code></a> are not serialized, they can be concurrent, even for the same
invocation instance. However, the callbacks for a single rule for a single transaction are
serialized in the order the plugins are invoked in the rule.</p>
<p>No calls to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapDoRemap" title="TSRemapDoRemap"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapDoRemap()</span></code></a> will occur before <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPostConfigReload" title="TSRemapPostConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPostConfigReload()</span></code></a> for
all plugin instances invoked by the new configuration.</p>
<p>The old configurations, if any, are still active during the calls to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPreConfigReload" title="TSRemapPreConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPreConfigReload()</span></code></a>
and <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapPreConfigReload" title="TSRemapPreConfigReload"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapPreConfigReload()</span></code></a> and therefore calls to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapDoRemap" title="TSRemapDoRemap"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapDoRemap()</span></code></a> may occur
concurrently with those functions.</p>
</div>
<div class="section" id="cleanup">
<h2>Cleanup<a class="headerlink" href="#cleanup" title="Permalink to this headline">¶</a></h2>
<p>When a new <a class="reference internal" href="../../admin-guide/files/remap.config.en.html#std-configfile-remap.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">remap.config</span></code></a> is loaded successfully, the prior configuration is cleaned up. For
each call to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a> a corresponding call to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapDeleteInstance" title="TSRemapDeleteInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapDeleteInstance()</span></code></a> is
called. The only argument is the invocation instance handle, originally provided by the plugin to
<a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapNewInstance" title="TSRemapNewInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapNewInstance()</span></code></a>. This is expected to suffice for the plugin to clean up any rule specific
data. Calls to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapDeleteInstance" title="TSRemapDeleteInstance"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapDeleteInstance()</span></code></a> will be serial for all plugin invocations in a
remap configuration.</p>
<p>If no rule uses a plugin, it may be unloaded. In that case <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapDone" title="TSRemapDone"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapDone()</span></code></a> is called. This is
an optional entry point, a plugin is not required to provide it. It corresponds to <a class="reference internal" href="../api/functions/TSRemap.en.html#c.TSRemapInit" title="TSRemapInit"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSRemapInit()</span></code></a>.
It is called once per plugin, not per plugin invocation.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="new-protocol-plugins.en.html" class="btn btn-neutral float-right" title="New Protocol Plugins" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="http-transformations/sample-buffered-null-transformation-plugin.en.html" class="btn btn-neutral float-left" title="Sample Buffered Null Transform Plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, dev@trafficserver.apache.org.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>
 


</body>
</html>