


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Accessing the Transaction Being Processed &mdash; Apache Traffic Server 10.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/override.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Setting Up a Transaction Hook" href="setting-up-a-transaction-hook.en.html" />
    <link rel="prev" title="Setting a Global Hook" href="setting-a-global-hook.en.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Apache Traffic Server
          

          
            
            <img src="../../../../_static/trans_logo_tm_380x69.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.en.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../introduction/index.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../release-process/index.en.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/index.en.html">Contributing to Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../testing-with-vagrant/index.en.html">Using Vagrant to Test Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../debugging/index.en.html">Debugging and Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../threads-and-events.en.html">Threads and Event Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cache-architecture/index.en.html">Cache Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../logging-architecture/index.en.html">Logging Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../internal-libraries/index.en.html">Internal libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.en.html">Plugin Development</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../introduction.en.html">Plugin Development Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../building-plugins.en.html">Building Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../configuration.en.html">Plugin Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../plugin-management/index.en.html">Plugin Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../actions/index.en.html">Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hooks-and-transactions/index.en.html">Hooks and Transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../continuations/index.en.html">Continuations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../mutexes.en.html">Mutexes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../io/index.en.html">IO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../http-headers/index.en.html">HTTP Headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../http-transformations/index.en.html">HTTP Transformations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../remap-plugins.en.html">Remap Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../new-protocol-plugins.en.html">New Protocol Plugins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../plugin-interfaces.en.html">Plugin Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../adding-statistics.en.html">Adding Statistics</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.en.html">Example Plugins</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../basic-authorization/index.en.html">Basic Authorization Plugin</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.en.html">Denylist Plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../query_remap/index.en.html">Query Remap Plugin</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tls_bridge.en.html">TLS Bridge</a></li>
<li class="toctree-l4"><a class="reference internal" href="../index.en.html#header-based-plugin-examples">Header-Based Plugin Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../config-vars.en.html">Configuration Variable Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/index.en.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../continuous-integration/index.en.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../documentation/index.en.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../host-resolution-proposal.en.html">Host Resolution Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../client-session-architecture.en.html">An Overview Client Sessions and Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../core-architecture/index.en.html">Core Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../design-documents/index.en.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../layout/index.en.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../testing/index.en.html">Testing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../jsonrpc/index.en.html">JSONRPC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../appendices/index.en.html">Appendices</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Apache Traffic Server</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.en.html">Developer’s Guide</a> &raquo;</li>
        
          <li><a href="../../index.en.html">Plugin Development</a> &raquo;</li>
        
          <li><a href="../index.en.html">Example Plugins</a> &raquo;</li>
        
          <li><a href="index.en.html">Denylist Plugin</a> &raquo;</li>
        
      <li>Accessing the Transaction Being Processed</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/developer-guide/plugins/example-plugins/denylist/accessing-the-transaction-being-processed.en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="accessing-the-transaction-being-processed">
<span id="developer-plugins-denylist-access-process-txn"></span><h1>Accessing the Transaction Being Processed<a class="headerlink" href="#accessing-the-transaction-being-processed" title="Permalink to this headline">¶</a></h1>
<p>A continuation’s handler function is of type <code class="docutils literal notranslate"><span class="pre">TSEventFunc</span></code>; the
prototype is as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">static</span> <span class="pre">int</span> <span class="pre">function_name</span> <span class="pre">(TSCont</span> <span class="pre">contp,</span> <span class="pre">TSEvent</span> <span class="pre">event,</span> <span class="pre">void</span> <span class="pre">*edata)</span></code></p>
<p>In general, the return value of the handler function is not used. The
continuation argument is the continuation being called back, the event
is the event being sent to the continuation, and the data pointed to by
<code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*edata</span></code> depends on the type of event. The data types for each
event type are listed in <a class="reference internal" href="../../continuations/writing-handler-functions.en.html"><span class="doc">Writing Handler
Functions</span></a></p>
<p>The key here is that if the event is an HTTP transaction event, then the
data passed to the continuation’s handler is of type <code class="docutils literal notranslate"><span class="pre">TSHttpTxn</span></code> (a
data type that represents HTTP transactions). Your plugin can then do
things with the transaction. Here’s how it looks in the code for the
Denylist plugin’s handler:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">int</span>
<span class="nf">denylist_plugin</span> <span class="p">(</span><span class="n">TSCont</span> <span class="n">contp</span><span class="p">,</span> <span class="n">TSEvent</span> <span class="n">event</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">edata</span><span class="p">)</span>
<span class="p">{</span>
   <span class="n">TSHttpTxn</span> <span class="n">txnp</span> <span class="o">=</span> <span class="p">(</span><span class="n">TSHttpTxn</span><span class="p">)</span> <span class="n">edata</span><span class="p">;</span>
   <span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="nl">TS_EVENT_HTTP_OS_DNS</span><span class="p">:</span>
         <span class="n">handle_dns</span> <span class="p">(</span><span class="n">txnp</span><span class="p">,</span> <span class="n">contp</span><span class="p">);</span>
         <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">case</span> <span class="nl">TS_EVENT_HTTP_SEND_RESPONSE_HDR</span><span class="p">:</span>
         <span class="n">handle_response</span> <span class="p">(</span><span class="n">txnp</span><span class="p">);</span>
         <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">default</span><span class="o">:</span>
         <span class="k">break</span><span class="p">;</span>
   <span class="p">}</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example: when the origin server DNS lookup event is sent,
<code class="docutils literal notranslate"><span class="pre">denylist_plugin</span></code> can call <code class="docutils literal notranslate"><span class="pre">handle_dns</span></code>and pass <code class="docutils literal notranslate"><span class="pre">txnp</span></code> as an
argument.</p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="setting-up-a-transaction-hook.en.html" class="btn btn-neutral float-right" title="Setting Up a Transaction Hook" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="setting-a-global-hook.en.html" class="btn btn-neutral float-left" title="Setting a Global Hook" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, dev@trafficserver.apache.org.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>
 


</body>
</html>