

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TSIOBufferCreate &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/override.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="TSIOBufferReader" href="TSIOBufferReader.en.html" />
    <link rel="prev" title="TSIOBufferCopy" href="TSIOBufferCopy.en.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="tsiobuffercreate">
<h1>TSIOBufferCreate<a class="headerlink" href="#tsiobuffercreate" title="Permalink to this headline">¶</a></h1>
<p>Traffic Server IO buffer API.</p>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ts/ts.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<dl class="function">
<dt id="c.TSIOBufferCreate">
<a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer">TSIOBuffer</a> <code class="descname">TSIOBufferCreate</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.TSIOBufferCreate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="c.TSIOBufferSizedCreate">
<a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer">TSIOBuffer</a> <code class="descname">TSIOBufferSizedCreate</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSIOBufferSizeIndex" title="TSIOBufferSizeIndex">TSIOBufferSizeIndex</a><em>&nbsp;index</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSIOBufferSizedCreate" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="c.TSIOBufferDestroy">
void <code class="descname">TSIOBufferDestroy</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer">TSIOBuffer</a><em>&nbsp;bufp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSIOBufferDestroy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="c.TSIOBufferWrite">
int64_t <code class="descname">TSIOBufferWrite</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer">TSIOBuffer</a><em>&nbsp;bufp</em>, const void *<em>&nbsp;buf</em>, int64_t<em>&nbsp;length</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSIOBufferWrite" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="c.TSIOBufferProduce">
void <code class="descname">TSIOBufferProduce</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer">TSIOBuffer</a><em>&nbsp;bufp</em>, int64_t<em>&nbsp;nbytes</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSIOBufferProduce" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="c.TSIOBufferWaterMarkGet">
int64_t <code class="descname">TSIOBufferWaterMarkGet</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer">TSIOBuffer</a><em>&nbsp;bufp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSIOBufferWaterMarkGet" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="c.TSIOBufferWaterMarkSet">
void <code class="descname">TSIOBufferWaterMarkSet</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer">TSIOBuffer</a><em>&nbsp;bufp</em>, int64_t<em>&nbsp;water_mark</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSIOBufferWaterMarkSet" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSIOBuffer</span></code></a> data structure is the building block of the
<a class="reference internal" href="TSTypes.en.html#c.TSVConn" title="TSVConn"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSVConn</span></code></a>
abstraction. An IO buffer is composed of a list of buffer blocks which
are reference counted so that they can reside in multiple buffers at the
same time. This makes it extremely efficient to copy data from one IO
buffer to another using <a class="reference internal" href="TSIOBufferCopy.en.html#c.TSIOBufferCopy" title="TSIOBufferCopy"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSIOBufferCopy()</span></code></a> since Traffic Server only needs to
copy pointers and adjust reference counts appropriately and not actually
copy any data. However, applications should still strive to ensure data
blocks are a reasonable size.</p>
<p>The IO buffer abstraction provides for a single writer and multiple
readers. In order for the readers to have no knowledge of each
other, they manipulate IO buffers through the <a class="reference internal" href="TSTypes.en.html#c.TSIOBufferReader" title="TSIOBufferReader"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSIOBufferReader</span></code></a>
data structure. Since only a single writer is allowed, there is no
corresponding <cite>TSIOBufferWriter</cite> data structure. The writer
simply modifies the IO buffer directly.</p>
<p><a class="reference internal" href="#c.TSIOBufferCreate" title="TSIOBufferCreate"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSIOBufferCreate()</span></code></a> creates an empty <a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSIOBuffer</span></code></a>.</p>
<p><a class="reference internal" href="#c.TSIOBufferSizedCreate" title="TSIOBufferSizedCreate"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSIOBufferSizedCreate()</span></code></a> creates an empty <a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSIOBuffer</span></code></a>
with an initial capacity of <em>index</em> bytes.</p>
<p><a class="reference internal" href="#c.TSIOBufferDestroy" title="TSIOBufferDestroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSIOBufferDestroy()</span></code></a> destroys the IO buffer <em>bufp</em>. Since multiple IO
buffers can share data, this does not necessarily free all of the data
associated with the IO buffer but simply decrements the appropriate reference counts.</p>
<p><a class="reference internal" href="#c.TSIOBufferWrite" title="TSIOBufferWrite"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSIOBufferWrite()</span></code></a> appends <em>length</em> bytes from the buffer <em>buf</em> to the IO
buffer <em>bufp</em> and returns the number of bytes successfully written into the
IO buffer.</p>
<p><a class="reference internal" href="#c.TSIOBufferProduce" title="TSIOBufferProduce"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSIOBufferProduce()</span></code></a> makes <em>nbytes</em> of data available for reading in the IO
buffer <em>bufp</em>. A common pattern for writing to an IO buffer is to copy
data into a buffer block and then call INKIOBufferProduce to make the new
data visible to any readers.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The above references an old API function: INKIOBufferProduce and needs to
be fixed. I don’t see a TSIOBufferProduce function that would be its
obvious replacement from the Ink-&gt;TS rename.</p>
</div>
<p>The watermark of an <a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSIOBuffer</span></code></a> is the minimum number of bytes of data
that have to be in the buffer before calling back any continuation that
has initiated a read operation on this buffer. As a writer feeds data
into the <a class="reference internal" href="TSTypes.en.html#c.TSIOBuffer" title="TSIOBuffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSIOBuffer</span></code></a>, no readers are called back until the amount of data
reaches the watermark. Setting a watermark can improve performance
because it avoids frequent callbacks to read small amounts of data.
<a class="reference internal" href="#c.TSIOBufferWaterMarkGet" title="TSIOBufferWaterMarkGet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSIOBufferWaterMarkGet()</span></code></a> gets the current watermark for the IO buffer
<em>bufp</em>.</p>
<p><a class="reference internal" href="#c.TSIOBufferWaterMarkSet" title="TSIOBufferWaterMarkSet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSIOBufferWaterMarkSet()</span></code></a> gets the current watermark for the IO buffer
<em>bufp</em> to <em>water_mark</em> bytes.</p>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><em class="manpage">TSAPI(3ts)</em>,
<em class="manpage">TSIOBufferReaderAlloc(3ts)</em></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.en.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release-process/index.en.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/index.en.html">Contributing to Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing-with-vagrant/index.en.html">Using Vagrant to Test Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debugging/index.en.html">Debugging and Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../threads-and-events.en.html">Threads and Event Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cache-architecture/index.en.html">Cache Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging-architecture/index.en.html">Logging Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-libraries/index.en.html">Internal libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.en.html">Plugin Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config-vars.en.html">Configuration Variable Implementation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.en.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../continuous-integration/index.en.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/index.en.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../host-resolution-proposal.en.html">Host Resolution Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client-session-architecture.en.html">An Overview Client Sessions and Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core-architecture/index.en.html">Core Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../design-documents/index.en.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../layout/index.en.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.en.html">Testing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonrpc/index.en.html">JSONRPC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.en.html">Developer’s Guide</a><ul>
  <li><a href="../index.en.html">API Reference</a><ul>
  <li><a href="index.en.html">API Functions</a><ul>
      <li>Previous: <a href="TSIOBufferCopy.en.html" title="previous chapter">TSIOBufferCopy</a></li>
      <li>Next: <a href="TSIOBufferReader.en.html" title="next chapter">TSIOBufferReader</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/developer-guide/api/functions/TSIOBufferCreate.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>