

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TSHttpConnectWithPluginId &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/override.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="TSHttpHdrClone" href="TSHttpHdrClone.en.html" />
    <link rel="prev" title="TSHttpConnect" href="TSHttpConnect.en.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="tshttpconnectwithpluginid">
<h1>TSHttpConnectWithPluginId<a class="headerlink" href="#tshttpconnectwithpluginid" title="Permalink to this headline">¶</a></h1>
<p>Allows the plugin to initiate an http connection. This will tag the
HTTP state machine with extra data that can be accessed by the
logging interface. The connection is treated as an HTTP transaction
as if it came from a client.</p>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ts/ts.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<dl class="function">
<dt id="c.TSHttpConnectWithPluginId">
<a class="reference internal" href="TSTypes.en.html#c.TSVConn" title="TSVConn">TSVConn</a> <code class="descname">TSHttpConnectWithPluginId</code><span class="sig-paren">(</span>sockaddr const *<em>&nbsp;addr</em>, char const *<em>&nbsp;tag</em>, int64_t<em>&nbsp;id</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSHttpConnectWithPluginId" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This call attempts to create an HTTP state machine and a virtual
connection to that state machine. This is more efficient than using
<a class="reference internal" href="TSNetConnect.en.html#c.TSNetConnect" title="TSNetConnect"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSNetConnect()</span></code></a> because it avoids using the operating system
stack via the loopback interface.</p>
<dl class="docutils">
<dt><em>addr</em></dt>
<dd>This is the network address of the target of the connection.
This includes the port which should be stored in the <code class="xref c c-type docutils literal notranslate"><span class="pre">sockaddr</span></code>
structure pointed at by <em>addr</em>.</dd>
<dt><em>tag</em></dt>
<dd>This is a tag that is passed through to the HTTP state machine.
It must be a persistent string that has a lifetime longer than
the connection. It is accessible via the log field <a class="reference internal" href="../../../admin-guide/logging/formatting.en.html#pitag"><span class="std std-ref">pitag</span></a>. This is intended as a class or type identifier that
is consistent across all connections for this plugin. In effect,
the name of the plugin. This can be <code class="docutils literal notranslate"><span class="pre">NULL</span></code>.</dd>
<dt><em>id</em></dt>
<dd>This is a numeric identifier that is passed through to the HTTP
state machine. It is accessible via the log field <a class="reference internal" href="../../../admin-guide/logging/formatting.en.html#piid"><span class="std std-ref">piid</span></a>. This is intended as a connection identifier and should
be distinct for every call to <a class="reference internal" href="#c.TSHttpConnectWithPluginId" title="TSHttpConnectWithPluginId"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSHttpConnectWithPluginId()</span></code></a>.
The easiest mechanism is to define a plugin global value and
increment it for each connection. The value <code class="docutils literal notranslate"><span class="pre">0</span></code> is
reserved to mean “not set” and can be used as a default if this
functionality is not needed.</dd>
</dl>
<p>The virtual connection returned as the <a class="reference internal" href="TSTypes.en.html#c.TSVConn" title="TSVConn"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSVConn</span></code></a> is API
equivalent to a network virtual connection both to the plugin and
to internal mechanisms. Data is read and written to the connection
(and thence to the target system) by reading and writing on this
virtual connection.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This function only opens the connection. To drive the transaction an actual
HTTP request must be sent and the HTTP response handled. The transaction is
handled as a standard HTTP transaction and all of the standard configuration
options and plugins will operate on it.</p>
</div>
<p>The combination of <em>tag</em> and <em>id</em> is intended to enable correlation
in log post processing. The <em>tag</em> identifies the connection as related
to the plugin and the <em>id</em> can be used in conjunction with plugin
generated logs to correlate the log records.</p>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<p>The H2 implementation uses this to correlate client sessions
with H2 streams. Each client connection is assigned a distinct
numeric identifier. This is passed as the <em>id</em> to
<a class="reference internal" href="#c.TSHttpConnectWithPluginId" title="TSHttpConnectWithPluginId"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSHttpConnectWithPluginId()</span></code></a>. The <em>tag</em> is selected
to be the NPN string for the client session protocol, e.g.
“h2”. Log post processing can then count the number of connections for the
various supported protocols and the number of H2 virtual streams for each
real client connection to Traffic Server.</p>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><em class="manpage">TSHttpConnect(3ts)</em>,
<em class="manpage">TSNetConnect(3ts)</em>,
<em class="manpage">TSAPI(3ts)</em></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.en.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release-process/index.en.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/index.en.html">Contributing to Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing-with-vagrant/index.en.html">Using Vagrant to Test Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debugging/index.en.html">Debugging and Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../threads-and-events.en.html">Threads and Event Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cache-architecture/index.en.html">Cache Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging-architecture/index.en.html">Logging Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-libraries/index.en.html">Internal libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.en.html">Plugin Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config-vars.en.html">Configuration Variable Implementation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.en.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../continuous-integration/index.en.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/index.en.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../host-resolution-proposal.en.html">Host Resolution Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client-session-architecture.en.html">An Overview Client Sessions and Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core-architecture/index.en.html">Core Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../design-documents/index.en.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../layout/index.en.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.en.html">Testing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonrpc/index.en.html">JSONRPC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.en.html">Developer’s Guide</a><ul>
  <li><a href="../index.en.html">API Reference</a><ul>
  <li><a href="index.en.html">API Functions</a><ul>
      <li>Previous: <a href="TSHttpConnect.en.html" title="previous chapter">TSHttpConnect</a></li>
      <li>Next: <a href="TSHttpHdrClone.en.html" title="next chapter">TSHttpHdrClone</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/developer-guide/api/functions/TSHttpConnectWithPluginId.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>