<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1099px" preserveAspectRatio="none" style="width:1602px;height:1099px;" version="1.1" viewBox="0 0 1602 1099" width="1602px" zoomAndPan="magnify"><defs><filter height="300%" id="fyoqwvhtnydpn" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--cluster traffic_manager--><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="1064" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="762" x="828" y="24"/><rect fill="#FFFFFF" height="1015.4063" rx="12.5" ry="12.5" style="stroke: #FFFFFF; stroke-width: 1.0;" width="756" x="831" y="69.5938"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="828" x2="1590" y1="66.5938" y2="66.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1161.5" y="40.9951">LocalManager</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="270" x="1074" y="57.292">runs in traffic_manager main event loop</text><!--cluster traffic_server--><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="734" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="596" x="22" y="142"/><rect fill="#FFFFFF" height="685.4063" rx="12.5" ry="12.5" style="stroke: #FFFFFF; stroke-width: 1.0;" width="590" x="25" y="187.5938"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="22" x2="618" y1="184.5938" y2="184.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="262" y="158.9951">ProcessManager</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="342" x="149" y="175.292">runs in processManagerThread from traffic_server</text><ellipse cx="1164" cy="85" fill="#000000" filter="url(#fyoqwvhtnydpn)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><ellipse cx="1209" cy="1062" fill="none" filter="url(#fyoqwvhtnydpn)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="1209.5" cy="1062.5" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="207.2969" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="325" x="1001.5" y="244.5"/><rect fill="#FFFFFF" height="175" rx="12.5" ry="12.5" style="stroke: #FFFFFF; stroke-width: 1.0;" width="319" x="1004.5" y="273.7969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1001.5" x2="1326.5" y1="270.7969" y2="270.7969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="142" x="1093" y="262.4951">processEventQueue</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="164" x="1129.5" y="283.7969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1129.5" x2="1293.5" y1="310.0938" y2="310.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="1163" y="301.792">dequeue msg</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="28" x="1134.5" y="326.2324">from</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="112" x="1166.5" y="326.2324">mgmt_event_queue</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="184" x="1012.5" y="386.7969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1012.5" x2="1196.5" y1="413.0938" y2="413.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="164" x="1022.5" y="404.792">send msg to processes</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="154" x="1017.5" y="429.2324">sendMgmtMsgToProcesses</text><ellipse cx="1244.5" cy="411.7969" fill="none" filter="url(#fyoqwvhtnydpn)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="1245" cy="412.2969" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><!--link tm_dequeue to *end*tm_process_events--><path d="M1219.4,333.9869 C1225.85,353.7069 1234.71,380.8369 1240,397.0169 " fill="none" id="tm_dequeue-*end*tm_process_events" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1241.65,402.0669,1242.6518,392.2691,1240.0946,397.315,1235.0487,394.7578,1241.65,402.0669" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="1230.5" y="364.8638">empty</text><!--link tm_dequeue to tm_send_events--><path d="M1129.36,321.4469 C1112.6,327.7369 1096.92,337.2969 1086.5,351.7969 C1080.1,360.6969 1081.7,371.9069 1085.91,382.1569 " fill="none" id="tm_dequeue-tm_send_events" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1088.02,386.7869,1087.9256,376.9385,1085.9456,382.2375,1080.6466,380.2575,1088.02,386.7869" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1087.5" y="364.8638">based on msg_id</text><!--link tm_dequeue to tm_send_events--><path d="M1209.88,338.8269 C1208.02,349.2169 1204.41,360.4269 1197.5,368.7969 C1191.75,375.7669 1184.6,381.6269 1176.84,386.5369 " fill="none" id="tm_dequeue-tm_send_events" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1210.65,333.8069,1205.3334,342.0975,1209.8929,338.7492,1213.2412,343.3088,1210.65,333.8069" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="366.2969" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="729" x="844.5" y="564"/><rect fill="#FFFFFF" height="334" rx="12.5" ry="12.5" style="stroke: #FFFFFF; stroke-width: 1.0;" width="723" x="847.5" y="593.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="844.5" x2="1573.5" y1="590.2969" y2="590.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="163" x="1127.5" y="581.9951">pollMgmtProcessServer</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="1194.5" y="603.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1194.5" x2="1291.5" y1="629.5938" y2="629.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="1205.5" y="621.292">poll socket</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="77" x="1199.5" y="645.7324">mgmt_select</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="78.2031" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="198" x="1004" y="706.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1004" x2="1202" y1="732.5938" y2="732.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="111" x="1047.5" y="724.292">new connection</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="178" x="1009" y="748.7324">register new client socket fd</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="1009" y="762.7012">to start getting msgs from</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="34" x="1009" y="776.6699">client</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="192" x="1234" y="720.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1234" x2="1426" y1="746.5938" y2="746.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="1281.5" y="738.292">new message</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="172" x="1239" y="762.7324">new message from process</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="78.2031" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="224" x="1316" y="837.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="1316" x2="1540" y1="863.5938" y2="863.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1387.5" y="855.292">handle msg</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="182" x="1321" y="879.7324">handleMgmtMsgFromProcesses</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="18" x="1507" y="879.7324">will</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="33" x="1321" y="893.7012">often</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="77" x="1358" y="893.7012">signalAlarm</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="82" x="1439" y="893.7012">with received</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="43" x="1321" y="907.6699">msg_id</text><ellipse cx="948" cy="745.2969" fill="none" filter="url(#fyoqwvhtnydpn)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="948.5" cy="745.7969" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="185" x="855.5" y="851.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="855.5" x2="1040.5" y1="877.5938" y2="877.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="899" y="869.292">External Event</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="860.5" y="893.7324">mechanism to stop polling</text><!--link tm_poll_sock to tm_new_process--><path d="M1194.32,632.2369 C1139.54,636.6869 1055.61,647.3069 1036,671.2969 C1027.64,681.5269 1030.32,692.1869 1038.18,702.1069 " fill="none" id="tm_poll_sock-tm_new_process" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1041.57,706.0069,1038.7119,696.5818,1038.3008,702.2237,1032.6589,701.8126,1041.57,706.0069" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="1037" y="684.3638">new process trying to connect</text><!--link tm_poll_sock to tm_new_message--><path d="M1255.19,653.3569 C1261.19,664.3769 1268.88,677.3969 1277,688.2969 C1284.21,697.9669 1292.91,707.7769 1301.16,716.4169 " fill="none" id="tm_poll_sock-tm_new_message" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1304.66,720.0469,1301.2922,710.7917,1301.1893,716.4477,1295.5334,716.3448,1304.66,720.0469" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="1278" y="684.3638">msg from</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1344" y="684.3638">traffic_server</text><!--link tm_poll_sock to *end*tm_poll_ts--><path d="M1194.48,630.0869 C1123.29,632.2769 995.47,640.5269 963,671.2969 C947.14,686.3269 945.68,713.3069 946.52,729.9169 " fill="none" id="tm_poll_sock-*end*tm_poll_ts" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="946.88,735.1269,950.2531,725.8737,946.537,730.1387,942.272,726.4225,946.88,735.1269" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="964" y="684.3638">timed out</text><!--link tm_new_message to tm_handle_msg--><path d="M1330.81,770.4169 C1332.35,785.5569 1336.27,804.8869 1346,819.2969 C1349.39,824.3169 1353.4,829.0169 1357.78,833.3869 " fill="none" id="tm_new_message-tm_handle_msg" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1361.55,836.9869,1357.7923,827.8831,1357.9297,833.5382,1352.2745,833.6756,1361.55,836.9869" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="1347" y="815.3638">based on msg_id</text><!--link tm_poll_sock to tm_handle_msg--><path d="M1296.86,632.2569 C1353.48,636.6369 1437.09,647.1069 1457,671.2969 C1498.79,722.0869 1472.57,755.3869 1457,819.2969 C1455.55,825.2569 1453.35,831.2869 1450.79,837.0669 " fill="none" id="tm_poll_sock-tm_handle_msg" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1291.8,631.8769,1300.478,636.5345,1296.7862,632.2483,1301.0723,628.5566,1291.8,631.8769" style="stroke: #A80036; stroke-width: 1.0;"/><!--link tm_poll_sock to tm_new_process--><path d="M1241.4,658.3469 C1239.55,668.7469 1235.93,679.9469 1229,688.2969 C1221.51,697.3269 1212.27,704.9469 1202.22,711.3669 " fill="none" id="tm_poll_sock-tm_new_process" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1242.18,653.3269,1236.8634,661.6175,1241.4229,658.2692,1244.7712,662.8288,1242.18,653.3269" style="stroke: #A80036; stroke-width: 1.0;"/><!--link *end*tm_poll_ts to tm_ext_event--><path d="M948,760.6969 C948,782.6269 948,824.6369 948,851.2569 " fill="none" id="*end*tm_poll_ts-tm_ext_event" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="948,755.5769,944,764.5769,948,760.5769,952,764.5769,948,755.5769" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="949" y="815.3638">eventfd</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="1009" y="815.3638">trigger</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="310.2969" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="563" x="38.5" y="193"/><rect fill="#FFFFFF" height="278" rx="12.5" ry="12.5" style="stroke: #FFFFFF; stroke-width: 1.0;" width="557" x="41.5" y="222.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="38.5" x2="601.5" y1="219.2969" y2="219.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="123" x="258.5" y="210.9951">pollLMConnection</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="159.5" y="232.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="159.5" x2="298.5" y1="258.5938" y2="258.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="191.5" y="250.292">poll socket</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="119" x="164.5" y="274.7324">mgmt_read_timeout</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="153" x="293.5" y="335.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="293.5" x2="446.5" y1="361.5938" y2="361.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="325" y="353.292">handle event</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="133" x="298.5" y="377.7324">executeMgmtCallback</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="279" x="289.5" y="438.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="289.5" x2="568.5" y1="464.5938" y2="464.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="376.5" y="456.292">send response</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="136" x="294.5" y="480.7324">enqueue response to</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="119" x="434.5" y="480.7324">mgmt_signal_queue</text><ellipse cx="142" cy="360.2969" fill="none" filter="url(#fyoqwvhtnydpn)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="142.5" cy="360.7969" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="185" x="49.5" y="438.2969"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="49.5" x2="234.5" y1="464.5938" y2="464.5938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="93" y="456.292">External Event</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="165" x="54.5" y="480.7324">mechanism to stop polling</text><!--link ts_poll_sock to ts_handle_event--><path d="M223.23,282.5569 C221.91,294.1469 222.64,307.5769 230,317.2969 C244.03,335.8269 265.94,346.4669 288.29,352.4969 " fill="none" id="ts_poll_sock-ts_handle_event" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="293.36,353.7969,285.6199,347.7066,288.5135,352.5674,283.6527,355.461,293.36,353.7969" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="231" y="313.3638">handle based on</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="48" x="341" y="313.3638">msg_id</text><!--link ts_handle_event to ts_response--><path d="M343.9,385.5169 C335.42,396.3369 329.83,409.1369 337,420.2969 C340.63,425.9469 345.23,430.8469 350.43,435.0869 " fill="none" id="ts_handle_event-ts_response" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="354.52,438.2169,349.789,429.5787,350.5442,435.1849,344.9379,435.9401,354.52,438.2169" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="338" y="416.3638">callback enqueues response</text><!--link ts_handle_event to ts_response--><path d="M451.84,375.1069 C481.99,382.0069 511,391.4369 520,403.2969 C530.7,417.3969 521.27,429.0969 505.05,438.2569 " fill="none" id="ts_handle_event-ts_response" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="446.6,373.9369,454.518,379.794,451.4809,375.0215,456.2534,371.9845,446.6,373.9369" style="stroke: #A80036; stroke-width: 1.0;"/><!--link ts_poll_sock to ts_handle_event--><path d="M303.75,268.8269 C340.38,275.6769 378.97,286.0269 390,300.2969 C397.8,310.3969 394.16,323.7169 387.97,335.1469 " fill="none" id="ts_poll_sock-ts_handle_event" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="298.83,267.9269,306.9622,273.4827,303.7482,268.8276,308.4033,265.6136,298.83,267.9269" style="stroke: #A80036; stroke-width: 1.0;"/><!--link ts_poll_sock to *end*ts_poll_tm--><path d="M160.22,282.4969 C153.46,287.4169 147.46,293.2869 143,300.2969 C134.43,313.7569 135.92,332.6769 138.4,345.4369 " fill="none" id="ts_poll_sock-*end*ts_poll_tm" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="139.5,350.4869,141.4793,340.839,138.429,345.6029,133.665,342.5526,139.5,350.4869" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="144" y="313.3638">timed out</text><!--link *end*ts_poll_tm to ts_ext_event--><path d="M142,375.7169 C142,391.9969 142,418.7669 142,438.2369 " fill="none" id="*end*ts_poll_tm-ts_ext_event" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="142,370.6169,138,379.6169,142,375.6169,146,379.6169,142,370.6169" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="143" y="416.3638">eventfd</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="42" x="203" y="416.3638">trigger</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="226.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="338" x="151" y="634"/><rect fill="#FFFFFF" height="175" rx="12.5" ry="12.5" style="stroke: #FFFFFF; stroke-width: 1.0;" width="332" x="154" y="682.2656"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="151" x2="489" y1="679.2656" y2="679.2656"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="151" x2="489" y1="660.2969" y2="660.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="144" x="248" y="651.9951">processSignalQueue</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="313" x="156" y="671.4355">send outgoing messages via processSignalQueue</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="231" x="190" y="692.2656"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="190" x2="421" y1="718.5625" y2="718.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="107" x="252" y="710.2607">dequeue signal</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="88" x="195" y="734.7012">dequeue from</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="119" x="287" y="734.7012">mgmt_signal_queue</text><rect fill="#FEFECE" filter="url(#fyoqwvhtnydpn)" height="50.2656" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="162" y="795.2656"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="162" x2="287" y1="821.5625" y2="821.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="176.5" y="813.2607">send out msg</text><text fill="#000000" font-family="monospace" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="105" x="167" y="837.7012">mgmt_write_pipe</text><ellipse cx="338.5" cy="820.2656" fill="none" filter="url(#fyoqwvhtnydpn)" rx="10" ry="10" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="339" cy="820.7656" fill="#000000" rx="6" ry="6" style="stroke: none; stroke-width: 1.0;"/><!--link ts_dequeue_signal to *end*ts_send_signals--><path d="M313.4,742.4556 C319.85,762.1756 328.71,789.3056 334,805.4856 " fill="none" id="ts_dequeue_signal-*end*ts_send_signals" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="335.65,810.5356,336.6518,800.7378,334.0946,805.7837,329.0487,803.2265,335.65,810.5356" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="324.5" y="773.3325">empty</text><!--link ts_dequeue_signal to ts_outgoing_msg--><path d="M219.52,742.3556 C212.51,747.2656 206.29,753.1656 201.5,760.2656 C195.32,769.4356 197.54,780.5056 202.53,790.5756 " fill="none" id="ts_dequeue_signal-ts_outgoing_msg" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="204.99,795.1156,204.2031,785.2983,202.6008,790.7234,197.1756,789.121,204.99,795.1156" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="202.5" y="773.3325">send out msg</text><!--link ts_dequeue_signal to ts_outgoing_msg--><path d="M303.1,747.6156 C301.14,757.7256 297.66,768.6656 291.5,777.2656 C286.62,784.0756 280.26,790.0156 273.41,795.1356 " fill="none" id="ts_dequeue_signal-ts_outgoing_msg" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="303.99,742.4156,298.5301,750.6126,303.1472,747.3441,306.4157,751.9611,303.99,742.4156" style="stroke: #A80036; stroke-width: 1.0;"/><!--link *start*traffic_manager to tm_process_events--><path d="M1164,95.29 C1164,118.6 1164,181.83 1164,239.08 " fill="none" id="*start*traffic_manager-tm_process_events" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1164,244.25,1168,235.25,1164,239.25,1160,235.25,1164,244.25" style="stroke: #A80036; stroke-width: 1.0;"/><!--link tm_process_events to tm_poll_ts--><path d="M1175.65,451.75 C1179.35,484.38 1183.56,521.55 1187.72,558.22 " fill="none" id="tm_process_events-tm_poll_ts" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1188.33,563.63,1191.273,554.2311,1187.7574,558.6629,1183.3257,555.1473,1188.33,563.63" style="stroke: #A80036; stroke-width: 1.0;"/><!--link tm_poll_ts to *end*traffic_manager--><path d="M1209,930.07 C1209,978.92 1209,1024.35 1209,1046.63 " fill="none" id="tm_poll_ts-*end*traffic_manager" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1209,1051.79,1213,1042.79,1209,1046.79,1205,1042.79,1209,1051.79" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1226" y="973.0669">other tasks</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="1302" y="973.0669">traffic_manager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="10" x="1426" y="973.0669">is</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="1210" y="988.1997">responsible for including</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="1368" y="988.1997">rotateLogs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1448" y="988.1997">,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="1222.5" y="1003.3325">managing metrics and monitoring</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1275" y="1018.4653">traffic_server</text><!--link ts_poll_tm to ts_send_signals--><path d="M307.54,503.06 C306.99,544.78 307.22,589.26 308.25,628.6 " fill="none" id="ts_poll_tm-ts_send_signals" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="308.39,633.87,312.1306,624.7591,308.2468,628.8721,304.1339,624.9883,308.39,633.87" style="stroke: #A80036; stroke-width: 1.0;"/><!--link ts_poll_tm to ts_send_signals--><path d="M333.26,508.18 C333.78,550.28 333.46,594.84 332.29,633.87 " fill="none" id="ts_poll_tm-ts_send_signals" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="333.19,503.06,329.2931,512.1051,333.2471,508.0597,337.2926,512.0137,333.19,503.06" style="stroke: #A80036; stroke-width: 1.0;"/><!--link ts_send_signals to tm_poll_ts--><path d="M489.04,747 C588.16,747 717.42,747 839.03,747 " fill="none" id="ts_send_signals-tm_poll_ts" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="844.08,747,835.08,743,839.08,747,835.08,751,844.08,747" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="507.25" y="740.0669">msg from</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="573.25" y="740.0669">traffic_server</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="689.25" y="740.0669">to</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="706.25" y="740.0669">traffic_manager</text><!--link ts_poll_tm to tm_process_events--><path d="M606.69,348 C738.31,348 889.56,348 1001.26,348 " fill="none" id="ts_poll_tm-tm_process_events" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="601.63,348,610.63,352,606.63,348,610.63,344,601.63,348" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="642" y="341.0669">msg from</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="708" y="341.0669">traffic_manager</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="13" x="832" y="341.0669">to</text><text fill="#000000" font-family="monospace" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="849" y="341.0669">traffic_server</text><!--
@startuml

state "LocalManager\nruns in traffic_manager main event loop" as traffic_manager {
    state "processEventQueue" as tm_process_events {
        state "dequeue msg" as tm_dequeue : from ""mgmt_event_queue""
        state "send msg to processes" as tm_send_events : ""sendMgmtMsgToProcesses""
        tm_dequeue -d-> [*] : empty
        tm_dequeue -d-> tm_send_events : based on msg_id
        tm_send_events -u-> tm_dequeue
    }

    state "pollMgmtProcessServer" as tm_poll_ts {
        state "poll socket" as tm_poll_sock : ""mgmt_select""
        state "new connection" as tm_new_process : register new client socket fd\nto start getting msgs from\nclient
        state "new message" as tm_new_message : new message from process
        state "handle msg" as tm_handle_msg : ""handleMgmtMsgFromProcesses"" will\noften ""signalAlarm"" with received\nmsg_id

        tm_poll_sock -d-> tm_new_process : new process trying to connect
        tm_poll_sock -d-> tm_new_message : msg from ""traffic_server""
        tm_poll_sock -d-> [*] : timed out
        tm_new_message -d-> tm_handle_msg : based on msg_id
        tm_handle_msg -u-> tm_poll_sock
        tm_new_process -u-> tm_poll_sock

        state "External Event" as tm_ext_event : mechanism to stop polling
        tm_ext_event -u-> [*] : ""eventfd"" trigger
    }

    [*] -d-> tm_process_events
    tm_process_events -d-> tm_poll_ts
    tm_poll_ts -d-> [*] : other tasks ""traffic_manager"" is\nresponsible for including ""rotateLogs"",\nmanaging metrics and monitoring\n""traffic_server""
}

state "ProcessManager\nruns in processManagerThread from traffic_server" as traffic_server {
    state "pollLMConnection" as ts_poll_tm {
        state "poll socket" as ts_poll_sock : ""mgmt_read_timeout""
        state "handle event" as ts_handle_event : ""executeMgmtCallback""
        state "send response" as ts_response : enqueue response to ""mgmt_signal_queue""
        ts_poll_sock -down-> ts_handle_event : handle based on ""msg_id""
        ts_handle_event -d-> ts_response : callback enqueues response
        ts_response -u-> ts_handle_event
        ts_handle_event -u-> ts_poll_sock

        ts_poll_sock -down-> [*] : timed out
        state "External Event" as ts_ext_event : mechanism to stop polling
        ts_ext_event -u-> [*] : ""eventfd"" trigger
    }

    state "processSignalQueue" as ts_send_signals {
        state "dequeue signal" as ts_dequeue_signal : dequeue from ""mgmt_signal_queue""
        state "send out msg" as ts_outgoing_msg : ""mgmt_write_pipe""
        ts_dequeue_signal -d-> [*] : empty
        ts_dequeue_signal -d-> ts_outgoing_msg : send out msg
        ts_outgoing_msg -u-> ts_dequeue_signal

    }
    ts_send_signals : send outgoing messages via processSignalQueue
    ts_poll_tm -down-> ts_send_signals
    ts_send_signals -up-> ts_poll_tm
}

ts_send_signals -r-> tm_poll_ts : msg from ""traffic_server"" to ""traffic_manager""
tm_process_events -l-> ts_poll_tm : msg from ""traffic_manager"" to ""traffic_server""


@enduml

PlantUML version 1.2018.01(Sun Jan 28 18:08:22 GMT 2018)
(APACHE source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.9.1+11
Operating System: Linux
OS Version: 5.10.7-200.fc33.x86_64
Default Encoding: UTF-8
Language: en
Country: IE
--></g></svg>