

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cache Key and Parent Selection URL Manipulation Plugin &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/override.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Cache Promote Plugin" href="cache_promote.en.html" />
    <link rel="prev" title="Background Fetch Plugin" href="background_fetch.en.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="cache-key-and-parent-selection-url-manipulation-plugin">
<span id="admin-plugins-cachekey"></span><h1>Cache Key and Parent Selection URL Manipulation Plugin<a class="headerlink" href="#cache-key-and-parent-selection-url-manipulation-plugin" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>This plugin allows some common <cite>cache key</cite> or <cite>parent selection URL</cite> manipulations based on various HTTP request components.
Although <cite>cache key</cite> is used everywhere in this document, the same manipulations can be applied to <cite>parent selection URL</cite>
by switching <a class="reference internal" href="#key-type">key type</a>. The plugin can</p>
<ul class="simple">
<li><p>sort query parameters to prevent query parameter reordering being a cache miss</p></li>
<li><p>ignore specific query parameters from the <cite>cache key</cite> by name or regular expression</p></li>
<li><p>ignore all query parameters from the <cite>cache key</cite></p></li>
<li><p>only use specific query parameters in the <cite>cache key</cite> by name or regular expression</p></li>
<li><p>include headers or cookies by name</p></li>
<li><p>capture values from the <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> header.</p></li>
<li><p>classify request using <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> and a list of regular expressions</p></li>
<li><p>capture and replace strings from the URI and include them in the <cite>cache key</cite></p></li>
<li><p>do more - please find more examples below.</p></li>
</ul>
</div>
<div class="section" id="uri-type">
<h2>URI type<a class="headerlink" href="#uri-type" title="Permalink to this headline">¶</a></h2>
<p>The plugin manipulates the <code class="docutils literal notranslate"><span class="pre">remap</span></code> URI (value set during URI remap) by default. If manipulation needs to be based on the <code class="docutils literal notranslate"><span class="pre">pristine</span></code> URI (the value before URI remapping takes place) one could use the following option:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--uri-type=[remap|pristine]</span></code> (default: <code class="docutils literal notranslate"><span class="pre">remap</span></code>)</p></li>
</ul>
</div>
<div class="section" id="key-type">
<h2>Key type<a class="headerlink" href="#key-type" title="Permalink to this headline">¶</a></h2>
<p>The plugin manipulates the <cite>cache key</cite> by default. If <cite>parent selection URL</cite> manipulation is needed the following option can be used:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--key-type=&lt;list</span> <span class="pre">of</span> <span class="pre">target</span> <span class="pre">types&gt;</span></code>  (default: <code class="docutils literal notranslate"><span class="pre">cache_key</span></code>) - list of <code class="docutils literal notranslate"><span class="pre">cache_key</span></code> or <code class="docutils literal notranslate"><span class="pre">parent_selection_url</span></code>, if multiple <code class="docutils literal notranslate"><span class="pre">--key-type</span></code> options are specified then all values are combined together.</p></li>
</ul>
<p>An instance of this plugin can be used for applying manipulations to <cite>cache key</cite>, <cite>parent selection URL</cite> or both depending on the need. See <a class="reference internal" href="#simultaneous-cache-key-and-parent-selection-url-manipulation">simultaneous cache key and parent selection URL manipulation</a>
for examples of how to apply the <strong>same</strong> set of manipulations to both targets with a single plugin instance or applying <strong>different</strong> sets of manipulations to each target using separate plugin instances.</p>
</div>
<div class="section" id="cache-key-structure-and-related-plugin-parameters">
<h2>Cache key structure and related plugin parameters<a class="headerlink" href="#cache-key-structure-and-related-plugin-parameters" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                              hierarchical part                               query
┌───────────────────────────────────┴────────────────────────────────────┐┌─────┴──────┐
┌─────────────┬──────────────┬──────────────┬──────────────┬─────────────┬─────────────┐
│  Prefix     |  User-Agent  │  Headers     │  Cookies     │  Path       │  Query      │
│  section    |  section     │  section     │  section     │  section    │  section    │
│  (default)  |  (optional)  │  (optional)  │  (optional)  │  (default)  │  (default)  │
└─────────────┴──────────────┴──────────────┴──────────────┴─────────────┴─────────────┘
</pre></div>
</div>
<ul class="simple">
<li><p>The <cite>cache key</cite> set by the cachekey plugin can be considered as divided into several sections.</p></li>
<li><p>Every section is manipulated separately by the related plugin parameters (more info in each section description below).</p></li>
<li><p>“User-Agent”, “Headers” and “Cookies” sections are optional and will be missing from the <cite>cache key</cite> if no related plugin parameters are used.</p></li>
<li><p>“Prefix”, “Path” and “Query” sections always have default values even if no related plugin parameters are used.</p></li>
<li><p>All cachekey plugin parameters are optional and if missing some of the <cite>cache key</cite> sections will be missing (the optional sections) or their values will be left to their defaults.</p></li>
</ul>
<div class="section" id="prefix-section">
<h3>“Prefix” section<a class="headerlink" href="#prefix-section" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Optional components      | ┌─────────────────┬──────────────────┬──────────────────────┐
(included in this order) | │ --static-prefix │ --capture-prefix │ --capture-prefix-uri │
                         | ├─────────────────┴──────────────────┴──────────────────────┤
Default values if no     | │ /host/port or scheme://host:port (see the table below)    │
optional components      | └───────────────────────────────────────────────────────────┘
configured               |

┌────────────────────┬─────────────────────────┬──────────────────────┐
│ --canonical-prefix │  default value if no    │ input used for       │
│                    │  prefix parameters used │ --capture-prefix     │
├────────────────────┼─────────────────────────┼──────────────────────┤
│ false              │ /host/port              │ host:port            │
├────────────────────┼─────────────────────────┼──────────────────────┤
│ true               │ scheme://host:port      │ scheme://host:port   │
└────────────────────┴─────────────────────────┴──────────────────────┘
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--static-prefix=&lt;value&gt;</span></code> (default: empty string) - if specified and not an empty string the <code class="docutils literal notranslate"><span class="pre">&lt;value&gt;</span></code> will be added to the <cite>cache key</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--capture-prefix=&lt;capture_definition&gt;</span></code> (default: empty string) - if specified and not empty then strings are captured from <code class="docutils literal notranslate"><span class="pre">host:port</span></code> based on the <code class="docutils literal notranslate"><span class="pre">&lt;capture_definition&gt;</span></code> and are added to the <cite>cache key</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--capture-prefix-uri=&lt;capture_definition&gt;</span></code> (default: empty string) - if specified and not empty then strings are captured from the entire URI based on the <code class="docutils literal notranslate"><span class="pre">&lt;capture_definition&gt;</span></code> and are added to the <cite>cache key</cite>.</p></li>
<li><p>If any of the “Prefix” related plugin parameters are used together in the plugin configuration they are added to the <cite>cache key</cite> in the order shown in the diagram.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--remove-prefix=&lt;true|false|yes|no|0|1</span></code> (default: false) - if specified the prefix elements (host, port) are not processed nor appended to the <cite>cache key</cite>. All prefix related plugin parameters are ignored if this parameter is <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--canonical-prefix=true|false|yes|no|0|1</span></code> (default: false) - impacts the input of regex operation when <code class="docutils literal notranslate"><span class="pre">--capture-prefix</span></code> is used and the default value if no prefix parameters are used (see the table above).</p></li>
</ul>
</div>
<div class="section" id="user-agent-section">
<h3>“User-Agent” section<a class="headerlink" href="#user-agent-section" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Optional components      | ┌────────────┬──────────────┐
(included in this order) | │ --ua-class │ --ua-capture │
                         | ├────────────┴──────────────┤
Default values if no     | │ (empty)                   │
optional components      | └───────────────────────────┘
configured               |
</pre></div>
</div>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> classification</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--ua-allowlist=&lt;classname&gt;:&lt;filename&gt;</span></code> (default: empty string) - loads a regex patterns list from a file <code class="docutils literal notranslate"><span class="pre">&lt;filename&gt;</span></code>, the patterns are matched against the <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> header and if matched <code class="docutils literal notranslate"><span class="pre">&lt;classname&gt;</span></code> is added it to the key.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--ua-denylist=&lt;classname&gt;:&lt;filename&gt;</span></code> (default: empty string) - loads a regex patterns list from a file <code class="docutils literal notranslate"><span class="pre">&lt;filename&gt;</span></code>, the patterns are matched against the <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> header and if <strong>not</strong> matched <code class="docutils literal notranslate"><span class="pre">&lt;classname&gt;</span></code> is added it to the key.</p></li>
<li><p>Multiple <code class="docutils literal notranslate"><span class="pre">--ua-allowlist</span></code> and <code class="docutils literal notranslate"><span class="pre">--ua-denylist</span></code> can be used and the result will be defined by their order in the plugin configuration.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> regex capturing and replacement</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">--ua-capture=&lt;capture_definition&gt;</span></code> (default: empty string) - if specified and not empty then strings are captured from the <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> header based on <code class="docutils literal notranslate"><span class="pre">&lt;capture_definition&gt;</span></code> (see below) and are added to the <cite>cache key</cite>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>If any <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> classification and regex capturing and replacement plugin parameters are used together they are added to the <cite>cache key</cite> in the order shown in the diagram.</p></li>
</ul>
</div>
<div class="section" id="headers-section">
<h3>“Headers” section<a class="headerlink" href="#headers-section" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Optional components      | ┌───────────────────┬───────────────────┐
                         | │ --include-headers │  --capture-header │
                         | ├───────────────────┼───────────────────┤
Default values if no     | │ (empty)           │  (empty)          │
optional components      | └───────────────────┴───────────────────┘
configured               |
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--include-headers</span></code> (default: empty list) - comma separated list of headers to be added to the <cite>cache key</cite>. The list of headers defined by <code class="docutils literal notranslate"><span class="pre">--include-headers</span></code> are always sorted before adding them to the <cite>cache key</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--capture-header=&lt;headername&gt;:&lt;capture_definition&gt;</span></code> (default: empty) - captures elements from header &lt;headername&gt; using &lt;capture_definition&gt; and adds them to the <cite>cache key</cite>.</p></li>
</ul>
</div>
<div class="section" id="cookies-section">
<h3>“Cookies” section<a class="headerlink" href="#cookies-section" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Optional components      | ┌───────────────────┐
                         | │ --include-cookies │
                         | ├───────────────────┤
Default values if no     | │ (empty)           │
optional components      | └───────────────────┘
configured               |
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--include-cookies</span></code> (default: empty list) - comma separated list of cookies to be added to the <cite>cache key</cite>. The list of cookies defined by <code class="docutils literal notranslate"><span class="pre">--include-cookies</span></code> are always sorted before adding them to the <cite>cache key</cite>.</p></li>
</ul>
</div>
<div class="section" id="path-section">
<h3>“Path” section<a class="headerlink" href="#path-section" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Optional components      | ┌────────────────────┬────────────────┐
(included in this order) | │ --capture-path-uri │ --capture-path │
                         | ├────────────────────┴────────────────┤
Default values if no     | │ URI path                            │
optional components      | └─────────────────────────────────────┘
configured               |
</pre></div>
</div>
<ul class="simple">
<li><p>if no path related plugin parameters are used, the URI path string is included in the <cite>cache key</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--capture-path=&lt;capture_definition&gt;</span></code> (default: empty string) - if specified and not empty then strings are captured from URI path based on the <code class="docutils literal notranslate"><span class="pre">&lt;capture_definition&gt;</span></code> and are added to the <cite>cache key</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--capture-path-uri=&lt;capture_definition&gt;</span></code> (default: empty string) - if specified and not empty then strings are captured from the entire URI based on the <code class="docutils literal notranslate"><span class="pre">&lt;capture_definition&gt;</span></code> and are added to the <cite>cache key</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--remove-path=&lt;true|false|yes|no|0|1</span></code> (default: false) - if specified the HTTP URI path element is not processed nor appended to the cachekey. All path related plugin parameters are ignored if this parameter is <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">yes</span></code> or <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
</ul>
</div>
<div class="section" id="query-section">
<h3>“Query” section<a class="headerlink" href="#query-section" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>If no query related plugin parameters are used, the query string is included in the <cite>cache key</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--exclude-params</span></code> (default: empty list) - comma-separated list of query params to be excluded in the <cite>cache key</cite>. If the list is empty then no exlusions are applied (no query parameters will be excluded from the <cite>cache key</cite>). The exclude list overrides the include list.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--include-params</span></code> (default: empty list) - comma-separated list of query params to be allow-listed in the <cite>cache key</cite>. If the list is empty then no allow-list is applied (all query parameters will be included in the <cite>cache key</cite>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--include-match-params</span></code> (default: empty list) - regular expression matching query parameter names which will be allowed in the <cite>cache key</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--exclude-match-params</span></code> (default: empty list) - regular expression matching query parameter names which will be excluded in the <cite>cache key</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--remove-all-params</span></code> (boolean:<code class="docutils literal notranslate"><span class="pre">true|false</span></code>, <code class="docutils literal notranslate"><span class="pre">0|1</span></code>, <code class="docutils literal notranslate"><span class="pre">yes|no</span></code>, default: <code class="docutils literal notranslate"><span class="pre">false</span></code>) - if equals <code class="docutils literal notranslate"><span class="pre">true</span></code> then all query parameters are removed (the whole query string) and all other URI query parameter related settings (if used) will have no effect.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--sort-params</span></code> (boolean:<code class="docutils literal notranslate"><span class="pre">true|false</span></code>, <code class="docutils literal notranslate"><span class="pre">0|1</span></code>, <code class="docutils literal notranslate"><span class="pre">yes|no</span></code>, default: <code class="docutils literal notranslate"><span class="pre">false</span></code>) - if equals <code class="docutils literal notranslate"><span class="pre">true</span></code> then all query parameters are sorted in an increasing case-sensitive order</p></li>
</ul>
<p>All parameters are optional, and if not used, their default values are as mentioned below. Boolean values default to <code class="docutils literal notranslate"><span class="pre">false</span></code> and the rest default to an empty list. Examples of each parameter’s usage can be found below.</p>
</div>
<div class="section" id="capture-definition">
<h3>&lt;capture_definition&gt;<a class="headerlink" href="#capture-definition" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">&lt;capture_definition&gt;</span></code> can be in the following formats</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;regex&gt;</span></code> - <code class="docutils literal notranslate"><span class="pre">&lt;regex&gt;</span></code> defines regex capturing groups, up to 10 captured strings based on <code class="docutils literal notranslate"><span class="pre">&lt;regex&gt;</span></code> will be added to the <cite>cache key</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/&lt;regex&gt;/&lt;replacement&gt;/</span></code> - <code class="docutils literal notranslate"><span class="pre">&lt;regex&gt;</span></code> defines regex capturing groups, <code class="docutils literal notranslate"><span class="pre">&lt;replacement&gt;</span></code> defines a pattern where the captured strings referenced with <code class="docutils literal notranslate"><span class="pre">$0</span></code> … <code class="docutils literal notranslate"><span class="pre">$9</span></code> will be substituted and the result will be added to the <cite>cache key</cite>.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="cache-key-elements-separator">
<h3>Cache key elements separator<a class="headerlink" href="#cache-key-elements-separator" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--separator=&lt;string&gt;</span></code> - the <cite>cache key</cite> is constructed by extracting elements from HTTP URI and headers or by using the UA classifiers and they are appended during the key construction and separated by <code class="docutils literal notranslate"><span class="pre">/</span></code> (by default). This options allows to override the default separator to any string (including an empty string).</p></li>
</ul>
</div>
</div>
<div class="section" id="how-to-run-the-plugin">
<h2>How to run the plugin<a class="headerlink" href="#how-to-run-the-plugin" title="Permalink to this headline">¶</a></h2>
<p>The plugin can run as a global plugin (a single global instance configured using <cite>plugin.config</cite>) or as per-remap plugin (a separate instance configured per remap rule in <cite>remap.config</cite>).</p>
<div class="section" id="global-instance">
<h3>Global instance<a class="headerlink" href="#global-instance" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat plugin.config
cachekey.so \
    --include-params=a,b,c \
    --sort-params=true
</pre></div>
</div>
</div>
<div class="section" id="per-remap-instance">
<h3>Per-remap instance<a class="headerlink" href="#per-remap-instance" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$cat remap.config
map http://www.example.com http://www.origin.com \
    @plugin=cachekey.so \
        @pparam=--include-params=a,b,c \
        @pparam=--sort-params=true
</pre></div>
</div>
<p>If both global and per-remap instance are used the per-remap configuration would take precedence (per-remap configuration would be applied and the global configuration ignored).</p>
<p>Because of the ATS core (remap) and the CacheKey plugin implementation there is a slight difference between the global and the per-remap functionality when <code class="docutils literal notranslate"><span class="pre">--uri-type=remap</span></code> is used.</p>
<ul>
<li><p>The global instance always uses the URI <strong>after</strong> remap (at <code class="docutils literal notranslate"><span class="pre">TS_HTTP_POST_REMAP_HOOK</span></code>).</p></li>
<li><p>The per-remap instance uses the URI <strong>during</strong> remap (after <code class="docutils literal notranslate"><span class="pre">TS_HTTP_PRE_REMAP_HOOK</span></code> and  before <code class="docutils literal notranslate"><span class="pre">TS_HTTP_POST_REMAP_HOOK</span></code>) which leads to a different URI to be used depending on plugin order in the remap rule.</p>
<blockquote>
<div><ul class="simple">
<li><p>If CacheKey plugin is the first plugin in the remap rule the URI used will be practically the same as the pristine URI.</p></li>
<li><p>If the CacheKey plugin is the last plugin in the remap rule (which is right before <code class="docutils literal notranslate"><span class="pre">TS_HTTP_POST_REMAP_HOOK</span></code>) the behavior will be similar to the global instance.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="detailed-examples-and-troubleshooting">
<h2>Detailed examples and troubleshooting<a class="headerlink" href="#detailed-examples-and-troubleshooting" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>             |                           hierarchical part                                    query
HTTP request | ┌────────────────────────────────┴─────────────────────────────────────────┐┌────┴─────┐
components   |   URI host and port       HTTP headers and cookies               URI path    URI query
             | ┌────────┴────────┐┌────────────────┴─────────────────────────┐┌─────┴─────┐┌────┴─────┐
Sample 1     | /www.example.com/80/popular/Mozilla/5.0/H1:v1/H2:v2/C1=v1;C2=v2/path/to/data?a=1&amp;b=2&amp;c=3
Sample 2     | /nice_custom_prefix/popular/Mozilla/5.0/H1:v1/H2:v2/C1=v1;C2=v2/path/to/data?a=1&amp;b=2&amp;c=3
             | └────────┬────────┘└───┬──┘└─────┬────┘└────┬─────┘└─────┬────┘└─────┬─────┘└────┬─────┘
Cache Key    |     host:port or   UA-class UA-captures   headers     cookies       path       query
components   |     custom prefix           replacement
</pre></div>
</div>
<p>The following is an example of how the above sample keys were generated (<code class="docutils literal notranslate"><span class="pre">Sample</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">Sample</span> <span class="pre">2</span></code>).</p>
<p>Traffic server configuration</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat etc/trafficserver/remap.config
map http://www.example.com http://www.origin.com \
    @plugin=cachekey.so \
        @pparam=--ua-allowlist=popular:popular_agents.config \
        @pparam=--ua-capture=(Mozilla\/[^\s]*).* \
        @pparam=--include-headers=H1,H2 \
        @pparam=--include-cookies=C1,C2 \
        @pparam=--include-params=a,b,c \
        @pparam=--sort-params=true

$ cat etc/trafficserver/popular_agents.config
^Mozilla.*
^Twitter.*
^Facebo.*

$ cat etc/trafficserver/plugin.config
xdebug.so
</pre></div>
</div>
<p>HTTP request</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ curl &#39;http://www.example.com/path/to/data?c=3&amp;a=1&amp;b=2&amp;x=1&amp;y=2&amp;z=3&#39; \
    -v -x 127.0.0.1:8080 -o /dev/null -s \
    -H &quot;H1: v1&quot; \
    -H &quot;H2: v2&quot; \
    -H &quot;Cookie: C1=v1; C2=v2&quot; \
    -H &#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/7046A194A&#39; \
    -H &#39;X-Debug: X-Cache-Key&#39;
* About to connect() to proxy 127.0.0.1 port 8080 (#0)
*   Trying 127.0.0.1... connected
* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)
&gt; GET http://www.example.com/path/to/data?c=3&amp;a=1&amp;b=2&amp;x=1&amp;y=2&amp;z=3 HTTP/1.1
&gt; Host: www.example.com
&gt; Accept: */*
&gt; Proxy-Connection: Keep-Alive
&gt; H1: v1
&gt; H2: v2
&gt; Cookie: C1=v1; C2=v2
&gt; User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.75.14 (KHTML, like Gecko) Version/7.0.3 Safari/7046A194A
&gt; X-Debug: X-Cache-Key
&gt;
&lt; HTTP/1.1 200 OK
&lt; Server: ATS/6.1.0
&lt; Date: Thu, 19 Nov 2015 23:17:58 GMT
&lt; Content-type: application/json
&lt; Age: 0
&lt; Transfer-Encoding: chunked
&lt; Proxy-Connection: keep-alive
&lt; X-Cache-Key: /www.example.com/80/popular/Mozilla/5.0/H1:v1/H2:v2/C1=v1;C2=v2/path/to/data?a=1&amp;b=2&amp;c=3
&lt;
{ [data not shown]
* Connection #0 to host 127.0.0.1 left intact
* Closing connection #0
</pre></div>
</div>
<p>The response header <code class="docutils literal notranslate"><span class="pre">X-Cache-Key</span></code> header contains the <cite>cache key</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/www.example.com/80/popular/Mozilla/5.0/H1:v1/H2:v2/C1=v1;C2=v2/path/to/data?a=1&amp;b=2&amp;c=3
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">xdebug.so</span></code> plugin and <code class="docutils literal notranslate"><span class="pre">X-Debug</span></code> request header are used just to demonstrate basic <cite>cache key</cite> troubleshooting.</p>
<p>If we add <code class="docutils literal notranslate"><span class="pre">--static-prefix=nice_custom_prefix</span></code> to the remap rule then the <cite>cache key</cite> would look like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/nice_custom_prefix/popular/Mozilla/5.0/H1:v1/H2:v2/C1=v1;C2=v2/path/to/data?a=1&amp;b=2&amp;c=3
</pre></div>
</div>
</div>
<div class="section" id="usage-examples">
<h2>Usage examples<a class="headerlink" href="#usage-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="uri-query-parameters">
<h3>URI query parameters<a class="headerlink" href="#uri-query-parameters" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ignore-the-query-string-all-query-parameters">
<h4>Ignore the query string (all query parameters)<a class="headerlink" href="#ignore-the-query-string-all-query-parameters" title="Permalink to this headline">¶</a></h4>
<p>The following added to the remap rule will ignore the query, removing it from the <cite>cache key</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> <span class="nd">@pparam</span><span class="o">=--</span><span class="n">remove</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
</div>
<div class="section" id="cache-key-normalization-by-sorting-the-query-parameters">
<h4>Cache key normalization by sorting the query parameters<a class="headerlink" href="#cache-key-normalization-by-sorting-the-query-parameters" title="Permalink to this headline">¶</a></h4>
<p>The following will normalize the <cite>cache key</cite> by sorting the query parameters.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> <span class="nd">@pparam</span><span class="o">=--</span><span class="n">sort</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>If the URI has the following query string <code class="docutils literal notranslate"><span class="pre">c=1&amp;a=1&amp;b=2&amp;x=1&amp;k=1&amp;u=1&amp;y=1</span></code> the <cite>cache key</cite> will use <code class="docutils literal notranslate"><span class="pre">a=1&amp;b=2&amp;c=1&amp;k=1&amp;u=1&amp;x=1&amp;y=1</span></code></p>
</div>
<div class="section" id="ignore-exclude-certain-query-parameters">
<h4>Ignore (exclude) certain query parameters<a class="headerlink" href="#ignore-exclude-certain-query-parameters" title="Permalink to this headline">¶</a></h4>
<p>The following will make sure query parameters <cite>a</cite> and <cite>b</cite> will <strong>not</strong> be used when constructing the <cite>cache key</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">b</span>
</pre></div>
</div>
<p>If the URI has the following query string <code class="docutils literal notranslate"><span class="pre">c=1&amp;a=1&amp;b=2&amp;x=1&amp;k=1&amp;u=1&amp;y=1</span></code> the <cite>cache key</cite> will use <code class="docutils literal notranslate"><span class="pre">c=1&amp;x=1&amp;k=1&amp;u=1&amp;y=1</span></code></p>
</div>
<div class="section" id="ignore-exclude-certain-query-parameters-from-the-cache-key-by-using-regular-expression-pcre">
<h4>Ignore (exclude) certain query parameters from the cache key by using regular expression (PCRE)<a class="headerlink" href="#ignore-exclude-certain-query-parameters-from-the-cache-key-by-using-regular-expression-pcre" title="Permalink to this headline">¶</a></h4>
<p>The following will make sure query parameters <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> will <strong>not</strong> be used when constructing the <cite>cache key</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">|</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>If the URI has the following query string <code class="docutils literal notranslate"><span class="pre">c=1&amp;a=1&amp;b=2&amp;x=1&amp;k=1&amp;u=1&amp;y=1</span></code> the <cite>cache key</cite> will use <code class="docutils literal notranslate"><span class="pre">c=1&amp;x=1&amp;k=1&amp;u=1&amp;y=1</span></code></p>
</div>
<div class="section" id="include-only-certain-query-parameters">
<h4>Include only certain query parameters<a class="headerlink" href="#include-only-certain-query-parameters" title="Permalink to this headline">¶</a></h4>
<p>The following will make sure only query parameters <cite>a</cite> and <cite>c</cite> will be used when constructing the <cite>cache key</cite> and the rest will be ignored.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> <span class="nd">@pparam</span><span class="o">=--</span><span class="n">include</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">c</span>
</pre></div>
</div>
<p>If the URI has the following query string <code class="docutils literal notranslate"><span class="pre">c=1&amp;a=1&amp;b=2&amp;x=1&amp;k=1&amp;u=1&amp;y=1</span></code> the <cite>cache key</cite> will use <code class="docutils literal notranslate"><span class="pre">c=1&amp;a=1</span></code></p>
</div>
<div class="section" id="include-only-certain-query-parameters-by-using-regular-expression-pcre">
<h4>Include only certain query parameters by using regular expression (PCRE)<a class="headerlink" href="#include-only-certain-query-parameters-by-using-regular-expression-pcre" title="Permalink to this headline">¶</a></h4>
<p>The following will make sure only query parameters <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">c</span></code> will be used when constructing the <cite>cache key</cite> and the rest will be ignored.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> <span class="nd">@pparam</span><span class="o">=--</span><span class="n">include</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="o">|</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p>If the URI has the following query string <code class="docutils literal notranslate"><span class="pre">c=1&amp;a=1&amp;b=2&amp;x=1&amp;k=1&amp;u=1&amp;y=1</span></code> the <cite>cache key</cite> will use <code class="docutils literal notranslate"><span class="pre">c=1&amp;a=1</span></code></p>
</div>
<div class="section" id="include-and-exclude-certain-parameters-using-multiple-parameters-in-the-same-remap-rule">
<h4>Include and exclude certain parameters using multiple parameters in the same remap rule.<a class="headerlink" href="#include-and-exclude-certain-parameters-using-multiple-parameters-in-the-same-remap-rule" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameters in the remap rule:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">x</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">y</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">z</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">include</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">c</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">include</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">b</span>
</pre></div>
</div>
<p>and if the URI has the following query string <code class="docutils literal notranslate"><span class="pre">c=1&amp;a=1&amp;b=2&amp;x=1&amp;k=1&amp;u=1&amp;y=1</span></code> the <cite>cache key</cite> will use <code class="docutils literal notranslate"><span class="pre">c=1&amp;b=1</span></code></p>
</div>
<div class="section" id="include-and-exclude-certain-parameters-using-multiple-parameters-in-the-same-remap-rule-and-regular-expressions-pcre">
<h4>Include and exclude certain parameters using multiple parameters in the same remap rule and regular expressions (PCRE).<a class="headerlink" href="#include-and-exclude-certain-parameters-using-multiple-parameters-in-the-same-remap-rule-and-regular-expressions-pcre" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameters in the remap rule:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">x</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">y</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">z</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">include</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="n">y</span><span class="o">|</span><span class="n">c</span><span class="p">)</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">include</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">|</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>and if the URI has the following query string <code class="docutils literal notranslate"><span class="pre">c=1&amp;a=1&amp;b=2&amp;x=1&amp;k=1&amp;u=1&amp;y=1</span></code> the <cite>cache key</cite> will use <code class="docutils literal notranslate"><span class="pre">c=1&amp;b=1</span></code></p>
</div>
<div class="section" id="mixing-include-params-exclude-params-include-match-param-and-exclude-match-param">
<h4>Mixing –include-params, –exclude-params, –include-match-param and –exclude-match-param<a class="headerlink" href="#mixing-include-params-exclude-params-include-match-param-and-exclude-match-param" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameters in the remap rule:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">x</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">y</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">exclude</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">z</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">include</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">c</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">include</span><span class="o">-</span><span class="n">match</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="p">(</span><span class="n">x</span><span class="o">|</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>and if the URI has the following query string <code class="docutils literal notranslate"><span class="pre">c=1&amp;a=1&amp;b=2&amp;x=1&amp;k=1&amp;u=1&amp;y=1</span></code> the <cite>cache key</cite> will use <code class="docutils literal notranslate"><span class="pre">c=1&amp;b=1</span></code></p>
</div>
</div>
<div class="section" id="http-headers">
<h3>HTTP Headers<a class="headerlink" href="#http-headers" title="Permalink to this headline">¶</a></h3>
<div class="section" id="include-certain-headers-in-the-cache-key">
<h4>Include certain headers in the cache key<a class="headerlink" href="#include-certain-headers-in-the-cache-key" title="Permalink to this headline">¶</a></h4>
<p>The following headers <code class="docutils literal notranslate"><span class="pre">HeaderA</span></code> and <code class="docutils literal notranslate"><span class="pre">HeaderB</span></code> will be used when constructing the <cite>cache key</cite> and the rest will be ignored.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> <span class="nd">@pparam</span><span class="o">=--</span><span class="n">include</span><span class="o">-</span><span class="n">headers</span><span class="o">=</span><span class="n">HeaderA</span><span class="p">,</span><span class="n">HeaderB</span>
</pre></div>
</div>
<p>The following would capture from the <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> header and will add the captured element to the <cite>cache key</cite></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-header=Authorization:/AWS\s(?&lt;clientID&gt;[^:]+).*/clientID:$1/
</pre></div>
</div>
<p>If the request looks like the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">example</span><span class="o">-</span><span class="n">cdn</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">file</span>
<span class="n">Authorization</span><span class="p">:</span> <span class="n">AWS</span> <span class="n">MKIARYMOG51PT0DLD</span><span class="p">:</span><span class="n">DLiWQ2lyS49H4Zyx34kW0URtg6s</span><span class="o">=</span>
</pre></div>
</div>
<p>The <cite>cache key</cite> would be set to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">example</span><span class="o">-</span><span class="n">cdn</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mi">80</span><span class="o">/</span><span class="n">clientID</span><span class="p">:</span><span class="n">MKIARYMOG51PTCKQ0DLD</span><span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">file</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="http-cookies">
<h3>HTTP Cookies<a class="headerlink" href="#http-cookies" title="Permalink to this headline">¶</a></h3>
<div class="section" id="include-certain-cookies-in-the-cache-key">
<h4>Include certain cookies in the cache key<a class="headerlink" href="#include-certain-cookies-in-the-cache-key" title="Permalink to this headline">¶</a></h4>
<p>The following headers <code class="docutils literal notranslate"><span class="pre">CookieA</span></code> and <code class="docutils literal notranslate"><span class="pre">CookieB</span></code> will be used when constructing the <cite>cache key</cite> and the rest will be ignored.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> <span class="nd">@pparam</span><span class="o">=--</span><span class="n">include</span><span class="o">-</span><span class="n">headers</span><span class="o">=</span><span class="n">CookieA</span><span class="p">,</span><span class="n">CookieB</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="prefix-host-port-capture-and-replace-from-uri">
<h3>Prefix (host, port, capture and replace from URI)<a class="headerlink" href="#prefix-host-port-capture-and-replace-from-uri" title="Permalink to this headline">¶</a></h3>
<div class="section" id="replacing-host-port-with-a-static-cache-key-prefix">
<h4>Replacing host:port with a static cache key prefix<a class="headerlink" href="#replacing-host-port-with-a-static-cache-key-prefix" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameter in the remap rule.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> <span class="nd">@pparam</span><span class="o">=--</span><span class="n">static</span><span class="o">-</span><span class="n">prefix</span><span class="o">=</span><span class="n">static_prefix</span>
</pre></div>
</div>
<p>the <cite>cache key</cite> will be prefixed with <code class="docutils literal notranslate"><span class="pre">/static_prefix</span></code> instead of <code class="docutils literal notranslate"><span class="pre">host:port</span></code> when <code class="docutils literal notranslate"><span class="pre">--static-prefix</span></code> is not used.</p>
</div>
<div class="section" id="capturing-from-the-host-port-and-adding-it-to-the-prefix-section">
<h4>Capturing from the host:port and adding it to the prefix section<a class="headerlink" href="#capturing-from-the-host-port-and-adding-it-to-the-prefix-section" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameter in the remap rule.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-prefix=(test_prefix).*:([^\s\/$]*)
</pre></div>
</div>
<p>the <cite>cache key</cite> will be prefixed with <code class="docutils literal notranslate"><span class="pre">/test_prefix/80</span></code> instead of <code class="docutils literal notranslate"><span class="pre">test_prefix_371.example.com:80</span></code> when <code class="docutils literal notranslate"><span class="pre">--capture-prefix</span></code> is not used.</p>
</div>
<div class="section" id="capturing-from-the-entire-uri-and-adding-it-to-the-prefix-section">
<h4>Capturing from the entire URI and adding it to the prefix section<a class="headerlink" href="#capturing-from-the-entire-uri-and-adding-it-to-the-prefix-section" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameter in the remap rule.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-prefix-uri=/(test_prefix).*:.*(object).*$/$1_$2/
</pre></div>
</div>
<p>and if the request URI is the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://test_prefix_123.example.com/path/to/object?a=1&amp;b=2&amp;c=3
</pre></div>
</div>
<p>the <cite>cache key</cite> will be prefixed with <code class="docutils literal notranslate"><span class="pre">/test_prefix_object</span></code> instead of <code class="docutils literal notranslate"><span class="pre">test_prefix_123.example.com:80</span></code> when <code class="docutils literal notranslate"><span class="pre">--capture-prefix-uri</span></code> is not used.</p>
</div>
<div class="section" id="combining-prefix-plugin-parameters-i-e-static-prefix-and-capture-prefix">
<h4>Combining prefix plugin parameters, i.e. –static-prefix and –capture-prefix<a class="headerlink" href="#combining-prefix-plugin-parameters-i-e-static-prefix-and-capture-prefix" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameters in the remap rule.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-prefix=(test_prefix).*:([^\s\/$]*) \
    @pparam=--static-prefix=static_prefix
</pre></div>
</div>
<p>the <cite>cache key</cite> will be prefixed with <code class="docutils literal notranslate"><span class="pre">/static_prefix/test_prefix/80</span></code> instead of <code class="docutils literal notranslate"><span class="pre">test_prefix_371.example.com:80</span></code> when either <code class="docutils literal notranslate"><span class="pre">--capture-prefix</span></code> nor <code class="docutils literal notranslate"><span class="pre">--static-prefix</span></code> are used.</p>
</div>
</div>
<div class="section" id="path-capture-and-replace-from-the-path-or-entire-uri">
<h3>Path, capture and replace from the path or entire URI<a class="headerlink" href="#path-capture-and-replace-from-the-path-or-entire-uri" title="Permalink to this headline">¶</a></h3>
<div class="section" id="capture-and-replace-groups-from-path-for-the-path-section">
<h4>Capture and replace groups from path for the “Path” section<a class="headerlink" href="#capture-and-replace-groups-from-path-for-the-path-section" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameter in the remap rule.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-path=/.*(object).*/const_path_$1/
</pre></div>
</div>
<p>and the request URI is the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://test_path_123.example.com/path/to/object?a=1&amp;b=2&amp;c=3
</pre></div>
</div>
<p>then the <cite>cache key</cite> will have <code class="docutils literal notranslate"><span class="pre">/const_path_object</span></code> in the path section of the <cite>cache key</cite> instead of <code class="docutils literal notranslate"><span class="pre">/path/to/object</span></code> when either <code class="docutils literal notranslate"><span class="pre">--capture-path</span></code> nor <code class="docutils literal notranslate"><span class="pre">--capture-path-uri</span></code> are used.</p>
</div>
<div class="section" id="capture-and-replace-groups-from-whole-uri-for-the-path-section">
<h4>Capture and replace groups from whole URI for the “Path” section<a class="headerlink" href="#capture-and-replace-groups-from-whole-uri-for-the-path-section" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameter in the remap rule.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-path-uri=/(test_path).*(object).*/$1_$2/
</pre></div>
</div>
<p>and the request URI is the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://test_path_123.example.com/path/to/object?a=1&amp;b=2&amp;c=3
</pre></div>
</div>
<p>the <cite>cache key</cite> will have <code class="docutils literal notranslate"><span class="pre">/test_path_object</span></code> in the path section of the <cite>cache key</cite> instead of <code class="docutils literal notranslate"><span class="pre">/path/to/object</span></code> when either <code class="docutils literal notranslate"><span class="pre">--capture-path</span></code> nor <code class="docutils literal notranslate"><span class="pre">--capture-path-uri</span></code> are used.</p>
</div>
<div class="section" id="combining-path-plugin-parameters-capture-path-and-capture-path-uri">
<h4>Combining path plugin parameters –capture-path and –capture-path-uri<a class="headerlink" href="#combining-path-plugin-parameters-capture-path-and-capture-path-uri" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameters in the remap rule.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-path=/.*(object).*/const_path_$1/ \
    @pparam=--capture-path-uri=/(test_path).*(object).*/$1_$2/
</pre></div>
</div>
<p>and the request URI is the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://test_path_123.example.com/path/to/object?a=1&amp;b=2&amp;c=3
</pre></div>
</div>
<p>the <cite>cache key</cite> will have <code class="docutils literal notranslate"><span class="pre">/test_path_object/const_path_object</span></code> in the path section of the <cite>cache key</cite> instead of <code class="docutils literal notranslate"><span class="pre">/path/to/object</span></code> when either <code class="docutils literal notranslate"><span class="pre">--capture-path</span></code> nor <code class="docutils literal notranslate"><span class="pre">--capture-path-uri</span></code> are used.</p>
</div>
</div>
<div class="section" id="user-agent-capturing-replacement-and-classification">
<h3>User-Agent capturing, replacement and classification<a class="headerlink" href="#user-agent-capturing-replacement-and-classification" title="Permalink to this headline">¶</a></h3>
<p>Let us say we have a request with <code class="docutils literal notranslate"><span class="pre">User-Agent</span></code> header:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="n">Macintosh</span><span class="p">;</span> <span class="n">Intel</span> <span class="n">Mac</span> <span class="n">OS</span> <span class="n">X</span> <span class="mi">10_9_3</span><span class="p">)</span>
<span class="n">AppleWebKit</span><span class="o">/</span><span class="mf">537.75</span><span class="o">.</span><span class="mi">14</span> <span class="p">(</span><span class="n">KHTML</span><span class="p">,</span> <span class="n">like</span> <span class="n">Gecko</span><span class="p">)</span>
<span class="n">Version</span><span class="o">/</span><span class="mf">7.0</span><span class="o">.</span><span class="mi">3</span> <span class="n">Safari</span><span class="o">/</span><span class="mi">7046</span><span class="n">A194A</span>
</pre></div>
</div>
<div class="section" id="capture-pcre-groups-from-user-agent-header">
<h4>Capture PCRE groups from User-Agent header<a class="headerlink" href="#capture-pcre-groups-from-user-agent-header" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">ua</span><span class="o">-</span><span class="n">capture</span><span class="o">=</span><span class="p">(</span><span class="n">Mozilla</span>\<span class="o">/</span><span class="p">[</span><span class="o">^</span>\<span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="p">)</span><span class="o">.*</span><span class="p">(</span><span class="n">AppleWebKit</span>\<span class="o">/</span><span class="p">[</span><span class="o">^</span>\<span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>then <code class="docutils literal notranslate"><span class="pre">Mozilla/5.0</span></code> and <code class="docutils literal notranslate"><span class="pre">AppleWebKit/537.75.14</span></code> will be used when constructing the key.</p>
</div>
</div>
<div class="section" id="capture-and-replace-groups-from-user-agent-header">
<h3>Capture and replace groups from User-Agent header<a class="headerlink" href="#capture-and-replace-groups-from-user-agent-header" title="Permalink to this headline">¶</a></h3>
<p>If the plugin is used with the following plugin parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--ua-capture=/(Mozilla\/[^\s]*).*(AppleWebKit\/[^\s]*)/$1_$2/
</pre></div>
</div>
<p>then <code class="docutils literal notranslate"><span class="pre">Mozilla/5.0_AppleWebKit/537.75.14</span></code> will be used when constructing the key.</p>
<div class="section" id="user-agent-allow-list-classifier">
<h4>User-Agent allow-list classifier<a class="headerlink" href="#user-agent-allow-list-classifier" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">ua</span><span class="o">-</span><span class="n">allowlist</span><span class="o">=</span><span class="n">browser</span><span class="p">:</span><span class="n">browser_agents</span><span class="o">.</span><span class="n">config</span>
</pre></div>
</div>
<p>and if <code class="docutils literal notranslate"><span class="pre">browser_agents.config</span></code> contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">^</span><span class="n">Mozilla</span><span class="o">.*</span>
<span class="o">^</span><span class="n">Twitter</span><span class="o">.*</span>
<span class="o">^</span><span class="n">Facebo</span><span class="o">.*</span>
</pre></div>
</div>
<p>then <code class="docutils literal notranslate"><span class="pre">browser</span></code> will be used when constructing the key.</p>
</div>
<div class="section" id="user-agent-deny-list-classifier">
<h4>User-Agent deny-list classifier<a class="headerlink" href="#user-agent-deny-list-classifier" title="Permalink to this headline">¶</a></h4>
<p>If the plugin is used with the following plugin parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">ua</span><span class="o">-</span><span class="n">denylist</span><span class="o">=</span><span class="n">browser</span><span class="p">:</span><span class="n">tool_agents</span><span class="o">.</span><span class="n">config</span>
</pre></div>
</div>
<p>and if <code class="docutils literal notranslate"><span class="pre">tool_agents.config</span></code> contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">^</span><span class="n">PHP</span><span class="o">.*</span>
<span class="o">^</span><span class="n">Python</span><span class="o">.*</span>
<span class="o">^</span><span class="n">curl</span><span class="o">.*</span>
</pre></div>
</div>
<p>then <code class="docutils literal notranslate"><span class="pre">browser</span></code> will be used when constructing the key.</p>
</div>
</div>
<div class="section" id="cacheurl-plugin-to-cachekey-plugin-migration">
<h3>Cacheurl plugin to cachekey plugin migration<a class="headerlink" href="#cacheurl-plugin-to-cachekey-plugin-migration" title="Permalink to this headline">¶</a></h3>
<p>The plugin <cite>cachekey</cite> was not meant to replace the cacheurl plugin in terms of having exactly the same <cite>cache key</cite> strings generated. It just allows the operator to extract elements from the HTTP URI in the same way the <cite>cacheurl</cite> does (through a regular expression, please see <cite>&lt;capture_definition&gt;</cite> above).</p>
<p>The following examples demonstrate different ways to achieve <cite>cacheurl</cite> compatibility on a <cite>cache key</cite> string level in order to avoid invalidation of the cache.</p>
<p>The operator could use <cite>–capture-path-uri</cite>, <cite>–capture-path</cite>, <cite>–capture-prefix-uri</cite>, <cite>–capture-prefix</cite> to capture elements from the URI, path and authority elements.</p>
<p>By using <cite>–separator=&lt;string&gt;</cite> the operator could override the default separator to an empty string <cite>–separator=</cite> and thus make sure there are no <cite>cache key</cite> element separators.</p>
<p>Example 1: Let us say we have a capture definition used in <cite>cacheurl</cite>. Now by using <cite>–capture-prefix-uri</cite> one could extract elements through the same capture definition used with <cite>cacheurl</cite>, remove the <cite>cache key</cite> element separator <cite>–separator=</cite> and by using <cite>–capture-path-uri</cite> could remove the URI path and by using <cite>–remove-all-params=true</cite> could remove the query string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-prefix-uri=/.*/$0/ \
    @pparam=--capture-path-uri=/.*// \
    @pparam=--remove-all-params=true \
    @pparam=--separator=
</pre></div>
</div>
<p>Example 2: A more efficient way would be achieved by using <cite>–capture-prefix-uri</cite> to capture from the URI, remove the <cite>cache key</cite> element separator <cite>–separator=</cite>  and by using <cite>–remove-path</cite> to remove the URI path and <cite>–remove-all-params=true</cite> to remove the query string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-prefix-uri=/.*/$0/ \
    @pparam=--remove-path=true \
    @pparam=--remove-all-params=true \
    @pparam=--separator=
</pre></div>
</div>
<p>Example 3: Same result as the above but this time by using <cite>–capture-path-uri</cite> to capture from the URI, remove the <cite>cache key</cite> element separator <cite>–separator=</cite> and by using <cite>–remove-prefix</cite> to remove the URI authority elements and by using <cite>–remove-all-params=true</cite> to remove the query string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-path-uri=/(.*)/$0/ \
    @pparam=--remove-prefix=true \
    @pparam=--remove-all-params=true \
    @pparam=--separator=
</pre></div>
</div>
<p>Example 4: Let us say that we would like to capture from URI in similar to <cite>cacheurl</cite> way but also sort the query parameters (which is not supported by <cite>cacheurl</cite>). We could achieve that by using <cite>–capture-prefix-uri</cite> to capture by using a capture definition to process the URI before <cite>?</cite>  and using <cite>–remove-path</cite> to remove the URI path and <cite>–sort-params=true</cite> to sort the query parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@plugin=cachekey.so \
    @pparam=--capture-prefix-uri=/([^?]*)/$1/ \
    @pparam=--remove-path=true \
    @pparam=--sort-params=true \
    @pparam=--separator=
</pre></div>
</div>
</div>
<div class="section" id="simultaneous-cache-key-and-parent-selection-url-manipulation">
<h3>Simultaneous cache key and parent selection URL manipulation<a class="headerlink" href="#simultaneous-cache-key-and-parent-selection-url-manipulation" title="Permalink to this headline">¶</a></h3>
<p>The following is an example of how to manipulate both <cite>cache key</cite> and <cite>parent selection URL</cite> in the same remap rule.
For this purpose two separate instances are loaded for that remap rule:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">key</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">parent_selection_url</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">static</span><span class="o">-</span><span class="n">prefix</span><span class="o">=</span><span class="n">this</span><span class="p">:</span><span class="o">//</span><span class="n">goes</span><span class="o">.</span><span class="n">to</span><span class="o">/</span><span class="n">parent</span><span class="o">/</span><span class="n">selection</span><span class="o">/</span><span class="n">url</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">canonical</span><span class="o">-</span><span class="n">prefix</span><span class="o">=</span><span class="n">true</span> \
<span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">key</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">cache_key</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">static</span><span class="o">-</span><span class="n">prefix</span><span class="o">=</span><span class="n">this</span><span class="p">:</span><span class="o">//</span><span class="n">goes</span><span class="o">.</span><span class="n">to</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="n">key</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">canonical</span><span class="o">-</span><span class="n">prefix</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>In the example above the first instance of the plugin sets the prefix to the parent selection URI and
the second instance of the plugin sets the prefix to the cache key.</p>
<p>The <strong>same</strong> string manipulations can be applied to both cache key and parent selection url more concisely without chaining cachekey plugin instances by specifying multiple target types <cite>–key-type</cite>.</p>
<p>Instead of:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">key</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">parent_selection_url</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">remove</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">true</span>
<span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">key</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">cache_key</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">remove</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<p>one could write:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@plugin</span><span class="o">=</span><span class="n">cachekey</span><span class="o">.</span><span class="n">so</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">key</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">parent_selection_url</span><span class="p">,</span><span class="n">cache_key</span> \
    <span class="nd">@pparam</span><span class="o">=--</span><span class="n">remove</span><span class="o">-</span><span class="nb">all</span><span class="o">-</span><span class="n">params</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.en.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.en.html">Installing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.en.html">Proxy Cache Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interaction/index.en.html">Interacting with Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.en.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.en.html">Cache Storage</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.en.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.en.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.en.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuring-traffic-server.en.html">Configuring Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layer-4-routing.en.html">Layer 4 Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/index.en.html">Performance Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../files/index.en.html">Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jsonrpc/index.en.html">JSONRPC API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.en.html#audience">Audience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-guide/index.en.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.en.html">Administrator’s Guide</a><ul>
  <li><a href="index.en.html">Plugins</a><ul>
      <li>Previous: <a href="background_fetch.en.html" title="previous chapter">Background Fetch Plugin</a></li>
      <li>Next: <a href="cache_promote.en.html" title="next chapter">Cache Promote Plugin</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/plugins/cachekey.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>