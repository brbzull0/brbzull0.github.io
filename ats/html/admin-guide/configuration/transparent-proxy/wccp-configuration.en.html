

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WCCP Configuration &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/override.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="WCCP Service Configuration" href="wccp-service-config.en.html" />
    <link rel="prev" title="Inline on a Linux router" href="router-inline.en.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="wccp-configuration">
<h1>WCCP Configuration<a class="headerlink" href="#wccp-configuration" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound" id="id1">
</div>
<p><a class="reference external" href="http://cio.cisco.com/en/US/docs/ios/12_0t/12_0t3/feature/guide/wccp.html">WCCP</a>
is de-facto semi-standard used by routers to redirect network traffic to
caches. It is available on most Cisco™ routers although it does not
appear to be officially supported by Cisco. The primary benefits of WCCP
are</p>
<ul class="simple">
<li><p>If already have a router that supports WCCP inline you do not
have to change your network topology.</p></li>
<li><p>WCCP fails open so that if the Traffic Server machine fails, it is
bypassed and users continue to have Internet access.</p></li>
</ul>
<p>Use of WCCP only makes sense for client side transparency <a class="footnote-reference brackets" href="#id5" id="id2">1</a>
because if the clients are explicitly proxied by Traffic Server there’s
no benefit to WCCP fail open, as the clients will continue to directly
access the unresponsive Traffic Server host. It would be better to
adjust the routing tables on the router for explicit proxying.</p>
<p>Because the router serves as the inline network element, Traffic Server
must run on a separate host. This host can be located anywhere as long
as Traffic Server is either on the same network segment or a GRE tunnel
can be maintained between the Traffic Server host and the router.</p>
<p><img alt="important" src="../../../_images/important.png" /> This document presumes that the router is already properly
configured to handle traffic between the clients and the origin servers.
If you are not certain, verify it before attempting to configure Traffic
Server with WCCP. This is also a good state to which to revert should
the configuration go badly.</p>
<div class="section" id="configuration-overview">
<h2>Configuration overview<a class="headerlink" href="#configuration-overview" title="Permalink to this headline">¶</a></h2>
<p>Setting WCCP is a three step process, first configuring the router, the
Traffic Server host, and Traffic Server.</p>
<p><img alt="image1" src="../../../_images/important.png" /> The router will <strong>not</strong> respond to WCCP protocol packets unless
explicitly configured to do so. Via WCCP, the router can be made to
perform packet interception and redirection needed by Traffic Server
transparency. The WCCP protocol in effect acts as means of controlling a
rough form of policy routing with positive heartbeat cutoff.</p>
<p>The Traffic Server host system must also be configured using
<code class="docutils literal notranslate"><span class="pre">iptables</span></code> to accept connections on foreign addresses. This is done
roughly the same way as the standard transparency use.</p>
<p>Finally Traffic Server itself must be configured for transparency and
use of WCCP. The former is again very similar to the standard use, while
WCCP configuration is specific to WCCP and uses a separate configuration
file, referred to by the <a class="reference internal" href="../../files/records.config.en.html#std-configfile-records.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">records.config</span></code></a> file.</p>
<p>The primary concern for configuration in which of three basic topologies
are to be used.</p>
<ul class="simple">
<li><p>Dedicated – Traffic Server traffic goes over an interface that is
not used for client nor origin server traffic.</p></li>
<li><p>Shared – Traffic Server traffic shares an interface with client or
server traffic.</p></li>
<li><p>Inside Shared – Traffic Server and client traffic share an
interface.</p></li>
<li><p>Outside Shared – Traffic Server and
origin server traffic share an interface.</p></li>
</ul>
<p>In general the dedicated topology is preferred. However, if the router
has only two interfaces one of the shared topologies will be
required <a class="footnote-reference brackets" href="#id6" id="id3">2</a> Click the links above for more detailed configuration
information on a specific topology.</p>
<div class="section" id="shared-interface-issues">
<h3>Shared interface issues<a class="headerlink" href="#shared-interface-issues" title="Permalink to this headline">¶</a></h3>
<p>A shared interface topology has additional issues compared to a
dedicated topology that must be handled. Such a topology is required if
the router has only two interfaces, and because of these additional
issues it is normally only used in such cases, although nothing prevents
it use even if the router has three or more interfaces.</p>
<p>The basic concept for a shared interface is to use a tunnel to simulate
the dedicated interface case. This enables the packets to be
distinguished at layer 3. For this reason, layer 2 redirection cannot be
used because the WCCP configuration cannot distinguish between packets
returning from the origin server and packets returning from Traffic
Server as they are distinguished only by layer 2 addressing <a class="footnote-reference brackets" href="#id7" id="id4">3</a>.
Fortunately the GRE tunnel used for packet forwarding and return can be
used as the simulated interface for Traffic Server.</p>
</div>
<div class="section" id="frequently-encountered-problems">
<h3>Frequently encountered problems<a class="headerlink" href="#frequently-encountered-problems" title="Permalink to this headline">¶</a></h3>
<div class="section" id="mtu-and-fragmentation">
<h4>MTU and fragmentation<a class="headerlink" href="#mtu-and-fragmentation" title="Permalink to this headline">¶</a></h4>
<p>In most cases the basic configuration using a tunnel in any topology can
fail due to issues with fragmentation. The socket logic is unable to
know that its packets will eventually be put in to a tunnel which will
by its nature have a smaller
<a class="reference external" href="http://en.wikipedia.org/wiki/Maximum_transmission_unit">MTU</a> than the
physical interface which it uses. This can lead to pathological behavior
or outright failure as the packets sent are just a little too big. It is
not possible to solve easily by changing the MTU on the physical
interface because the tunnel interface uses that to compute its own MTU.</p>
</div>
</div>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="http://www.cisco.com/en/US/docs/ios/12_2/configfun/command/reference/frf018.html">WCCP Router Configuration Commands - IOS
12.2</a></p></li>
</ul>
<dl class="footnote brackets">
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>Server side transparency should also be used, but it is not as
significant. In its absence, however, origin servers may see the
source address of connections suddenly change from the Traffic Server
address to client addresses, which could cause problems. Further, the
primary reason for not having server side transparency is to hide
client addresses which is defeated if the Traffic Server host fails.</p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>If your router has only one interface, it’s hardly a <em>router</em>.</p>
</dd>
<dt class="label" id="id7"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>This is not fundamentally impossible, as the packets are distinct in
layer</p>
</dd>
</dl>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.en.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation/index.en.html">Installing Traffic Server</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.en.html">Proxy Cache Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../interaction/index.en.html">Interacting with Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../security/index.en.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../storage/index.en.html">Cache Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.en.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging/index.en.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../monitoring/index.en.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../configuring-traffic-server.en.html">Configuring Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../layer-4-routing.en.html">Layer 4 Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../performance/index.en.html">Performance Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../files/index.en.html">Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonrpc/index.en.html">JSONRPC API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.en.html#audience">Audience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer-guide/index.en.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.en.html">Administrator’s Guide</a><ul>
  <li><a href="../index.en.html">Proxy Cache Configuration</a><ul>
  <li><a href="../transparent-proxy.en.html">Transparent Proxying</a><ul>
      <li>Previous: <a href="router-inline.en.html" title="previous chapter">Inline on a Linux router</a></li>
      <li>Next: <a href="wccp-service-config.en.html" title="next chapter">WCCP Service Configuration</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/admin-guide/configuration/transparent-proxy/wccp-configuration.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>