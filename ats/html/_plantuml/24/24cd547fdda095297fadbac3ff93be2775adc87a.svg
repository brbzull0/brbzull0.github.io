<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="861px" preserveAspectRatio="none" style="width:519px;height:861px;" version="1.1" viewBox="0 0 519 861" width="519px" zoomAndPan="magnify"><defs><filter height="300%" id="f6gcd5oocahu" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="257" x="130.5" y="22.9951">AcidPtr Writer/Writer Contention</text><rect fill="#DDDDDD" height="816.3828" style="stroke: #A80036; stroke-width: 1.0;" width="139" x="4" y="34.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="38.5" y="46.3638">MemLock</text><rect fill="#FF0000" filter="url(#f6gcd5oocahu)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="37" y="395.7891"/><rect fill="#0000FF" filter="url(#f6gcd5oocahu)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="37" y="645.8516"/><rect fill="#FF0000" filter="url(#f6gcd5oocahu)" height="319.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="107.5" y="176.7266"/><rect fill="#0000FF" filter="url(#f6gcd5oocahu)" height="220.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="107.5" y="525.3203"/><rect fill="#FFFFFF" filter="url(#f6gcd5oocahu)" height="160.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="348.5" y="205.8594"/><rect fill="#FFFFFF" filter="url(#f6gcd5oocahu)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="421" y="554.4531"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="42" x2="42" y1="116.5938" y2="764.3828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="112" x2="112" y1="116.5938" y2="764.3828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="182.5" x2="182.5" y1="116.5938" y2="764.3828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="353.5" x2="353.5" y1="116.5938" y2="764.3828"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="425.5" x2="425.5" y1="116.5938" y2="764.3828"/><rect fill="#FEFECE" filter="url(#f6gcd5oocahu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="8" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="15" y="101.292">Access</text><rect fill="#FEFECE" filter="url(#f6gcd5oocahu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="64" x="8" y="763.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="15" y="783.3779">Access</text><rect fill="#FEFECE" filter="url(#f6gcd5oocahu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="49" x="86" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="93" y="101.292">Write</text><rect fill="#FEFECE" filter="url(#f6gcd5oocahu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="49" x="86" y="763.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="35" x="93" y="783.3779">Write</text><rect fill="#FEFECE" filter="url(#f6gcd5oocahu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="149.5" y="81.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="156.5" y="101.292">AcidPtr</text><rect fill="#FEFECE" filter="url(#f6gcd5oocahu)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="62" x="149.5" y="763.3828"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="156.5" y="783.3779">AcidPtr</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="322.5" y="113.292">Writer_A</text><ellipse cx="353.5" cy="43.2969" fill="#FF0000" filter="url(#f6gcd5oocahu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M353.5,51.2969 L353.5,78.2969 M340.5,59.2969 L366.5,59.2969 M353.5,78.2969 L340.5,93.2969 M353.5,78.2969 L366.5,93.2969 " fill="none" filter="url(#f6gcd5oocahu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="56" x="322.5" y="776.3779">Writer_A</text><ellipse cx="353.5" cy="789.6797" fill="#FF0000" filter="url(#f6gcd5oocahu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M353.5,797.6797 L353.5,824.6797 M340.5,805.6797 L366.5,805.6797 M353.5,824.6797 L340.5,839.6797 M353.5,824.6797 L366.5,839.6797 " fill="none" filter="url(#f6gcd5oocahu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="394.5" y="113.292">Writer_B</text><ellipse cx="426" cy="43.2969" fill="#0000FF" filter="url(#f6gcd5oocahu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M426,51.2969 L426,78.2969 M413,59.2969 L439,59.2969 M426,78.2969 L413,93.2969 M426,78.2969 L439,93.2969 " fill="none" filter="url(#f6gcd5oocahu)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="394.5" y="776.3779">Writer_B</text><ellipse cx="426" cy="789.6797" fill="#0000FF" filter="url(#f6gcd5oocahu)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M426,797.6797 L426,824.6797 M413,805.6797 L439,805.6797 M426,824.6797 L413,839.6797 M426,824.6797 L439,839.6797 " fill="none" filter="url(#f6gcd5oocahu)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FF0000" filter="url(#f6gcd5oocahu)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="37" y="395.7891"/><rect fill="#0000FF" filter="url(#f6gcd5oocahu)" height="71.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="37" y="645.8516"/><rect fill="#FF0000" filter="url(#f6gcd5oocahu)" height="319.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="107.5" y="176.7266"/><rect fill="#0000FF" filter="url(#f6gcd5oocahu)" height="220.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="107.5" y="525.3203"/><rect fill="#FFFFFF" filter="url(#f6gcd5oocahu)" height="160.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="348.5" y="205.8594"/><rect fill="#FFFFFF" filter="url(#f6gcd5oocahu)" height="62.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="421" y="554.4531"/><polygon fill="#A80036" points="193.5,143.5938,183.5,147.5938,193.5,151.5938,189.5,147.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187.5" x2="352.5" y1="147.5938" y2="147.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="199.5" y="142.6606">startCommit</text><polygon fill="#A80036" points="170.5,172.7266,180.5,176.7266,170.5,180.7266,174.5,176.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="176.5" y1="176.7266" y2="176.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="124.5" y="171.7935">lock</text><polygon fill="#A80036" points="336.5,201.8594,346.5,205.8594,336.5,209.8594,340.5,205.8594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="182.5" x2="342.5" y1="205.8594" y2="205.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="189.5" y="200.9263">copy to AcidCommitPtr</text><polygon fill="#0000FF" points="193.5,230.9922,183.5,234.9922,193.5,238.9922,189.5,234.9922" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="187.5" x2="425" y1="234.9922" y2="234.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="199.5" y="230.0591">startCommit</text><polygon fill="#FFC0CB" filter="url(#f6gcd5oocahu)" points="279,248.125,428,248.125,438,259.125,428,271.125,279,271.125,269,259.125,279,248.125" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="281" y="264.1919">update AcidCommitPtr</text><path d="M262,281.2578 L262,336.2578 L441,336.2578 L441,291.2578 L431,281.2578 L262,281.2578 " fill="#FBFB77" filter="url(#f6gcd5oocahu)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M431,281.2578 L431,291.2578 L441,291.2578 L431,281.2578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="268" y="298.3247">Contention for duration</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="268" y="313.4575">of AcidCommitPtr scope.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="268" y="328.5903">(externally defined)</text><polygon fill="#A80036" points="193.5,362.6563,183.5,366.6563,193.5,370.6563,189.5,366.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="187.5" x2="352.5" y1="366.6563" y2="366.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="199.5" y="361.7231">~AcidCommitPtr()</text><polygon fill="#A80036" points="170.5,391.7891,180.5,395.7891,170.5,399.7891,174.5,395.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="176.5" y1="395.7891" y2="395.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="54" y="390.856">lock</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="182.5" x2="224.5" y1="425.0547" y2="425.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="224.5" x2="224.5" y1="425.0547" y2="438.0547"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="183.5" x2="224.5" y1="438.0547" y2="438.0547"/><polygon fill="#A80036" points="193.5,434.0547,183.5,438.0547,193.5,442.0547,189.5,438.0547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="189.5" y="419.9888">reset shared_ptr</text><polygon fill="#A80036" points="53,463.0547,43,467.0547,53,471.0547,49,467.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="181.5" y1="467.0547" y2="467.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="59" y="462.1216">unlock</text><polygon fill="#A80036" points="123.5,492.1875,113.5,496.1875,123.5,500.1875,119.5,496.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117.5" x2="181.5" y1="496.1875" y2="496.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="129.5" y="491.2544">unlock</text><polygon fill="#0000FF" points="170.5,521.3203,180.5,525.3203,170.5,529.3203,174.5,525.3203" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="117.5" x2="176.5" y1="525.3203" y2="525.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="124.5" y="520.3872">lock</text><polygon fill="#0000FF" points="409,550.4531,419,554.4531,409,558.4531,413,554.4531" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="182.5" x2="415" y1="554.4531" y2="554.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="189.5" y="549.52">copy to AcidCommitPtr</text><polygon fill="#ADD8E6" filter="url(#f6gcd5oocahu)" points="351,567.5859,500,567.5859,510,578.5859,500,590.5859,351,590.5859,341,578.5859,351,567.5859" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="353" y="583.6528">update AcidCommitPtr</text><polygon fill="#0000FF" points="193.5,612.7188,183.5,616.7188,193.5,620.7188,189.5,616.7188" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="187.5" x2="425" y1="616.7188" y2="616.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="199.5" y="611.7856">~AcidCommitPtr()</text><polygon fill="#0000FF" points="170.5,641.8516,180.5,645.8516,170.5,649.8516,174.5,645.8516" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="47" x2="176.5" y1="645.8516" y2="645.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="25" x="54" y="640.9185">lock</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="182.5" x2="224.5" y1="675.1172" y2="675.1172"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="224.5" x2="224.5" y1="675.1172" y2="688.1172"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="183.5" x2="224.5" y1="688.1172" y2="688.1172"/><polygon fill="#0000FF" points="193.5,684.1172,183.5,688.1172,193.5,692.1172,189.5,688.1172" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="189.5" y="670.0513">reset shared_ptr</text><polygon fill="#0000FF" points="53,713.1172,43,717.1172,53,721.1172,49,717.1172" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="47" x2="181.5" y1="717.1172" y2="717.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="59" y="712.1841">unlock</text><polygon fill="#0000FF" points="123.5,742.25,113.5,746.25,123.5,750.25,119.5,746.25" style="stroke: #0000FF; stroke-width: 1.0;"/><line style="stroke: #0000FF; stroke-width: 1.0;" x1="117.5" x2="181.5" y1="746.25" y2="746.25"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="129.5" y="741.3169">unlock</text><!--
@startuml
Title AcidPtr Writer/Writer Contention
box "MemLock"
participant "Access" as AccessMutex
participant "Write" as WriteMutex
end box
participant AcidPtr
actor Writer_A #red
actor Writer_B #blue

Writer_A -> AcidPtr: startCommit
AcidPtr <- WriteMutex: lock
activate WriteMutex #red
AcidPtr -> Writer_A: copy to AcidCommitPtr
activate Writer_A
Writer_B -[#blue]> AcidPtr: startCommit
hnote over Writer_A #pink
  update AcidCommitPtr
end hnote
note over Writer_A
  Contention for duration
  of AcidCommitPtr scope.
  (externally defined)
end note
Writer_A -> AcidPtr: ~AcidCommitPtr()
deactivate Writer_A
AcidPtr <- AccessMutex: lock
activate AccessMutex #red
AcidPtr -> AcidPtr: reset shared_ptr
AcidPtr -> AccessMutex: unlock
deactivate AccessMutex
AcidPtr -> WriteMutex: unlock
deactivate WriteMutex

AcidPtr <[#blue]- WriteMutex: lock
activate WriteMutex #blue
AcidPtr -[#blue]> Writer_B: copy to AcidCommitPtr
activate Writer_B
hnote over Writer_B #lightblue
  update AcidCommitPtr
end hnote
Writer_B -[#blue]> AcidPtr: ~AcidCommitPtr()
deactivate Writer_B
deactivate AccessMutex

AcidPtr <[#blue]- AccessMutex: lock
activate AccessMutex #blue
AcidPtr -[#blue]> AcidPtr: reset shared_ptr
AcidPtr -[#blue]> AccessMutex: unlock
deactivate AccessMutex
AcidPtr -[#blue]> WriteMutex: unlock
deactivate WriteMutex

@enduml

PlantUML version 1.2018.01(Sun Jan 28 18:08:22 GMT 2018)
(APACHE source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.9.1+11
Operating System: Linux
OS Version: 5.10.7-200.fc33.x86_64
Default Encoding: UTF-8
Language: en
Country: IE
--></g></svg>