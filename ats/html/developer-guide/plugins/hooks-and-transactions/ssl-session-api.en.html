

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TLS Session Plugin API &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/override.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="HTTP Transaction Timers" href="trafficserver-timers.en.html" />
    <link rel="prev" title="TLS User Agent Hooks" href="ssl-hooks.en.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="tls-session-plugin-api">
<span id="developer-plugins-ssl-session-hooks"></span><h1>TLS Session Plugin API<a class="headerlink" href="#tls-session-plugin-api" title="Permalink to this headline">¶</a></h1>
<p>These interfaces enable a plugin to hook into operations on the ATS TLS session cache.  ATS also provides API’s
to enable the plugin to update the session cache based on outside information, e.g. peer servers.</p>
<dl class="c macro">
<dt id="c.TS_SSL_SESSION_HOOK">
<code class="sig-name descname">TS_SSL_SESSION_HOOK</code><a class="headerlink" href="#c.TS_SSL_SESSION_HOOK" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>This hook is invoked when a change has been made to the ATS session cache or a session has been accessed
from ATS via openssl.  These hooks are only activated if the ATS implementation of the session cache is in
use.  This means <a class="reference internal" href="../../../admin-guide/files/records.config.en.html#proxy-config-ssl-session-cache" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.ssl.session_cache</span></code></a> has been set to 2.</p>
<p>The hook callback has the following signature</p>
<dl class="c function">
<dt id="c.SSL_session_callback">
int <code class="sig-name descname">SSL_session_callback</code><span class="sig-paren">(</span><a class="reference internal" href="../../api/functions/TSTypes.en.html#c.TSCont" title="TSCont">TSCont</a> <em>contp</em>, <a class="reference internal" href="../../api/types/TSEvent.en.html#c.TSEvent" title="TSEvent">TSEvent</a> <em>event</em>, void *<em>edata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.SSL_session_callback" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<p>The edata parameter is a pointer to a <a class="reference internal" href="../../api/types/TSSslSession.en.html#c.TSSslSessionID" title="TSSslSessionID"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSSslSessionID</span></code></a>.</p>
<p>This callback in synchronous since the underlying openssl callback is unable to pause processing.</p>
<p>The following events can be sent to this callback</p>
<dl class="c macro">
<dt id="c.TS_EVENT_SSL_SESSION_NEW">
<code class="sig-name descname">TS_EVENT_SSL_SESSION_NEW</code><a class="headerlink" href="#c.TS_EVENT_SSL_SESSION_NEW" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Sent after a new session has been inserted into the SSL session cache.  The plugin can call <a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionGet" title="TSSslSessionGet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionGet()</span></code></a> to retrieve the actual session object.  The plugin could communicate information about the new session to other processes or update additional logging or statistics.</p>
</dd></dl>

<dl class="c macro">
<dt id="c.TS_EVENT_SSL_SESSION_GET">
<code class="sig-name descname">TS_EVENT_SSL_SESSION_GET</code><a class="headerlink" href="#c.TS_EVENT_SSL_SESSION_GET" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Sent after a session has been fetched from the SSL session cache by a client request.  The plugin could update additional logging and statistics.</p>
</dd></dl>

<dl class="c macro">
<dt id="c.TS_EVENT_SSL_SESSION_REMOVE">
<code class="sig-name descname">TS_EVENT_SSL_SESSION_REMOVE</code><a class="headerlink" href="#c.TS_EVENT_SSL_SESSION_REMOVE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Sent after a session has been removed from the SSL session cache.  The plugin could communication information about the session removal to other processes or update additional logging and statistics.</p>
</dd></dl>

</div>
<div class="section" id="utility-functions">
<h1>Utility Functions<a class="headerlink" href="#utility-functions" title="Permalink to this headline">¶</a></h1>
<p>A number of API functions will likely be used with this hook.</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionGet" title="TSSslSessionGet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionGet()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionGetBuffer" title="TSSslSessionGetBuffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionGetBuffer()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionInsert" title="TSSslSessionInsert"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionInsert()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionRemove" title="TSSslSessionRemove"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionRemove()</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslTicketKeyUpdate" title="TSSslTicketKeyUpdate"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslTicketKeyUpdate()</span></code></a></p></li>
</ul>
</div>
<div class="section" id="example-use-case">
<h1>Example Use Case<a class="headerlink" href="#example-use-case" title="Permalink to this headline">¶</a></h1>
<p>Consider deploying a set of ATS servers as a farm behind a layer 4 load balancer.  The load balancer does not
guarantee that all the requests from a single client are directed to the same ATS box.  Therefore, to maximize TLS session
reuse, the servers should share session state via some external communication library like redis or rabbitmq.</p>
<p>To do this, they write a plugin that sets the <a class="reference internal" href="#c.TS_SSL_SESSION_HOOK" title="TS_SSL_SESSION_HOOK"><code class="xref c c-macro docutils literal notranslate"><span class="pre">TS_SSL_SESSION_HOOK</span></code></a>.  When the hook is triggered, the plugin function sends the
updated session state to the other ATS servers via the communication library.</p>
<p>The plugin also has thread that listens for updates and calls <a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionInsert" title="TSSslSessionInsert"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionInsert()</span></code></a> and <a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslSessionRemove" title="TSSslSessionRemove"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslSessionRemove()</span></code></a> to update the local session cache accordingly.</p>
<p>The plugin can also engage in a protocol to periodically update the session ticket encryption key and communicate the new key to its
peers.  The plugin calls <a class="reference internal" href="../../api/functions/TSSslSession.en.html#c.TSSslTicketKeyUpdate" title="TSSslTicketKeyUpdate"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSSslTicketKeyUpdate()</span></code></a> to update the local ATS process with the newest keys and the last N keys.</p>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.en.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release-process/index.en.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/index.en.html">Contributing to Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing-with-vagrant/index.en.html">Using Vagrant to Test Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debugging/index.en.html">Debugging and Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../threads-and-events.en.html">Threads and Event Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cache-architecture/index.en.html">Cache Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging-architecture/index.en.html">Logging Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-libraries/index.en.html">Internal libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.en.html">Plugin Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config-vars.en.html">Configuration Variable Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/index.en.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../continuous-integration/index.en.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/index.en.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../host-resolution-proposal.en.html">Host Resolution Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client-session-architecture.en.html">An Overview Client Sessions and Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core-architecture/index.en.html">Core Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../design-documents/index.en.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../layout/index.en.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.en.html">Testing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonrpc/index.en.html">JSONRPC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.en.html">Developer’s Guide</a><ul>
  <li><a href="../index.en.html">Plugin Development</a><ul>
  <li><a href="index.en.html">Hooks and Transactions</a><ul>
      <li>Previous: <a href="ssl-hooks.en.html" title="previous chapter">TLS User Agent Hooks</a></li>
      <li>Next: <a href="trafficserver-timers.en.html" title="next chapter">HTTP Transaction Timers</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/developer-guide/plugins/hooks-and-transactions/ssl-session-api.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>