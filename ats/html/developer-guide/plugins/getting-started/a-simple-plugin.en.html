

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>A Simple Plugin &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/override.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Plugin Registration and Version Checking" href="plugin-registration-and-version-checking.en.html" />
    <link rel="prev" title="Getting Started" href="index.en.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="a-simple-plugin">
<span id="developer-plugins-getting-started-simple-plugin"></span><h1>A Simple Plugin<a class="headerlink" href="#a-simple-plugin" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to write, compile, configure, and run a
simple Traffic Server plugin. You’ll follow the steps below:</p>
<ol class="arabic simple">
<li><p>Make sure that your plugin source code contains an <a class="reference internal" href="../../api/functions/TSPluginInit.en.html#c.TSPluginInit" title="TSPluginInit"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSPluginInit()</span></code></a>
initialization function.</p></li>
<li><p>Compile your plugin source code, creating a shared library.</p></li>
<li><p>Add an entry to <a class="reference internal" href="../../../admin-guide/files/plugin.config.en.html#std-configfile-plugin.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">plugin.config</span></code></a>.</p></li>
<li><p>Add the path to your plugin shared library into <a class="reference internal" href="../../../admin-guide/files/records.config.en.html#std-configfile-records.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">records.config</span></code></a>.</p></li>
<li><p>Restart Traffic Server.</p></li>
</ol>
<div class="section" id="compile-your-plugin">
<h2>Compile Your Plugin<a class="headerlink" href="#compile-your-plugin" title="Permalink to this headline">¶</a></h2>
<p>The process for compiling a shared library varies with the platform
used, so the Traffic Server API provides the tsxs tool which you can use
to create shared libraries on all the supported Traffic Server
platforms.</p>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Assuming the sample program is stored in the file <code class="docutils literal notranslate"><span class="pre">hello_world.c</span></code>, you
could use the following commands to build a shared library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tsxs</span> <span class="o">-</span><span class="n">o</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">so</span> <span class="o">-</span><span class="n">c</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">c</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">tsxs</span></code> is installed in the <code class="docutils literal notranslate"><span class="pre">bin</span></code> directory of Traffic Server.</p>
<p>This shared library will be your plugin. In order to install it, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">tsxs</span> <span class="o">-</span><span class="n">o</span> <span class="n">hello_world</span><span class="o">.</span><span class="n">so</span> <span class="o">-</span><span class="n">i</span>
</pre></div>
</div>
<p>or the equivalent to <code class="docutils literal notranslate"><span class="pre">sudo</span></code> on your platform.</p>
</div>
</div>
<div class="section" id="update-the-plugin-configuration-file">
<h2>Update the plugin configuration file<a class="headerlink" href="#update-the-plugin-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>Your next step is to tell Traffic Server about the plugin by adding the
following line to <a class="reference internal" href="../../../admin-guide/files/plugin.config.en.html#std-configfile-plugin.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">plugin.config</span></code></a> file. Since our simple plugin
does not require any arguments, the following <a class="reference internal" href="../../../admin-guide/files/plugin.config.en.html#std-configfile-plugin.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">plugin.config</span></code></a> will
work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># a simple plugin.config for hello_world</span>
<span class="n">hello_world</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
<p>Traffic Server can accommodate multiple plugins. If several plugin
functions are triggered by the same event, then Traffic Server invokes
each plugin’s function in the order each was defined in <a class="reference internal" href="../../../admin-guide/files/plugin.config.en.html#std-configfile-plugin.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">plugin.config</span></code></a>.</p>
</div>
<div class="section" id="specify-the-plugin-s-location">
<span id="specify-the-plugins-location"></span><h2>Specify the Plugin’s Location<a class="headerlink" href="#specify-the-plugin-s-location" title="Permalink to this headline">¶</a></h2>
<p>All plugins must be located in the directory specified by the
configuration variable <code class="docutils literal notranslate"><span class="pre">proxy.config.plugin.plugin_dir</span></code>, which is
located in the <a class="reference internal" href="../../../admin-guide/files/records.config.en.html#std-configfile-records.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">records.config</span></code></a> file. The directory can be specified
as an absolute or relative path.</p>
<p>If a relative path is used, then the starting directory will be the
Traffic Server installation directory as specified in
<code class="docutils literal notranslate"><span class="pre">etc/traffic_server</span></code>. The default value is <code class="docutils literal notranslate"><span class="pre">libexec/trafficserver</span></code>,
but this can vary based on how the software was configured and built. It
is common to use the default directory. Be sure to place the shared
library <code class="docutils literal notranslate"><span class="pre">hello_world.so</span></code> inside the directory you’ve configured.</p>
</div>
<div class="section" id="restart-traffic-server">
<h2>Restart Traffic Server<a class="headerlink" href="#restart-traffic-server" title="Permalink to this headline">¶</a></h2>
<p>The last step is to start/restart Traffic Server. Shown below is the
output displayed after you’ve created and loaded your <code class="docutils literal notranslate"><span class="pre">hello_world</span></code>
plugin.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># ls libexec/trafficserver</span>
<span class="n">hello_world</span><span class="o">.</span><span class="n">so</span><span class="o">*</span>
<span class="c1"># bin/traffic_server</span>
<span class="p">[</span><span class="n">Mar</span> <span class="mi">27</span> <span class="mi">19</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">31.669</span><span class="p">]</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">updated</span> <span class="n">diags</span> <span class="n">config</span>
<span class="p">[</span><span class="n">Mar</span> <span class="mi">27</span> <span class="mi">19</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">31.680</span><span class="p">]</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">loading</span> <span class="n">plugin</span> <span class="s1">&#39;libexec/trafficserver/hello_world.so&#39;</span>
<span class="n">hello</span> <span class="n">world</span>
<span class="p">[</span><span class="n">Mar</span> <span class="mi">27</span> <span class="mi">19</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">32.046</span><span class="p">]</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">cache</span> <span class="n">disabled</span> <span class="p">(</span><span class="n">initializing</span><span class="p">)</span>
<span class="p">[</span><span class="n">Mar</span> <span class="mi">27</span> <span class="mi">19</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">32.053</span><span class="p">]</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">cache</span> <span class="n">enabled</span>
<span class="p">[</span><span class="n">Mar</span> <span class="mi">27</span> <span class="mi">19</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mf">32.526</span><span class="p">]</span> <span class="n">NOTE</span><span class="p">:</span> <span class="n">Traffic</span> <span class="n">Server</span> <span class="n">running</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the example above, Traffic Server notes are directed to the
console by specifying <code class="docutils literal notranslate"><span class="pre">E</span></code> for <a class="reference internal" href="../../../admin-guide/files/records.config.en.html#proxy-config-diags-output-note" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.diags.output.note</span></code></a> in
<a class="reference internal" href="../../../admin-guide/files/records.config.en.html#std-configfile-records.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">records.config</span></code></a>. The second note shows Traffic Server attempting to
load the <code class="docutils literal notranslate"><span class="pre">hello_world</span></code> plugin. The third line of Traffic Server output
is from your plugin.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.en.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release-process/index.en.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/index.en.html">Contributing to Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing-with-vagrant/index.en.html">Using Vagrant to Test Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debugging/index.en.html">Debugging and Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../threads-and-events.en.html">Threads and Event Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cache-architecture/index.en.html">Cache Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging-architecture/index.en.html">Logging Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-libraries/index.en.html">Internal libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.en.html">Plugin Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config-vars.en.html">Configuration Variable Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api/index.en.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../continuous-integration/index.en.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/index.en.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../host-resolution-proposal.en.html">Host Resolution Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client-session-architecture.en.html">An Overview Client Sessions and Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core-architecture/index.en.html">Core Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../design-documents/index.en.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../layout/index.en.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.en.html">Testing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonrpc/index.en.html">JSONRPC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.en.html">Developer’s Guide</a><ul>
  <li><a href="../index.en.html">Plugin Development</a><ul>
  <li><a href="index.en.html">Getting Started</a><ul>
      <li>Previous: <a href="index.en.html" title="previous chapter">Getting Started</a></li>
      <li>Next: <a href="plugin-registration-and-version-checking.en.html" title="next chapter">Plugin Registration and Version Checking</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/developer-guide/plugins/getting-started/a-simple-plugin.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>