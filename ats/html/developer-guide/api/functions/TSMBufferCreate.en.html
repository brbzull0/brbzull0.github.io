

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TSMBufferCreate &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/override.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="TSMgmtCounterGet" href="TSMgmtCounterGet.en.html" />
    <link rel="prev" title="TSLifecycleHookAdd" href="TSLifecycleHookAdd.en.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="tsmbuffercreate">
<h1>TSMBufferCreate<a class="headerlink" href="#tsmbuffercreate" title="Permalink to this headline">¶</a></h1>
<p>Traffic Server marshall buffer API.</p>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ts/ts.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<dl class="c function">
<dt id="c.TSMBufferCreate">
<a class="reference internal" href="TSTypes.en.html#c.TSMBuffer" title="TSMBuffer">TSMBuffer</a> <code class="sig-name descname">TSMBufferCreate</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.TSMBufferCreate" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="c function">
<dt id="c.TSMBufferDestroy">
<a class="reference internal" href="../types/TSReturnCode.en.html#c.TSReturnCode" title="TSReturnCode">TSReturnCode</a> <code class="sig-name descname">TSMBufferDestroy</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSMBuffer" title="TSMBuffer">TSMBuffer</a> <em>bufp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSMBufferDestroy" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="c function">
<dt id="c.TSHandleMLocRelease">
<a class="reference internal" href="../types/TSReturnCode.en.html#c.TSReturnCode" title="TSReturnCode">TSReturnCode</a> <code class="sig-name descname">TSHandleMLocRelease</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSMBuffer" title="TSMBuffer">TSMBuffer</a> <em>bufp</em>, <a class="reference internal" href="TSTypes.en.html#c.TSMLoc" title="TSMLoc">TSMLoc</a> <em>parent</em>, <a class="reference internal" href="TSTypes.en.html#c.TSMLoc" title="TSMLoc">TSMLoc</a> <em>mloc</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSHandleMLocRelease" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The marshal buffer or <a class="reference internal" href="TSTypes.en.html#c.TSMBuffer" title="TSMBuffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSMBuffer</span></code></a> is a heap data structure that stores
parsed URLs, MIME headers and HTTP headers. You can allocate new objects
out of marshal buffers, and change the values within the marshal buffer.
Whenever you manipulate an object, you require the handle to the object
(<a class="reference internal" href="TSTypes.en.html#c.TSMLoc" title="TSMLoc"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSMLoc</span></code></a>) and the marshal buffer containing the object (<a class="reference internal" href="TSTypes.en.html#c.TSMBuffer" title="TSMBuffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSMBuffer</span></code></a>).</p>
<p>Any marshal buffer fetched by transaction getters will be used by other parts
of the system. Be careful not to destroy these shared, transaction marshal buffers.</p>
<p><a class="reference internal" href="#c.TSMBufferCreate" title="TSMBufferCreate"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSMBufferCreate()</span></code></a> creates a new marshal buffer and initializes
the reference count. <a class="reference internal" href="#c.TSMBufferDestroy" title="TSMBufferDestroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSMBufferDestroy()</span></code></a> Ignores the reference
count and destroys the marshal buffer bufp. The internal data buffer
associated with the marshal buffer is also destroyed if the marshal
buffer allocated it.</p>
<p><a class="reference internal" href="#c.TSHandleMLocRelease" title="TSHandleMLocRelease"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSHandleMLocRelease()</span></code></a> Releases the <a class="reference internal" href="TSTypes.en.html#c.TSMLoc" title="TSMLoc"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSMLoc</span></code></a> mloc created
from the <a class="reference internal" href="TSTypes.en.html#c.TSMLoc" title="TSMLoc"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSMLoc</span></code></a> parent. If a <a class="reference internal" href="TSTypes.en.html#c.TSMLoc" title="TSMLoc"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSMLoc</span></code></a> is obtained from
a transaction, it does not have a parent <a class="reference internal" href="TSTypes.en.html#c.TSMLoc" title="TSMLoc"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSMLoc</span></code></a>. Use the
the constant <a class="reference internal" href="TSTypes.en.html#c.TS_NULL_MLOC" title="TS_NULL_MLOC"><code class="xref c c-data docutils literal notranslate"><span class="pre">TS_NULL_MLOC</span></code></a> as its parent.</p>
</div>
<div class="section" id="return-values">
<h2>Return values<a class="headerlink" href="#return-values" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="#c.TSMBufferDestroy" title="TSMBufferDestroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSMBufferDestroy()</span></code></a> and <a class="reference internal" href="#c.TSHandleMLocRelease" title="TSHandleMLocRelease"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSHandleMLocRelease()</span></code></a> return
<a class="reference internal" href="../types/TSReturnCode.en.html#c.TS_SUCCESS" title="TS_SUCCESS"><code class="xref c c-data docutils literal notranslate"><span class="pre">TS_SUCCESS</span></code></a> on success, or <a class="reference internal" href="../types/TSReturnCode.en.html#c.TS_ERROR" title="TS_ERROR"><code class="xref c c-data docutils literal notranslate"><span class="pre">TS_ERROR</span></code></a> on failure.
<a class="reference internal" href="#c.TSMBufferCreate" title="TSMBufferCreate"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSMBufferCreate()</span></code></a> returns the new <a class="reference internal" href="TSTypes.en.html#c.TSMBuffer" title="TSMBuffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSMBuffer</span></code></a>.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#include &lt;ts/ts.h&gt;

static void
copyResponseMimeHdr (TSCont pCont, TSHttpTxn pTxn)
{
    TSMBuffer respHdrBuf, tmpBuf;
    TSMLoc respHttpHdrLoc, tmpMimeHdrLoc;

    if (!TSHttpTxnClientRespGet(pTxn, &amp;respHdrBuf, &amp;respHttpHdrLoc)) {
        TSError(&quot;couldn&#39;t retrieve client response header0);
        TSHandleMLocRelease(respHdrBuf, TS_NULL_MLOC, respHttpHdrLoc);
        goto done;
    }

    tmpBuf = TSMBufferCreate();
    tmpMimeHdrLoc = TSMimeHdrCreate(tmpBuf);
    TSMimeHdrCopy(tmpBuf, tmpMimeHdrLoc, respHdrBuf, respHttpHdrLoc);
    TSHandleMLocRelease(tmpBuf, TS_NULL_MLOC, tmpMimeHdrLoc);
    TSHandleMLocRelease(respHdrBuf, TS_NULL_MLOC, respHttpHdrLoc);
    TSMBufferDestroy(tmpBuf);

done:
    TSHttpTxnReenable(pTxn, TS_EVENT_HTTP_CONTINUE);
}
</pre></div>
</div>
</div>
<div class="section" id="see-also">
<h2>See also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><em class="manpage">TSAPI(3ts)</em></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.en.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release-process/index.en.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/index.en.html">Contributing to Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing-with-vagrant/index.en.html">Using Vagrant to Test Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debugging/index.en.html">Debugging and Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../threads-and-events.en.html">Threads and Event Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cache-architecture/index.en.html">Cache Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging-architecture/index.en.html">Logging Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-libraries/index.en.html">Internal libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.en.html">Plugin Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config-vars.en.html">Configuration Variable Implementation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.en.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../continuous-integration/index.en.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/index.en.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../host-resolution-proposal.en.html">Host Resolution Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client-session-architecture.en.html">An Overview Client Sessions and Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core-architecture/index.en.html">Core Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../design-documents/index.en.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../layout/index.en.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.en.html">Testing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonrpc/index.en.html">JSONRPC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.en.html">Developer’s Guide</a><ul>
  <li><a href="../index.en.html">API Reference</a><ul>
  <li><a href="index.en.html">API Functions</a><ul>
      <li>Previous: <a href="TSLifecycleHookAdd.en.html" title="previous chapter">TSLifecycleHookAdd</a></li>
      <li>Next: <a href="TSMgmtCounterGet.en.html" title="next chapter">TSMgmtCounterGet</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/developer-guide/api/functions/TSMBufferCreate.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>