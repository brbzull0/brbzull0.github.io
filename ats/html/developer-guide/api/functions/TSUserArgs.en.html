

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TSUserArgs &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/override.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="TSUuidCreate" href="TSUuidCreate.en.html" />
    <link rel="prev" title="TSUrlStringGet" href="TSUrlStringGet.en.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="tsuserargs">
<span id="id1"></span><h1>TSUserArgs<a class="headerlink" href="#tsuserargs" title="Permalink to this headline">¶</a></h1>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ts/ts.h&gt;</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
  <span class="n">TS_USER_ARGS_TXN</span><span class="p">,</span>   <span class="c1">///&lt; Transaction based.</span>
  <span class="n">TS_USER_ARGS_SSN</span><span class="p">,</span>   <span class="c1">///&lt; Session based</span>
  <span class="n">TS_USER_ARGS_VCONN</span><span class="p">,</span> <span class="c1">///&lt; VConnection based</span>
  <span class="n">TS_USER_ARGS_GLB</span><span class="p">,</span>   <span class="c1">///&lt; Global based</span>
  <span class="n">TS_USER_ARGS_COUNT</span>  <span class="c1">///&lt; Fake enum, # of valid entries.</span>
<span class="p">}</span> <span class="n">TSUserArgType</span><span class="p">;</span>
</pre></div>
</div>
<dl class="c function">
<dt id="c.TSUserArgIndexReserve">
<a class="reference internal" href="../types/TSReturnCode.en.html#c.TSReturnCode" title="TSReturnCode">TSReturnCode</a> <code class="sig-name descname">TSUserArgIndexReserve</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSUserArgType" title="TSUserArgType">TSUserArgType</a> <em>type</em>, <em class="property">const</em> char *<em>name</em>, <em class="property">const</em> char *<em>description</em>, int *<em>arg_idx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSUserArgIndexReserve" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="c function">
<dt id="c.TSUserArgIndexNameLookup">
<a class="reference internal" href="../types/TSReturnCode.en.html#c.TSReturnCode" title="TSReturnCode">TSReturnCode</a> <code class="sig-name descname">TSUserArgIndexNameLookup</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSUserArgType" title="TSUserArgType">TSUserArgType</a> <em>type</em>, <em class="property">const</em> char *<em>name</em>, int *<em>arg_idx</em>, <em class="property">const</em> char **<em>description</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSUserArgIndexNameLookup" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="c function">
<dt id="c.TSUserArgIndexLookup">
<a class="reference internal" href="../types/TSReturnCode.en.html#c.TSReturnCode" title="TSReturnCode">TSReturnCode</a> <code class="sig-name descname">TSUserArgIndexLookup</code><span class="sig-paren">(</span><a class="reference internal" href="TSTypes.en.html#c.TSUserArgType" title="TSUserArgType">TSUserArgType</a> <em>type</em>, int <em>arg_idx</em>, <em class="property">const</em> char **<em>name</em>, <em class="property">const</em> char **<em>description</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSUserArgIndexLookup" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="c function">
<dt id="c.TSUserArgSet">
void <code class="sig-name descname">TSUserArgSet</code><span class="sig-paren">(</span>void *<em>data</em>, int <em>arg_idx</em>, void *<em>arg</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSUserArgSet" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="c function">
<dt id="c.TSUserArgGet">
void *<code class="sig-name descname">TSUserArgGet</code><span class="sig-paren">(</span>void *<em>data</em>, int <em>arg_idx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.TSUserArgGet" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>Traffic Server sessions, transactions, virtual connections and globally provide a fixed array of void pointers
that can be used by plugins to store information. This can be used to avoid creating a per session or
transaction continuations to hold data, or to communicate between plugins as the values in the array
are visible to any plugin which can access the session or transaction. The array values are opaque
to Traffic Server and it will not dereference nor release them. Plugins are responsible for cleaning up any
resources pointed to by the values or, if the values are simply values, there is no need for the plugin
to remove them after the session or transaction has completed.</p>
<p>To avoid collisions between plugins a plugin should first <em>reserve</em> an index in the array. A
plugin can reserve a slot of a particular type by calling <a class="reference internal" href="#c.TSUserArgIndexReserve" title="TSUserArgIndexReserve"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSUserArgIndexReserve()</span></code></a>. The arguments are:</p>
<dl class="simple">
<dt><em>type</em></dt><dd><p>The type for which the plugin intend to reserve a slot. See <code class="code docutils literal notranslate"><span class="pre">TSUserArgType</span></code> above.</p>
</dd>
<dt><em>name</em></dt><dd><p>An identifying name for the plugin that reserved the index. Required.</p>
</dd>
<dt><em>description</em></dt><dd><p>An optional description of the use of the arg. This can be <code class="code docutils literal notranslate"><span class="pre">nullptr</span></code>.</p>
</dd>
<dt><em>arg_idx</em></dt><dd><p>A pointer to an <code class="code docutils literal notranslate"><span class="pre">int</span></code>. If an index is successfully reserved, the <code class="code docutils literal notranslate"><span class="pre">int</span></code> pointed at by this is
set to the reserved index. It is not modified if the call is unsuccessful.</p>
</dd>
</dl>
<p>The functions return <code class="code docutils literal notranslate"><span class="pre">TS_SUCCESS</span></code> if an index was reserved,
<code class="code docutils literal notranslate"><span class="pre">TS_ERROR</span></code> if not (most likely because all of the indices have already been reserved).
Generally this will be a file or library scope global which is set at plugin initialization. This
function is used in the example remap plugin <a class="reference external" href="https://github.com/apache/trafficserver/blob/master/example/plugins/c-api/remap/remap.cc">example/plugins/c-api/remap/remap.cc</a>. The index is stored
in the plugin global <code class="code docutils literal notranslate"><span class="pre">arg_index</span></code>. Transaction and session plugin argument indices are reserved
independently.</p>
<p>To look up the owner of a reserved index use <a class="reference internal" href="#c.TSUserArgIndexNameLookup" title="TSUserArgIndexNameLookup"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSUserArgIndexNameLookup()</span></code></a>, with the appropriate type.
If <em>name</em> is found as an owner, the function returns <code class="code docutils literal notranslate"><span class="pre">TS_SUCCESS</span></code> and <em>arg_index</em> is
updated with the index reserved under that name. If <em>description</em> is not <code class="code docutils literal notranslate"><span class="pre">NULL</span></code> then
the character pointer to which it points will be updated to point at the description for that
reserved index. This enables communication between plugins where plugin “A” reserves an index under
a well known name and plugin “B” locates the index by looking it up under that name.</p>
<p>The owner of a reserved index can be found with <a class="reference internal" href="#c.TSUserArgIndexLookup" title="TSUserArgIndexLookup"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSUserArgIndexLookup()</span></code></a>. If
<em>arg_index</em> is reserved then the function returns <code class="code docutils literal notranslate"><span class="pre">TS_SUCCESS</span></code> and the pointers referred
to by <em>name</em> and <em>description</em> are updated. <em>name</em> must point at a valid character
pointer but <em>description</em> can be <code class="code docutils literal notranslate"><span class="pre">NULL</span></code> in which case it is ignored.</p>
<p>Manipulating the array is simple. <a class="reference internal" href="#c.TSUserArgSet" title="TSUserArgSet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSUserArgSet()</span></code></a> sets the array slot at <em>arg_idx</em>, for the
particular type based on the provide data pointer. The values can be retrieved with the value from
<a class="reference internal" href="#c.TSUserArgGet" title="TSUserArgGet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSUserArgGet()</span></code></a>. Values that have not been set are <code class="code docutils literal notranslate"><span class="pre">NULL</span></code>. Note that both the setter and the getter are
context sensitive, based on the type (or value) of the data pointer:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 84%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>data type</p></th>
<th class="head"><p>Semantics</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TSHttpTxn</span></code></p></td>
<td><p>The implicit context is for a transaction (<code class="docutils literal notranslate"><span class="pre">TS_USER_ARGS_TXN</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">TSHttpSsn</span></code></p></td>
<td><p>The implicit context is for a transaction (<code class="docutils literal notranslate"><span class="pre">TS_USER_ARGS_SSN</span></code>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">TSVConn</span></code></p></td>
<td><p>The implicit context is for a transaction (<code class="docutils literal notranslate"><span class="pre">TS_USER_ARGS_VCONN</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nullptr</span></code></p></td>
<td><p>The implicit context is global (<code class="docutils literal notranslate"><span class="pre">TS_USER_ARGS_GLB</span></code>)</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Note that neither <a class="reference internal" href="#c.TSUserArgSet" title="TSUserArgSet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSUserArgSet()</span></code></a> nor <a class="reference internal" href="#c.TSUserArgGet" title="TSUserArgGet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSUserArgGet()</span></code></a> has any type safety on the <em>data</em>
parameters, being a <code class="docutils literal notranslate"><span class="pre">void*</span></code> pointer.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Session arguments persist for the entire session, which means potentially across all transactions in that session.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Following arg index reservations is conventional, it is not enforced.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.en.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release-process/index.en.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/index.en.html">Contributing to Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing-with-vagrant/index.en.html">Using Vagrant to Test Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debugging/index.en.html">Debugging and Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../threads-and-events.en.html">Threads and Event Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cache-architecture/index.en.html">Cache Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging-architecture/index.en.html">Logging Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-libraries/index.en.html">Internal libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.en.html">Plugin Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config-vars.en.html">Configuration Variable Implementation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.en.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../continuous-integration/index.en.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/index.en.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../host-resolution-proposal.en.html">Host Resolution Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client-session-architecture.en.html">An Overview Client Sessions and Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core-architecture/index.en.html">Core Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../design-documents/index.en.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../layout/index.en.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.en.html">Testing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonrpc/index.en.html">JSONRPC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.en.html">Developer’s Guide</a><ul>
  <li><a href="../index.en.html">API Reference</a><ul>
  <li><a href="index.en.html">API Functions</a><ul>
      <li>Previous: <a href="TSUrlStringGet.en.html" title="previous chapter">TSUrlStringGet</a></li>
      <li>Next: <a href="TSUuidCreate.en.html" title="next chapter">TSUuidCreate</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/developer-guide/api/functions/TSUserArgs.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>