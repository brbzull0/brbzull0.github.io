

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TSAPI &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/override.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="TSAcceptor" href="TSAcceptor.en.html" />
    <link rel="prev" title="API Functions" href="index.en.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="tsapi">
<span id="developer-tsapi"></span><h1>TSAPI<a class="headerlink" href="#tsapi" title="Permalink to this headline">¶</a></h1>
<p>Introduction to the Apache Traffic Server API.</p>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;ts/ts.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;ts/remap.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The Apache Traffic Server API enables you to create plugins, using
the C programming language, that customize the behavior of your
Traffic Server installation.</p>
<p>Traffic Server enables sophisticated caching and processing of
web-related traffic, such as DNS and HTTP requests and responses.
Traffic Server itself consists of an event-driven loop that can be
simplified as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">get_next_event</span><span class="p">();</span>
    <span class="n">handle_event</span> <span class="p">(</span><span class="n">event</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You compile your plugin source code to create a shared library that
Traffic Server loads when it is started. Your plugin contains
callback functions that are registered for specific Traffic Server
events. When Traffic Server needs to process an event, it invokes
any and all call-back functions you’ve registered for that event
type.</p>
<p>Possible uses for plugins include the following:</p>
<ul class="simple">
<li><p>HTTP processing plugins can filter, denylist, authorize users or transform content.</p></li>
<li><p>Protocol plugins can enable Traffic Server to proxy-cache new protocol content.</p></li>
<li><p>A denylisting plugin denies attempts to access web sites that are off-limits.</p></li>
<li><p>Append transform plugins add data to HTTP response content.</p></li>
<li><p>An image conversion plugin transforms JPEG images to GIF images.</p></li>
<li><p>Compression plugins send response content to a compression server
that compresses the data (alternatively, a compression library local
to the Traffic Server host machine could do the compression).</p></li>
<li><p>Authorization plugins check a user’s permissions to access
particular web sites. The plugin could consult a local authorization
program or send queries to an authorization server.</p></li>
<li><p>A plugin that gathers client information from request headers
and enters this information in a database.</p></li>
<li><p>A protocol plugin listen for specific protocol requests on a
designated port and then uses Traffic Server’s proxy server and
cache to serve client requests.</p></li>
</ul>
</div>
<div class="section" id="naming-conventions">
<span id="developer-tsapi-naming-conventions"></span><h2>Naming Conventions<a class="headerlink" href="#naming-conventions" title="Permalink to this headline">¶</a></h2>
<p>The Traffic Server API adheres to the following naming conventions:</p>
<ul class="simple">
<li><p>The TS prefix is used for all function and variable names defined
in the Traffic Server API. For example, <a class="reference internal" href="../types/TSEvent.en.html#c.TS_EVENT_NONE" title="TS_EVENT_NONE"><code class="xref c c-data docutils literal notranslate"><span class="pre">TS_EVENT_NONE</span></code></a>, <a class="reference internal" href="TSTypes.en.html#c.TSMutex" title="TSMutex"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSMutex</span></code></a>,
and <a class="reference internal" href="TSContCreate.en.html#c.TSContCreate" title="TSContCreate"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSContCreate()</span></code></a>.</p></li>
<li><p>Enumerated values are always written in all uppercase letters.
For example, <a class="reference internal" href="../types/TSEvent.en.html#c.TS_EVENT_NONE" title="TS_EVENT_NONE"><code class="xref c c-data docutils literal notranslate"><span class="pre">TS_EVENT_NONE</span></code></a> and <a class="reference internal" href="../types/TSVConnCloseFlags.en.html#c.TS_VC_CLOSE_ABORT" title="TS_VC_CLOSE_ABORT"><code class="xref c c-data docutils literal notranslate"><span class="pre">TS_VC_CLOSE_ABORT</span></code></a>.</p></li>
<li><p>Constant values are all uppercase; enumerated values can be seen
as a subset of constants. For example, <code class="xref c c-data docutils literal notranslate"><span class="pre">TS_URL_SCHEME_FILE</span></code> and
<a class="reference internal" href="../../plugins/http-headers/mime-headers.en.html#c.TS_MIME_FIELD_ACCEPT" title="TS_MIME_FIELD_ACCEPT"><code class="xref c c-data docutils literal notranslate"><span class="pre">TS_MIME_FIELD_ACCEPT</span></code></a>.</p></li>
<li><p>The names of defined types are mixed-case. For example, <a class="reference internal" href="TSTypes.en.html#c.TSHttpSsn" title="TSHttpSsn"><code class="xref c c-type docutils literal notranslate"><span class="pre">TSHttpSsn</span></code></a>
and <a class="reference internal" href="TSTypes.en.html#c.TSHttpTxn" title="TSHttpTxn"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSHttpTxn()</span></code></a>. <a class="reference internal" href="TSDebug.en.html#c.TSDebug" title="TSDebug"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSDebug()</span></code></a></p></li>
<li><p>Function names are mixed-case. For example, <a class="reference internal" href="TSUrlCreate.en.html#c.TSUrlCreate" title="TSUrlCreate"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSUrlCreate()</span></code></a>
and <a class="reference internal" href="TSContDestroy.en.html#c.TSContDestroy" title="TSContDestroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSContDestroy()</span></code></a>.</p></li>
<li><p>Function names use the following subject-verb naming style:
TS-&lt;subject&gt;-&lt;verb&gt;, where &lt;subject&gt; goes from general to specific.
This makes it easier to determine what a function does by reading
its name. For example, the function to retrieve the password field
(the specific subject) from a URL (the general subject) is
<a class="reference internal" href="TSUrlHostGet.en.html#c.TSUrlPasswordGet" title="TSUrlPasswordGet"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSUrlPasswordGet()</span></code></a>.</p></li>
<li><p>Common verbs like Create, Destroy, Get, Set, Copy, Find, Retrieve,
Insert, Remove, and Delete are used only when appropriate.</p></li>
</ul>
</div>
<div class="section" id="plugin-loading-and-configuration">
<span id="developer-tsapi-plugin-loading"></span><h2>Plugin Loading and Configuration<a class="headerlink" href="#plugin-loading-and-configuration" title="Permalink to this headline">¶</a></h2>
<p>When Traffic Server is first started, it consults the plugin.config
file to determine the names of all shared plugin libraries that
need to be loaded. The plugin.config file also defines arguments
that are to be passed to each plugin’s initialization function,
<a class="reference internal" href="TSPluginInit.en.html#c.TSPluginInit" title="TSPluginInit"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSPluginInit()</span></code></a>. The <a class="reference internal" href="../../../admin-guide/files/records.config.en.html#std-configfile-records.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">records.config</span></code></a> file defines the path to
each plugin shared library.</p>
<p>The sample <a class="reference internal" href="../../../admin-guide/files/plugin.config.en.html#std-configfile-plugin.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">plugin.config</span></code></a> file below contains a comment line, a blank
line, and two plugin configurations:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># This is a comment line.
my-plugin.so www.junk.com www.trash.com www.garbage.com
some-plugin.so arg1 arg2 $proxy.config.http.cache.on
</pre></div>
</div>
<p>Each plugin configuration in the <a class="reference internal" href="../../../admin-guide/files/plugin.config.en.html#std-configfile-plugin.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">plugin.config</span></code></a> file resembles
a UNIX or DOS shell command; each line in <a class="reference internal" href="../../../admin-guide/files/plugin.config.en.html#std-configfile-plugin.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">plugin.config</span></code></a>
cannot exceed 1023 characters.</p>
<p>The first plugin configuration is for a plugin named my-plugin.so.
It contains three arguments that are to be passed to that plugin’s
initialization routine. The second configuration is for a plugin
named some-plugin.so; it contains three arguments. The last argument,
$proxy.config.http.cache.on, is actually a configuration variable.
Traffic Server will look up the specified configuration variable
and substitute its value.</p>
<p>Plugins are loaded and initialized by Traffic Server in the order
they appear in the <a class="reference internal" href="../../../admin-guide/files/plugin.config.en.html#std-configfile-plugin.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">plugin.config</span></code></a> file.</p>
</div>
<div class="section" id="plugin-initialization">
<span id="developer-tsapi-plugin-init"></span><h2>Plugin Initialization<a class="headerlink" href="#plugin-initialization" title="Permalink to this headline">¶</a></h2>
<p>Each plugin must define an initialization function named
<a class="reference internal" href="TSPluginInit.en.html#c.TSPluginInit" title="TSPluginInit"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSPluginInit()</span></code></a> that Traffic Server invokes when the
plugin is loaded. <a class="reference internal" href="TSPluginInit.en.html#c.TSPluginInit" title="TSPluginInit"><code class="xref c c-func docutils literal notranslate"><span class="pre">TSPluginInit()</span></code></a> is commonly used to
read configuration information and register hooks for event
notification.</p>
</div>
<div class="section" id="files">
<h2>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../../../admin-guide/files/plugin.config.en.html#std-configfile-plugin.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">plugin.config</span></code></a>,
<a class="reference internal" href="../../../admin-guide/files/records.config.en.html#std-configfile-records.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">records.config</span></code></a></p>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><em class="manpage">TSPluginInit(3ts)</em></p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.en.html">Administrator’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.en.html">Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../release-process/index.en.html">Release Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../contributing/index.en.html">Contributing to Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing-with-vagrant/index.en.html">Using Vagrant to Test Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../debugging/index.en.html">Debugging and Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../threads-and-events.en.html">Threads and Event Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cache-architecture/index.en.html">Cache Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../logging-architecture/index.en.html">Logging Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../internal-libraries/index.en.html">Internal libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins/index.en.html">Plugin Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../config-vars.en.html">Configuration Variable Implementation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.en.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../continuous-integration/index.en.html">Continuous Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../documentation/index.en.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../host-resolution-proposal.en.html">Host Resolution Proposal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client-session-architecture.en.html">An Overview Client Sessions and Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../core-architecture/index.en.html">Core Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../design-documents/index.en.html">Design Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../layout/index.en.html">Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../testing/index.en.html">Testing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jsonrpc/index.en.html">JSONRPC</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.en.html">Developer’s Guide</a><ul>
  <li><a href="../index.en.html">API Reference</a><ul>
  <li><a href="index.en.html">API Functions</a><ul>
      <li>Previous: <a href="index.en.html" title="previous chapter">API Functions</a></li>
      <li>Next: <a href="TSAcceptor.en.html" title="next chapter">TSAcceptor</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../../_sources/developer-guide/api/functions/TSAPI.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>