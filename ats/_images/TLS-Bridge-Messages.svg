<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="878.6673px" preserveAspectRatio="none" style="width:723px;height:878px;" version="1.1" viewBox="0 0 723 878" width="723.0842px" zoomAndPan="magnify"><defs><filter height="300%" id="fbuwo11stnq4t" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.370775821037601"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="2.741551642075202" dy="2.741551642075202" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDFFDD" height="869.029" style="stroke: #A80036; stroke-width: 0.6853879105188005;" width="422.199" x="105.207" y="2.7416"/><text fill="#000000" font-family="sans-serif" font-size="8.91" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58.9434" x="286.8348" y="11.0121">Ingress ATS</text><rect fill="#DDDDFF" height="869.029" style="stroke: #A80036; stroke-width: 0.6853879105188005;" width="49.3479" x="580.1809" y="2.7416"/><text fill="#000000" font-family="sans-serif" font-size="8.91" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="45.2356" x="582.237" y="11.0121">Peer ATS</text><rect fill="#FFFFFF" filter="url(#fbuwo11stnq4t)" height="725.0815" style="stroke: #A80036; stroke-width: 0.6853879105188005;" width="6.8539" x="130.5664" y="81.3738"/><rect fill="#FFFFFF" filter="url(#fbuwo11stnq4t)" height="625.2451" style="stroke: #A80036; stroke-width: 0.6853879105188005;" width="6.8539" x="316.9919" y="181.2101"/><rect fill="#FFFFFF" filter="url(#fbuwo11stnq4t)" height="518.5549" style="stroke: #A80036; stroke-width: 0.6853879105188005;" width="6.8539" x="503.4174" y="287.9004"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005; stroke-dasharray: 5.0,5.0;" x1="40.4379" x2="40.4379" y1="60.1267" y2="812.6238"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005; stroke-dasharray: 5.0,5.0;" x1="133.9933" x2="133.9933" y1="60.1267" y2="812.6238"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005; stroke-dasharray: 5.0,5.0;" x1="226.8634" x2="226.8634" y1="60.1267" y2="812.6238"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005; stroke-dasharray: 5.0,5.0;" x1="320.4188" x2="320.4188" y1="60.1267" y2="812.6238"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005; stroke-dasharray: 5.0,5.0;" x1="413.6316" x2="413.6316" y1="60.1267" y2="812.6238"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005; stroke-dasharray: 5.0,5.0;" x1="506.8444" x2="506.8444" y1="60.1267" y2="812.6238"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005; stroke-dasharray: 5.0,5.0;" x1="604.8548" x2="604.8548" y1="60.1267" y2="812.6238"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005; stroke-dasharray: 5.0,5.0;" x1="695.326" x2="695.326" y1="60.1267" y2="812.6238"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="26.7301" x="25.3594" y="57.8637">Client</text><ellipse cx="40.7806" cy="9.8899" fill="#FEFECE" filter="url(#fbuwo11stnq4t)" rx="5.4831" ry="5.4831" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><path d="M40.7806,15.373 L40.7806,33.8785 M31.8705,20.8561 L49.6906,20.8561 M40.7806,33.8785 L31.8705,44.1593 M40.7806,33.8785 L49.6906,44.1593 " fill="none" filter="url(#fbuwo11stnq4t)" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="26.7301" x="25.3594" y="820.8451">Client</text><ellipse cx="40.7806" cy="829.9619" fill="#FEFECE" filter="url(#fbuwo11stnq4t)" rx="5.4831" ry="5.4831" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><path d="M40.7806,835.445 L40.7806,853.9505 M31.8705,840.9281 L49.6906,840.9281 M40.7806,853.9505 L31.8705,864.2313 M40.7806,853.9505 L49.6906,864.2313 " fill="none" filter="url(#fbuwo11stnq4t)" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="26.7301" x="118.5721" y="46.6941">Client</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="47.9772" x="107.9486" y="57.8637">NetVConn</text><ellipse cx="133.9933" cy="26.8212" fill="#FEFECE" filter="url(#fbuwo11stnq4t)" rx="8.2247" ry="8.2247" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><line style="stroke: #A80036; stroke-width: 1.370775821037601;" x1="125.7687" x2="142.218" y1="36.4166" y2="36.4166"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="26.7301" x="118.5721" y="820.8451">Client</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="47.9772" x="107.9486" y="832.0147">NetVConn</text><ellipse cx="133.9933" cy="845.2439" fill="#FEFECE" filter="url(#fbuwo11stnq4t)" rx="8.2247" ry="8.2247" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><line style="stroke: #A80036; stroke-width: 1.370775821037601;" x1="125.7687" x2="142.218" y1="854.8394" y2="854.8394"/><rect fill="#FEFECE" filter="url(#fbuwo11stnq4t)" height="31.9348" style="stroke: #A80036; stroke-width: 1.028081865778201;" width="44.5502" x="203.5602" y="24.765"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="34.9548" x="208.3579" y="38.4694">Ingress</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="18.5055" x="216.5826" y="49.6391">ATS</text><rect fill="#FEFECE" filter="url(#fbuwo11stnq4t)" height="31.9348" style="stroke: #A80036; stroke-width: 1.028081865778201;" width="44.5502" x="203.5602" y="811.9384"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="34.9548" x="208.3579" y="825.6428">Ingress</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="18.5055" x="216.5826" y="836.8125">ATS</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="26.7301" x="304.9976" y="46.6941">Client</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="31.5278" x="302.5988" y="57.8637">VConn</text><ellipse cx="320.4188" cy="26.8212" fill="#FEFECE" filter="url(#fbuwo11stnq4t)" rx="8.2247" ry="8.2247" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><line style="stroke: #A80036; stroke-width: 1.370775821037601;" x1="312.1942" x2="328.6435" y1="36.4166" y2="36.4166"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="26.7301" x="304.9976" y="820.8451">Client</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="31.5278" x="302.5988" y="832.0147">VConn</text><ellipse cx="320.4188" cy="845.2439" fill="#FEFECE" filter="url(#fbuwo11stnq4t)" rx="8.2247" ry="8.2247" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><line style="stroke: #A80036; stroke-width: 1.370775821037601;" x1="312.1942" x2="328.6435" y1="854.8394" y2="854.8394"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="50.7187" x="386.2161" y="57.8637">TLS Bridge</text><ellipse cx="413.6316" cy="37.9908" fill="#FEFECE" filter="url(#fbuwo11stnq4t)" rx="8.2247" ry="8.2247" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><line style="stroke: #A80036; stroke-width: 1.370775821037601;" x1="405.4069" x2="421.8563" y1="47.5863" y2="47.5863"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="50.7187" x="386.2161" y="820.8451">TLS Bridge</text><ellipse cx="413.6316" cy="834.0743" fill="#FEFECE" filter="url(#fbuwo11stnq4t)" rx="8.2247" ry="8.2247" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><line style="stroke: #A80036; stroke-width: 1.370775821037601;" x1="405.4069" x2="421.8563" y1="843.6697" y2="843.6697"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="21.9324" x="493.822" y="46.6941">Peer</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="31.5278" x="489.0243" y="57.8637">VConn</text><ellipse cx="506.8444" cy="26.8212" fill="#FEFECE" filter="url(#fbuwo11stnq4t)" rx="8.2247" ry="8.2247" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><line style="stroke: #A80036; stroke-width: 1.370775821037601;" x1="498.6197" x2="515.069" y1="36.4166" y2="36.4166"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="21.9324" x="493.822" y="820.8451">Peer</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="31.5278" x="489.0243" y="832.0147">VConn</text><ellipse cx="506.8444" cy="845.2439" fill="#FEFECE" filter="url(#fbuwo11stnq4t)" rx="8.2247" ry="8.2247" style="stroke: #A80036; stroke-width: 1.370775821037601;"/><line style="stroke: #A80036; stroke-width: 1.370775821037601;" x1="498.6197" x2="515.069" y1="854.8394" y2="854.8394"/><rect fill="#FEFECE" filter="url(#fbuwo11stnq4t)" height="31.9348" style="stroke: #A80036; stroke-width: 1.028081865778201;" width="31.5278" x="587.7201" y="24.765"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="21.9324" x="592.5178" y="38.4694">Peer</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="18.5055" x="594.2313" y="49.6391">ATS</text><rect fill="#FEFECE" filter="url(#fbuwo11stnq4t)" height="31.9348" style="stroke: #A80036; stroke-width: 1.028081865778201;" width="31.5278" x="587.7201" y="811.9384"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="21.9324" x="592.5178" y="825.6428">Peer</text><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="18.5055" x="594.2313" y="836.8125">ATS</text><rect fill="#FEFECE" filter="url(#fbuwo11stnq4t)" height="20.7651" style="stroke: #A80036; stroke-width: 1.028081865778201;" width="43.8648" x="672.0228" y="35.9347"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="34.2694" x="676.8206" y="49.6391">Service</text><rect fill="#FEFECE" filter="url(#fbuwo11stnq4t)" height="20.7651" style="stroke: #A80036; stroke-width: 1.028081865778201;" width="43.8648" x="672.0228" y="811.9384"/><text fill="#000000" font-family="sans-serif" font-size="9.5954" lengthAdjust="spacingAndGlyphs" textLength="34.2694" x="676.8206" y="825.6428">Service</text><rect fill="#FFFFFF" filter="url(#fbuwo11stnq4t)" height="725.0815" style="stroke: #A80036; stroke-width: 0.6853879105188005;" width="6.8539" x="130.5664" y="81.3738"/><rect fill="#FFFFFF" filter="url(#fbuwo11stnq4t)" height="625.2451" style="stroke: #A80036; stroke-width: 0.6853879105188005;" width="6.8539" x="316.9919" y="181.2101"/><rect fill="#FFFFFF" filter="url(#fbuwo11stnq4t)" height="518.5549" style="stroke: #A80036; stroke-width: 0.6853879105188005;" width="6.8539" x="503.4174" y="287.9004"/><polygon fill="#008000" points="48.3198,78.6322,41.466,81.3738,48.3198,84.1153,45.5783,81.3738" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><polygon fill="#008000" points="218.9814,78.6322,225.8353,81.3738,218.9814,84.1153,221.723,81.3738" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><line style="stroke: #008000; stroke-width: 0.6853879105188005;" x1="44.2075" x2="223.0938" y1="81.3738" y2="81.3738"/><text fill="#008000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="17.1347" x="52.4322" y="77.9927">TCP</text><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="49.3479" x="72.3084" y="77.9927">Handshake</text><polygon fill="#0000FF" points="122.3417,98.5995,129.1956,101.341,122.3417,104.0826,125.0833,101.341" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="40.7806" x2="126.4541" y1="101.341" y2="101.341"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="38.3817" x="45.5783" y="97.9599">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.2132" x="86.7016" y="97.9599">Service</text><polygon fill="#A80036" points="218.9814,118.5668,225.8353,121.3083,218.9814,124.0499,221.723,121.3083" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005;" x1="137.4203" x2="223.0938" y1="121.3083" y2="121.3083"/><text fill="#000000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="60.9995" x="142.218" y="117.9272">Parse request</text><polygon fill="#000000" points="405.4069,138.534,412.2608,141.2756,405.4069,144.0171,408.1485,141.2756" style="stroke: #000000; stroke-width: 0.6853879105188005;"/><line style="stroke: #000000; stroke-width: 0.6853879105188005;" x1="227.2061" x2="409.5193" y1="141.2756" y2="141.2756"/><text fill="#000000" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="115.1452" x="232.0038" y="137.8945">READ_REQUEST_HDR_HOOK</text><polygon fill="#A80036" points="234.7454,158.5013,227.8915,161.2429,234.7454,163.9844,232.0038,161.2429" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005;" x1="230.633" x2="412.9462" y1="161.2429" y2="161.2429"/><text fill="#000000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="93.2128" x="238.8577" y="157.8618">TSHttpTxnIntercept()</text><polygon fill="#A80036" points="308.7673,178.4686,315.6211,181.2101,308.7673,183.9517,311.5088,181.2101" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005;" x1="227.2061" x2="312.8796" y1="181.2101" y2="181.2101"/><text fill="#000000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="29.4717" x="232.0038" y="177.829">Create</text><polygon fill="#0000FF" points="218.9814,198.4359,225.8353,201.1774,218.9814,203.919,221.723,201.1774" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="137.4203" x2="223.0938" y1="201.1774" y2="201.1774"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="38.3817" x="142.218" y="197.7963">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.2132" x="183.3413" y="197.7963">Service</text><polygon fill="#0000FF" points="308.7673,218.4031,315.6211,221.1447,308.7673,223.8862,311.5088,221.1447" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="227.2061" x2="312.8796" y1="221.1447" y2="221.1447"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="38.3817" x="232.0038" y="217.7636">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.2132" x="273.1271" y="217.7636">Service</text><polygon fill="#000000" points="405.4069,241.7974,412.2608,244.5389,405.4069,247.2805,408.1485,244.5389" style="stroke: #000000; stroke-width: 0.6853879105188005;"/><line style="stroke: #000000; stroke-width: 0.6853879105188005;" x1="227.2061" x2="409.5193" y1="244.5389" y2="244.5389"/><text fill="#000000" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="104.179" x="232.0038" y="241.1578">TS_EVENT_NET_ACCEPT</text><path d="M416.7158,230.1458 L416.7158,247.2805 L594.2313,247.2805 L594.2313,236.9996 L587.3774,230.1458 L416.7158,230.1458 " fill="#FBFB77" filter="url(#fbuwo11stnq4t)" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><path d="M587.3774,230.1458 L587.3774,236.9996 L594.2313,236.9996 L587.3774,230.1458 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="163.1223" x="420.8282" y="241.8432">Client VConn is passed in event data.</text><polygon fill="#A80036" points="234.7454,265.1916,227.8915,267.9331,234.7454,267.9331" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005;" x1="227.2061" x2="412.9462" y1="267.9331" y2="267.9331"/><text fill="#000000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="73.3365" x="238.8577" y="264.552">TSHttpConnect()</text><polygon fill="#A80036" points="495.1928,285.1589,502.0466,287.9004,495.1928,290.642,497.9343,287.9004" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005;" x1="227.2061" x2="499.3051" y1="287.9004" y2="287.9004"/><text fill="#000000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="28.1009" x="232.0038" y="284.5193">create</text><polygon fill="#A80036" points="405.4069,308.5531,412.2608,308.5531,405.4069,311.2946" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005;" x1="227.2061" x2="412.9462" y1="307.8677" y2="307.8677"/><text fill="#000000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="80.8758" x="232.0038" y="304.4866">return Peer VConn</text><polygon fill="#0000FF" points="495.1928,325.0934,502.0466,327.835,495.1928,330.5765,497.9343,327.835" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="413.6316" x2="499.3051" y1="327.835" y2="327.835"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="38.3817" x="418.4293" y="324.4539">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="19.8762" x="459.5526" y="324.4539">Peer</text><polygon fill="#A80036" points="234.7454,345.0607,227.8915,347.8022,234.7454,350.5438,232.0038,347.8022" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><line style="stroke: #A80036; stroke-width: 0.6853879105188005;" x1="230.633" x2="502.732" y1="347.8022" y2="347.8022"/><text fill="#000000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="60.9995" x="238.8577" y="344.4211">parse request</text><polygon fill="#008000" points="234.7454,365.028,227.8915,367.7695,234.7454,370.5111,232.0038,367.7695" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><polygon fill="#008000" points="596.6302,365.028,603.4841,367.7695,596.6302,370.5111,599.3717,367.7695" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><line style="stroke: #008000; stroke-width: 0.6853879105188005;" x1="230.633" x2="600.7425" y1="367.7695" y2="367.7695"/><text fill="#008000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="17.1347" x="238.8577" y="364.3884">TCP</text><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="49.3479" x="258.7339" y="364.3884">Handshake</text><polygon fill="#008000" points="234.7454,384.9952,227.8915,387.7368,234.7454,390.4783,232.0038,387.7368" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><polygon fill="#008000" points="596.6302,384.9952,603.4841,387.7368,596.6302,390.4783,599.3717,387.7368" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><line style="stroke: #008000; stroke-width: 0.6853879105188005;" x1="230.633" x2="600.7425" y1="387.7368" y2="387.7368"/><text fill="#008000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="15.7639" x="238.8577" y="384.3557">TLS</text><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="49.3479" x="257.3632" y="384.3557">Handshake</text><polygon fill="#0000FF" points="495.1928,404.9625,502.0466,407.7041,495.1928,410.4456,497.9343,407.7041" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="227.2061" x2="499.3051" y1="407.7041" y2="407.7041"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.8986" x="232.0038" y="404.323">200 OK</text><polygon fill="#0000FF" points="421.1709,438.7286,414.317,441.4701,421.1709,444.2117,418.4293,441.4701" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="417.0585" x2="502.732" y1="441.4701" y2="441.4701"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.8986" x="425.2832" y="438.089">200 OK</text><path d="M247.425,416.7051 L247.425,454.4015 L407.1204,454.4015 L407.1204,423.559 L400.2665,416.7051 L247.425,416.7051 " fill="#FBFB77" filter="url(#fbuwo11stnq4t)" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><path d="M400.2665,416.7051 L400.2665,423.559 L407.1204,423.559 L400.2665,416.7051 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="145.3022" x="251.5374" y="428.4026">This signals a raw TLS connection</text><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="142.5607" x="251.5374" y="438.7744">to the Peer ATS. The response is</text><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="142.5607" x="251.5374" y="449.1463">parsed and consumed by Plugin.</text><path d="M329.6716,464.27 L329.6716,481.4047 L494.1647,481.4047 L494.1647,471.1239 L487.3108,464.27 L329.6716,464.27 " fill="#FBFB77" filter="url(#fbuwo11stnq4t)" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><path d="M487.3108,464.27 L487.3108,471.1239 L494.1647,471.1239 L487.3108,464.27 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="150.1" x="333.7839" y="475.9674">Plugin switches to byte forwarding.</text><polygon fill="#0000FF" points="405.4069,502.7427,412.2608,505.4843,405.4069,508.2258,408.1485,505.4843" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="323.8458" x2="409.5193" y1="505.4843" y2="505.4843"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="38.3817" x="328.6435" y="502.1032">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.2132" x="369.7668" y="502.1032">Service</text><path d="M194.6502,491.0911 L194.6502,508.2258 L310.4807,508.2258 L310.4807,497.945 L303.6268,491.0911 L194.6502,491.0911 " fill="#FBFB77" filter="url(#fbuwo11stnq4t)" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><path d="M303.6268,491.0911 L303.6268,497.945 L310.4807,497.945 L303.6268,491.0911 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="101.4374" x="198.7625" y="502.7886">Original Client Request.</text><polygon fill="#0000FF" points="495.1928,526.137,502.0466,528.8785,495.1928,531.6201,497.9343,528.8785" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="413.6316" x2="499.3051" y1="528.8785" y2="528.8785"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="38.3817" x="418.4293" y="525.4974">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.2132" x="459.5526" y="525.4974">Service</text><polygon fill="#0000FF" points="596.6302,546.1042,603.4841,548.8458,596.6302,551.5873,599.3717,548.8458" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="510.2713" x2="600.7425" y1="548.8458" y2="548.8458"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="38.3817" x="515.069" y="545.4647">CONNECT</text><text fill="#0000FF" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.2132" x="556.1923" y="545.4647">Service</text><polygon fill="#008000" points="612.3941,566.0715,605.5402,568.8131,612.3941,571.5546,609.6525,568.8131" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><polygon fill="#008000" points="687.1014,566.0715,693.9553,568.8131,687.1014,571.5546,689.8429,568.8131" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><line style="stroke: #008000; stroke-width: 0.6853879105188005;" x1="608.2818" x2="691.2137" y1="568.8131" y2="568.8131"/><text fill="#008000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="17.1347" x="616.5064" y="565.432">TCP</text><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="49.3479" x="636.3827" y="565.432">Handshake</text><polygon fill="#008000" points="612.3941,589.4657,605.5402,592.2073,612.3941,594.9488,609.6525,592.2073" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><polygon fill="#008000" points="687.1014,589.4657,693.9553,592.2073,687.1014,594.9488,689.8429,592.2073" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><line style="stroke: #008000; stroke-width: 0.6853879105188005;" x1="608.2818" x2="691.2137" y1="592.2073" y2="592.2073"/><text fill="#008000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="15.7639" x="616.5064" y="588.8262">TLS</text><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="49.3479" x="635.0119" y="588.8262">Handshake</text><path d="M462.6368,577.8141 L462.6368,594.9488 L598.3436,594.9488 L598.3436,584.668 L591.4898,577.8141 L462.6368,577.8141 " fill="#FBFB77" filter="url(#fbuwo11stnq4t)" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><path d="M591.4898,577.8141 L591.4898,584.668 L598.3436,584.668 L591.4898,577.8141 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="121.3137" x="466.7492" y="589.5116">Optional, based on 'Service'</text><polygon fill="#0000FF" points="517.8106,612.8599,510.9567,615.6015,517.8106,618.3431,515.069,615.6015" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="513.6982" x2="604.1694" y1="615.6015" y2="615.6015"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.8986" x="521.9229" y="612.2204">200 OK</text><polygon fill="#0000FF" points="421.1709,632.8272,414.317,635.5688,421.1709,638.3103,418.4293,635.5688" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="417.0585" x2="502.732" y1="635.5688" y2="635.5688"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.8986" x="425.2832" y="632.1877">200 OK</text><polygon fill="#0000FF" points="331.3851,652.7945,324.5312,655.5361,331.3851,658.2776,328.6435,655.5361" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="327.2727" x2="412.9462" y1="655.5361" y2="655.5361"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.8986" x="335.4974" y="652.155">200 OK</text><polygon fill="#0000FF" points="234.7454,691.7465,227.8915,694.488,234.7454,697.2296,232.0038,694.488" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="230.633" x2="316.3065" y1="694.488" y2="694.488"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.8986" x="238.8577" y="691.107">200 OK</text><path d="M5.4831,664.5371 L5.4831,712.5143 L221.3803,712.5143 L221.3803,671.391 L214.5264,664.5371 L5.4831,664.5371 " fill="#FBFB77" filter="url(#fbuwo11stnq4t)" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><path d="M214.5264,664.5371 L214.5264,671.391 L221.3803,671.391 L214.5264,664.5371 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="201.504" x="9.5954" y="676.2346">ATS updates the incoming response based on</text><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="199.4479" x="9.5954" y="686.6064">local configuration. This means what goes out</text><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="191.2232" x="9.5954" y="696.9783">to the Client may be different than what the</text><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="174.0885" x="9.5954" y="707.3501">plugin wrote (forwarded from Peer ATS).</text><polygon fill="#000000" points="405.4069,734.1254,412.2608,736.867,405.4069,739.6085,408.1485,736.867" style="stroke: #000000; stroke-width: 0.6853879105188005;"/><line style="stroke: #000000; stroke-width: 0.6853879105188005;" x1="227.2061" x2="409.5193" y1="736.867" y2="736.867"/><text fill="#000000" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="120.6283" x="232.0038" y="733.4859">SEND_RESPONSE_HDR_HOOK</text><path d="M416.7158,722.4738 L416.7158,739.6085 L570.2427,739.6085 L570.2427,729.3277 L563.3889,722.4738 L416.7158,722.4738 " fill="#FBFB77" filter="url(#fbuwo11stnq4t)" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><path d="M563.3889,722.4738 L563.3889,729.3277 L570.2427,729.3277 L563.3889,722.4738 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.6853879105188005;"/><text fill="#000000" font-family="sans-serif" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="139.1337" x="420.8282" y="734.1713">Plugin cleans up response here.</text><polygon fill="#0000FF" points="144.9595,757.5196,138.1057,760.2612,144.9595,763.0027,142.218,760.2612" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="140.8472" x2="226.5207" y1="760.2612" y2="760.2612"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.8986" x="149.0719" y="756.8801">200 OK</text><polygon fill="#0000FF" points="48.3198,777.4869,41.466,780.2285,48.3198,782.97,45.5783,780.2285" style="stroke: #0000FF; stroke-width: 0.6853879105188005;"/><line style="stroke: #0000FF; stroke-width: 0.6853879105188005; stroke-dasharray: 2.0,2.0;" x1="44.2075" x2="129.881" y1="780.2285" y2="780.2285"/><text fill="#0000FF" font-family="monospace" font-size="8.91" lengthAdjust="spacingAndGlyphs" textLength="32.8986" x="52.4322" y="776.8474">200 OK</text><polygon fill="#008000" points="48.3198,797.4542,41.466,800.1957,48.3198,802.9373,45.5783,800.1957" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><polygon fill="#008000" points="687.1014,797.4542,693.9553,800.1957,687.1014,802.9373,689.8429,800.1957" style="stroke: #008000; stroke-width: 0.6853879105188005;"/><line style="stroke: #008000; stroke-width: 0.6853879105188005;" x1="44.2075" x2="691.2137" y1="800.1957" y2="800.1957"/><text fill="#000000" font-family="sans-serif" font-size="8.91" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="74.7073" x="52.4322" y="796.8146">TCP/TLS Connect</text><!--
@startuml

scale max 720 width

actor Client
box "Ingress ATS" #DDFFDD
entity "Client\nNetVConn" as uanet
participant "Ingress\nATS" as ingress
entity "Client\nVConn" as uavc
entity "TLS Bridge" as plugin
entity "Peer\nVConn" as peervc
end box
box "Peer ATS" #DDDDFF
participant "Peer\nATS" as peer
end box
participant Service

Client <-[#green]> ingress : <font color="green">//TCP//</font> Handshake
activate uanet
Client -[#blue]-> uanet : <font color="blue">""CONNECT"" Service</font>
uanet -> ingress : //Parse request//
ingress -[#black]> plugin : ""READ_REQUEST_HDR_HOOK""
plugin -> ingress : //TSHttpTxnIntercept()//
ingress -> uavc : //Create//
activate uavc
uanet -[#blue]-> ingress : <font color="blue">""CONNECT"" Service</font>
ingress -[#blue]-> uavc : <font color="blue">""CONNECT"" Service</font>
ingress -[#black]> plugin : ""TS_EVENT_NET_ACCEPT""
note right : Client VConn is passed in event data.

plugin -\ ingress : //TSHttpConnect()//
ingress -> peervc : //create//
activate peervc
ingress -/ plugin : //return Peer VConn//

plugin -[#blue]-> peervc : <font color="blue">""CONNECT"" Peer</font>
peervc -> ingress : //parse request//
ingress <-[#green]> peer : <font color="green">//TCP//</font> Handshake
ingress <-[#green]> peer : <font color="green">//TLS//</font> Handshake
ingress -[#blue]-> peervc : <font color="blue">""200 OK""</font>
peervc -[#blue]-> plugin : <font color="blue">""200 OK""</font>
note left
This signals a raw TLS connection
to the Peer ATS. The response is
parsed and consumed by Plugin.
end note

note over plugin : Plugin switches to byte forwarding.
uavc -[#blue]-> plugin : <font color="blue">""CONNECT"" Service</font>
note left: Original Client Request.
plugin -[#blue]-> peervc : <font color="blue">""CONNECT"" Service</font>
peervc -[#blue]-> peer : <font color="blue">""CONNECT"" Service</font>
peer <-[#green]> Service : <font color="green">//TCP//</font> Handshake
peer <-[#green]> Service : <font color="green">//TLS//</font> Handshake
note left : Optional, based on 'Service'
peer -[#blue]-> peervc : <font color="blue">""200 OK""</font>
peervc -[#blue]-> plugin : <font color="blue">""200 OK""</font>
plugin -[#blue]-> uavc : <font color="blue">""200 OK""</font>
uavc -[#blue]-> ingress : <font color="blue">""200 OK""</font>
note left
ATS updates the incoming response based on
local configuration. This means what goes out
to the Client may be different than what the
plugin wrote (forwarded from Peer ATS).
end note
ingress -[#black]> plugin : ""SEND_RESPONSE_HDR_HOOK""
note right : Plugin cleans up response here.
ingress -[#blue]-> uanet : <font color="blue">""200 OK""</font>
uanet -[#blue]-> Client : <font color="blue">""200 OK""</font>

Client <-[#green]> Service : //TCP/TLS Connect//

@enduml

PlantUML version 1.2018.01(Sun Jan 28 18:08:22 GMT 2018)
(APACHE source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.9.1+11
Operating System: Linux
OS Version: 5.10.7-200.fc33.x86_64
Default Encoding: UTF-8
Language: en
Country: IE
--></g></svg>