<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1158px" preserveAspectRatio="none" style="width:1189px;height:1158px;" version="1.1" viewBox="0 0 1189 1158" width="1189px" zoomAndPan="magnify"><defs><filter height="300%" id="fgtsq90bw4cc5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--class UrlRewrite--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="109.9609" id="UrlRewrite" style="stroke: #A80036; stroke-width: 1.5;" width="206" x="612.5" y="8"/><ellipse cx="668.25" cy="26.9688" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M671.2188,32.6094 Q670.6406,32.9063 670,33.0469 Q669.3594,33.2031 668.6563,33.2031 Q666.1563,33.2031 664.8281,31.5625 Q663.5156,29.9063 663.5156,26.7813 Q663.5156,23.6563 664.8281,22 Q666.1563,20.3438 668.6563,20.3438 Q669.3594,20.3438 670,20.5 Q670.6563,20.6563 671.2188,20.9531 L671.2188,23.6719 Q670.5938,23.0938 670,22.8281 Q669.4063,22.5469 668.7813,22.5469 Q667.4375,22.5469 666.75,23.625 Q666.0625,24.6875 666.0625,26.7813 Q666.0625,28.875 666.75,29.9531 Q667.4375,31.0156 668.7813,31.0156 Q669.4063,31.0156 670,30.75 Q670.5938,30.4688 671.2188,29.8906 L671.2188,32.6094 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="90" x="686.75" y="24.1387">«RefCountObj»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="63" x="700.25" y="38.1074">UrlRewrite</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="613.5" x2="817.5" y1="45.9375" y2="45.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="106" x="618.5" y="60.1479">forward_mappings</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="106" x="618.5" y="72.9526">reverse_mappings</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="119" x="618.5" y="85.7573">permanent_redirects</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="116" x="618.5" y="98.562">temporary_redirects</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="194" x="618.5" y="111.3667">forward_mappings_with_recv_port</text><!--class MappingStore--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="52.8047" id="MappingStore" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="656" y="178"/><ellipse cx="671" cy="194" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M673.9688,199.6406 Q673.3906,199.9375 672.75,200.0781 Q672.1094,200.2344 671.4063,200.2344 Q668.9063,200.2344 667.5781,198.5938 Q666.2656,196.9375 666.2656,193.8125 Q666.2656,190.6875 667.5781,189.0313 Q668.9063,187.375 671.4063,187.375 Q672.1094,187.375 672.75,187.5313 Q673.4063,187.6875 673.9688,187.9844 L673.9688,190.7031 Q673.3438,190.125 672.75,189.8594 Q672.1563,189.5781 671.5313,189.5781 Q670.1875,189.5781 669.5,190.6563 Q668.8125,191.7188 668.8125,193.8125 Q668.8125,195.9063 669.5,196.9844 Q670.1875,198.0469 671.5313,198.0469 Q672.1563,198.0469 672.75,197.7813 Q673.3438,197.5 673.9688,196.9219 L673.9688,199.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="87" x="685" y="198.1543">MappingStore</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="657" x2="774" y1="210" y2="210"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="81" x="662" y="224.2104">Rule collection</text><!--class RegexMappingList--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="37.9375" id="RegexMappingList" style="stroke: #A80036; stroke-width: 1.5;" width="144" x="549.5" y="423"/><ellipse cx="564.5" cy="441.9688" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M567.4688,447.6094 Q566.8906,447.9063 566.25,448.0469 Q565.6094,448.2031 564.9063,448.2031 Q562.4063,448.2031 561.0781,446.5625 Q559.7656,444.9063 559.7656,441.7813 Q559.7656,438.6563 561.0781,437 Q562.4063,435.3438 564.9063,435.3438 Q565.6094,435.3438 566.25,435.5 Q566.9063,435.6563 567.4688,435.9531 L567.4688,438.6719 Q566.8438,438.0938 566.25,437.8281 Q565.6563,437.5469 565.0313,437.5469 Q563.6875,437.5469 563,438.625 Q562.3125,439.6875 562.3125,441.7813 Q562.3125,443.875 563,444.9531 Q563.6875,446.0156 565.0313,446.0156 Q565.6563,446.0156 566.25,445.75 Q566.8438,445.4688 567.4688,444.8906 L567.4688,447.6094 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="54" x="607.5" y="439.1387">«Queue»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="112" x="578.5" y="453.1074">RegexMappingList</text><!--class URLTable--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="71.5469" id="URLTable" style="stroke: #A80036; stroke-width: 1.5;" width="168" x="713.5" y="291"/><ellipse cx="728.5" cy="309.9688" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M731.4688,315.6094 Q730.8906,315.9063 730.25,316.0469 Q729.6094,316.2031 728.9063,316.2031 Q726.4063,316.2031 725.0781,314.5625 Q723.7656,312.9063 723.7656,309.7813 Q723.7656,306.6563 725.0781,305 Q726.4063,303.3438 728.9063,303.3438 Q729.6094,303.3438 730.25,303.5 Q730.9063,303.6563 731.4688,303.9531 L731.4688,306.6719 Q730.8438,306.0938 730.25,305.8281 Q729.6563,305.5469 729.0313,305.5469 Q727.6875,305.5469 727,306.625 Q726.3125,307.6875 726.3125,309.7813 Q726.3125,311.875 727,312.9531 Q727.6875,314.0156 729.0313,314.0156 Q729.6563,314.0156 730.25,313.75 Q730.8438,313.4688 731.4688,312.8906 L731.4688,315.6094 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="140" x="740.5" y="307.1387">«std::unordered_map»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="57" x="782" y="321.1074">URLTable</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="714.5" x2="880.5" y1="328.9375" y2="328.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="58" x="719.5" y="343.1479">key: FQDN</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="156" x="719.5" y="355.9526">value: UrlMappingPathIndex</text><!--class UrlMappingPathIndex--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="32" id="UrlMappingPathIndex" style="stroke: #A80036; stroke-width: 1.5;" width="164" x="728.5" y="426"/><ellipse cx="743.5" cy="442" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M746.4688,447.6406 Q745.8906,447.9375 745.25,448.0781 Q744.6094,448.2344 743.9063,448.2344 Q741.4063,448.2344 740.0781,446.5938 Q738.7656,444.9375 738.7656,441.8125 Q738.7656,438.6875 740.0781,437.0313 Q741.4063,435.375 743.9063,435.375 Q744.6094,435.375 745.25,435.5313 Q745.9063,435.6875 746.4688,435.9844 L746.4688,438.7031 Q745.8438,438.125 745.25,437.8594 Q744.6563,437.5781 744.0313,437.5781 Q742.6875,437.5781 742,438.6563 Q741.3125,439.7188 741.3125,441.8125 Q741.3125,443.9063 742,444.9844 Q742.6875,446.0469 744.0313,446.0469 Q744.6563,446.0469 745.25,445.7813 Q745.8438,445.5 746.4688,444.9219 L746.4688,447.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="132" x="757.5" y="446.1543">UrlMappingPathIndex</text><!--class acl_filter_rule--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="118.0234" id="acl_filter_rule" style="stroke: #A80036; stroke-width: 1.5;" width="178" x="47.5" y="937"/><ellipse cx="91.3" cy="953" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M94.2688,958.6406 Q93.6906,958.9375 93.05,959.0781 Q92.4094,959.2344 91.7063,959.2344 Q89.2063,959.2344 87.8781,957.5938 Q86.5656,955.9375 86.5656,952.8125 Q86.5656,949.6875 87.8781,948.0313 Q89.2063,946.375 91.7063,946.375 Q92.4094,946.375 93.05,946.5313 Q93.7063,946.6875 94.2688,946.9844 L94.2688,949.7031 Q93.6438,949.125 93.05,948.8594 Q92.4563,948.5781 91.8313,948.5781 Q90.4875,948.5781 89.8,949.6563 Q89.1125,950.7188 89.1125,952.8125 Q89.1125,954.9063 89.8,955.9844 Q90.4875,957.0469 91.8313,957.0469 Q92.4563,957.0469 93.05,956.7813 Q93.6438,956.5 94.2688,955.9219 L94.2688,958.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="82" x="111.7" y="957.1543">acl_filter_rule</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="48.5" x2="224.5" y1="969" y2="969"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="76" x="53.5" y="983.2104">Access check</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="69" x="53.5" y="1010.0151">string name</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="71" x="53.5" y="1022.8198">IpMap src_ip</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="84" x="53.5" y="1035.6245">IpMap proxy_ip</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="166" x="53.5" y="1048.4292">std::vector&lt;RemapArg&gt; argv</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="48.5" x2="131.5" y1="994.8047" y2="994.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="48.5" x2="131.5" y1="996.8047" y2="996.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="141.5" y1="994.3047" y2="994.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="131.5" x2="141.5" y1="996.3047" y2="996.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="141.5" x2="224.5" y1="994.8047" y2="994.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="141.5" x2="224.5" y1="996.8047" y2="996.8047"/><!--class url_mapping--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="92.4141" id="url_mapping" style="stroke: #A80036; stroke-width: 1.5;" width="108" x="658.5" y="785"/><ellipse cx="673.5" cy="801" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M676.4688,806.6406 Q675.8906,806.9375 675.25,807.0781 Q674.6094,807.2344 673.9063,807.2344 Q671.4063,807.2344 670.0781,805.5938 Q668.7656,803.9375 668.7656,800.8125 Q668.7656,797.6875 670.0781,796.0313 Q671.4063,794.375 673.9063,794.375 Q674.6094,794.375 675.25,794.5313 Q675.9063,794.6875 676.4688,794.9844 L676.4688,797.7031 Q675.8438,797.125 675.25,796.8594 Q674.6563,796.5781 674.0313,796.5781 Q672.6875,796.5781 672,797.6563 Q671.3125,798.7188 671.3125,800.8125 Q671.3125,802.9063 672,803.9844 Q672.6875,805.0469 674.0313,805.0469 Q674.6563,805.0469 675.25,804.7813 Q675.8438,804.5 676.4688,803.9219 L676.4688,806.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="76" x="687.5" y="805.1543">url_mapping</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="659.5" x2="765.5" y1="817" y2="817"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="66" x="664.5" y="831.2104">rewrite rule</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="52" x="664.5" y="858.0151">URL from</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="36" x="664.5" y="870.8198">URL to</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="659.5" x2="707.5" y1="842.8047" y2="842.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="659.5" x2="707.5" y1="844.8047" y2="844.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="707.5" x2="717.5" y1="842.3047" y2="842.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="707.5" x2="717.5" y1="844.3047" y2="844.3047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="717.5" x2="765.5" y1="842.8047" y2="842.8047"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="717.5" x2="765.5" y1="844.8047" y2="844.8047"/><path d="M801.5,803.5 L801.5,827 L766.64,831 L801.5,835 L801.5,858.8984 A0,0 0 0 0 801.5,858.8984 L1019.5,858.8984 A0,0 0 0 0 1019.5,858.8984 L1019.5,813.5 L1009.5,803.5 L801.5,803.5 A0,0 0 0 0 801.5,803.5 " fill="#FBFB77" filter="url(#fgtsq90bw4cc5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1009.5,803.5 L1009.5,813.5 L1019.5,813.5 L1009.5,803.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="807.5" y="820.5669">Mapping type is determined by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="807.5" y="835.6997">which MappingStore owns</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="807.5" y="850.8325">this mapping.</text><path d="M6,1118.5 L6,1143.6328 A0,0 0 0 0 6,1143.6328 L267,1143.6328 A0,0 0 0 0 267,1143.6328 L267,1128.5 L257,1118.5 L140.5,1118.5 L136.5,1055.34 L132.5,1118.5 L6,1118.5 A0,0 0 0 0 6,1118.5 " fill="#FBFB77" filter="url(#fgtsq90bw4cc5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M257,1118.5 L257,1128.5 L267,1128.5 L257,1118.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="12" y="1135.5669">Local rule and copies of defined filters</text><!--class std::vector<RemapPluginInfo*>--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="32" id="std::vector&lt;RemapPluginInfo*&gt;" style="stroke: #A80036; stroke-width: 1.5;" width="229" x="279" y="980"/><ellipse cx="294" cy="996" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M296.9688,1001.6406 Q296.3906,1001.9375 295.75,1002.0781 Q295.1094,1002.2344 294.4063,1002.2344 Q291.9063,1002.2344 290.5781,1000.5938 Q289.2656,998.9375 289.2656,995.8125 Q289.2656,992.6875 290.5781,991.0313 Q291.9063,989.375 294.4063,989.375 Q295.1094,989.375 295.75,989.5313 Q296.4063,989.6875 296.9688,989.9844 L296.9688,992.7031 Q296.3438,992.125 295.75,991.8594 Q295.1563,991.5781 294.5313,991.5781 Q293.1875,991.5781 292.5,992.6563 Q291.8125,993.7188 291.8125,995.8125 Q291.8125,997.9063 292.5,998.9844 Q293.1875,1000.0469 294.5313,1000.0469 Q295.1563,1000.0469 295.75,999.7813 Q296.3438,999.5 296.9688,998.9219 L296.9688,1001.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="197" x="308" y="1000.1543">std::vector&lt;RemapPluginInfo*&gt;</text><!--class std::vector<void*>--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="32" id="std::vector&lt;void*&gt;" style="stroke: #A80036; stroke-width: 1.5;" width="150" x="543.5" y="980"/><ellipse cx="558.5" cy="996" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M561.4688,1001.6406 Q560.8906,1001.9375 560.25,1002.0781 Q559.6094,1002.2344 558.9063,1002.2344 Q556.4063,1002.2344 555.0781,1000.5938 Q553.7656,998.9375 553.7656,995.8125 Q553.7656,992.6875 555.0781,991.0313 Q556.4063,989.375 558.9063,989.375 Q559.6094,989.375 560.25,989.5313 Q560.9063,989.6875 561.4688,989.9844 L561.4688,992.7031 Q560.8438,992.125 560.25,991.8594 Q559.6563,991.5781 559.0313,991.5781 Q557.6875,991.5781 557,992.6563 Q556.3125,993.7188 556.3125,995.8125 Q556.3125,997.9063 557,998.9844 Q557.6875,1000.0469 559.0313,1000.0469 Q559.6563,1000.0469 560.25,999.7813 Q560.8438,999.5 561.4688,998.9219 L561.4688,1001.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="118" x="572.5" y="1000.1543">std::vector&lt;void*&gt;</text><path d="M538.5,1118.5 L538.5,1143.6328 A0,0 0 0 0 538.5,1143.6328 L698.5,1143.6328 A0,0 0 0 0 698.5,1143.6328 L698.5,1128.5 L688.5,1118.5 L622.5,1118.5 L618.5,1012.26 L614.5,1118.5 L538.5,1118.5 A0,0 0 0 0 538.5,1118.5 " fill="#FBFB77" filter="url(#fgtsq90bw4cc5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M688.5,1118.5 L688.5,1128.5 L698.5,1128.5 L688.5,1118.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="544.5" y="1135.5669">"Plugin instance data"</text><!--class referrer_info--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="52.8047" id="referrer_info" style="stroke: #A80036; stroke-width: 1.5;" width="157" x="729" y="969.5"/><ellipse cx="765.6" cy="985.5" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M768.5688,991.1406 Q767.9906,991.4375 767.35,991.5781 Q766.7094,991.7344 766.0063,991.7344 Q763.5063,991.7344 762.1781,990.0938 Q760.8656,988.4375 760.8656,985.3125 Q760.8656,982.1875 762.1781,980.5313 Q763.5063,978.875 766.0063,978.875 Q766.7094,978.875 767.35,979.0313 Q768.0063,979.1875 768.5688,979.4844 L768.5688,982.2031 Q767.9438,981.625 767.35,981.3594 Q766.7563,981.0781 766.1313,981.0781 Q764.7875,981.0781 764.1,982.1563 Q763.4125,983.2188 763.4125,985.3125 Q763.4125,987.4063 764.1,988.4844 Q764.7875,989.5469 766.1313,989.5469 Q766.7563,989.5469 767.35,989.2813 Q767.9438,989 768.5688,988.4219 L768.5688,991.1406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="77" x="784.4" y="989.6543">referrer_info</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="730" x2="885" y1="1001.5" y2="1001.5"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="145" x="735" y="1015.7104">Host rewrite Referer data</text><!--class redirect_tag_str--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="32" id="redirect_tag_str" style="stroke: #A80036; stroke-width: 1.5;" width="131" x="939" y="980"/><ellipse cx="954" cy="996" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M956.9688,1001.6406 Q956.3906,1001.9375 955.75,1002.0781 Q955.1094,1002.2344 954.4063,1002.2344 Q951.9063,1002.2344 950.5781,1000.5938 Q949.2656,998.9375 949.2656,995.8125 Q949.2656,992.6875 950.5781,991.0313 Q951.9063,989.375 954.4063,989.375 Q955.1094,989.375 955.75,989.5313 Q956.4063,989.6875 956.9688,989.9844 L956.9688,992.7031 Q956.3438,992.125 955.75,991.8594 Q955.1563,991.5781 954.5313,991.5781 Q953.1875,991.5781 952.5,992.6563 Q951.8125,993.7188 951.8125,995.8125 Q951.8125,997.9063 952.5,998.9844 Q953.1875,1000.0469 954.5313,1000.0469 Q955.1563,1000.0469 955.75,999.7813 Q956.3438,999.5 956.9688,998.9219 L956.9688,1001.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="99" x="968" y="1000.1543">redirect_tag_str</text><!--class URL--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="32" id="URL" style="stroke: #A80036; stroke-width: 1.5;" width="55" x="1123" y="980"/><ellipse cx="1138" cy="996" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1140.9688,1001.6406 Q1140.3906,1001.9375 1139.75,1002.0781 Q1139.1094,1002.2344 1138.4063,1002.2344 Q1135.9063,1002.2344 1134.5781,1000.5938 Q1133.2656,998.9375 1133.2656,995.8125 Q1133.2656,992.6875 1134.5781,991.0313 Q1135.9063,989.375 1138.4063,989.375 Q1139.1094,989.375 1139.75,989.5313 Q1140.4063,989.6875 1140.9688,989.9844 L1140.9688,992.7031 Q1140.3438,992.125 1139.75,991.8594 Q1139.1563,991.5781 1138.5313,991.5781 Q1137.1875,991.5781 1136.5,992.6563 Q1135.8125,993.7188 1135.8125,995.8125 Q1135.8125,997.9063 1136.5,998.9844 Q1137.1875,1000.0469 1138.5313,1000.0469 Q1139.1563,1000.0469 1139.75,999.7813 Q1140.3438,999.5 1140.9688,998.9219 L1140.9688,1001.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="23" x="1152" y="1000.1543">URL</text><!--class RemapPluginInfo--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="32" id="RemapPluginInfo" style="stroke: #A80036; stroke-width: 1.5;" width="136" x="325.5" y="1115"/><ellipse cx="340.5" cy="1131" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M343.4688,1136.6406 Q342.8906,1136.9375 342.25,1137.0781 Q341.6094,1137.2344 340.9063,1137.2344 Q338.4063,1137.2344 337.0781,1135.5938 Q335.7656,1133.9375 335.7656,1130.8125 Q335.7656,1127.6875 337.0781,1126.0313 Q338.4063,1124.375 340.9063,1124.375 Q341.6094,1124.375 342.25,1124.5313 Q342.9063,1124.6875 343.4688,1124.9844 L343.4688,1127.7031 Q342.8438,1127.125 342.25,1126.8594 Q341.6563,1126.5781 341.0313,1126.5781 Q339.6875,1126.5781 339,1127.6563 Q338.3125,1128.7188 338.3125,1130.8125 Q338.3125,1132.9063 339,1133.9844 Q339.6875,1135.0469 341.0313,1135.0469 Q341.6563,1135.0469 342.25,1134.7813 Q342.8438,1134.5 343.4688,1133.9219 L343.4688,1136.6406 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="104" x="354.5" y="1135.1543">RemapPluginInfo</text><path d="M898,1118.5 L898,1143.6328 A0,0 0 0 0 898,1143.6328 L1111,1143.6328 A0,0 0 0 0 1111,1143.6328 L1111,1128.5 L1101,1118.5 L1008.5,1118.5 L1004.5,1012.26 L1000.5,1118.5 L898,1118.5 A0,0 0 0 0 898,1118.5 " fill="#FBFB77" filter="url(#fgtsq90bw4cc5)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1101,1118.5 L1101,1128.5 L1111,1128.5 L1101,1118.5 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="904" y="1135.5669">Redirect URL format elements</text><!--class UrlMappingTrie--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="71.5469" id="UrlMappingTrie" style="stroke: #A80036; stroke-width: 1.5;" width="125" x="711" y="653"/><ellipse cx="726" cy="671.9688" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M728.9688,677.6094 Q728.3906,677.9063 727.75,678.0469 Q727.1094,678.2031 726.4063,678.2031 Q723.9063,678.2031 722.5781,676.5625 Q721.2656,674.9063 721.2656,671.7813 Q721.2656,668.6563 722.5781,667 Q723.9063,665.3438 726.4063,665.3438 Q727.1094,665.3438 727.75,665.5 Q728.4063,665.6563 728.9688,665.9531 L728.9688,668.6719 Q728.3438,668.0938 727.75,667.8281 Q727.1563,667.5469 726.5313,667.5469 Q725.1875,667.5469 724.5,668.625 Q723.8125,669.6875 723.8125,671.7813 Q723.8125,673.875 724.5,674.9531 Q725.1875,676.0156 726.5313,676.0156 Q727.1563,676.0156 727.75,675.75 Q728.3438,675.4688 728.9688,674.8906 L728.9688,677.6094 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="37" x="768" y="669.1387">«Trie»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="93" x="740" y="683.1074">UrlMappingTrie</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="712" x2="835" y1="690.9375" y2="690.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="52" x="717" y="705.1479">key: path</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="108" x="717" y="717.9526">value: url_mapping</text><!--class UrlMappingGroup--><rect fill="#FEFECE" filter="url(#fgtsq90bw4cc5)" height="71.5469" id="UrlMappingGroup" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="723.5" y="521"/><ellipse cx="738.5" cy="539.9688" fill="#ADD1B2" rx="11" ry="11" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M741.4688,545.6094 Q740.8906,545.9063 740.25,546.0469 Q739.6094,546.2031 738.9063,546.2031 Q736.4063,546.2031 735.0781,544.5625 Q733.7656,542.9063 733.7656,539.7813 Q733.7656,536.6563 735.0781,535 Q736.4063,533.3438 738.9063,533.3438 Q739.6094,533.3438 740.25,533.5 Q740.9063,533.6563 741.4688,533.9531 L741.4688,536.6719 Q740.8438,536.0938 740.25,535.8281 Q739.6563,535.5469 739.0313,535.5469 Q737.6875,535.5469 737,536.625 Q736.3125,537.6875 736.3125,539.7813 Q736.3125,541.875 737,542.9531 Q737.6875,544.0156 739.0313,544.0156 Q739.6563,544.0156 740.25,543.75 Q740.8438,543.4688 741.4688,542.8906 L741.4688,545.6094 Z "/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="68" x="772.5" y="537.1387">«std::map»</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="108" x="752.5" y="551.1074">UrlMappingGroup</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="724.5" x2="862.5" y1="558.9375" y2="558.9375"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="125" x="729.5" y="573.1479">key: { scheme, port }</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="123" x="729.5" y="585.9526">value: UrlMappingTrie</text><!--link UrlRewrite to MappingStore--><path d="M715.5,118.33 C715.5,133.87 715.5,150.48 715.5,164.87 " fill="none" id="UrlRewrite-MappingStore" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="715.5,177.88,719.5,171.88,715.5,165.88,711.5,171.88,715.5,177.88" style="stroke: #A80036; stroke-width: 1.0;"/><!--link MappingStore to RegexMappingList--><path d="M705.26,231.15 C687.81,274.86 652.4,363.59 633.7,410.44 " fill="none" id="MappingStore-RegexMappingList" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="628.79,422.74,634.7281,418.6486,633.2353,411.5937,627.2972,415.6851,628.79,422.74" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="621.7564" y="411.9748">1</text><!--link MappingStore to URLTable--><path d="M732.89,231.05 C742.52,245.2 754.78,263.22 766.02,279.74 " fill="none" id="MappingStore-URLTable" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="773.6,290.88,773.5297,283.6692,766.8465,280.9608,766.9169,288.1716,773.6,290.88" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="760.4559" y="279.9585">1</text><!--link URLTable to UrlMappingPathIndex--><path d="M801.54,363.13 C803.38,379.14 805.53,397.83 807.27,412.88 " fill="none" id="URLTable-UrlMappingPathIndex" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="808.77,426,812.058,419.5822,807.3985,414.0786,804.1105,420.4965,808.77,426" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="799.9722" y="415.0116">*</text><!--link acl_filter_rule to acl_filter_rule--><path d="M225.67,971.49 C245.79,973.7 260.5,981.87 260.5,996 C260.5,1006.82 251.88,1014.15 238.81,1017.98 " fill="none" id="acl_filter_rule-acl_filter_rule" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="225.67,1020.51,232.3207,1023.2972,237.4514,1018.2301,230.8008,1015.4429,225.67,1020.51" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="233.569" y="1018.8834">next</text><!--link url_mapping to acl_filter_rule--><path d="M658.38,840.88 C572.69,855.76 401.17,888.91 261.5,937 C253.69,939.69 245.71,942.71 237.75,945.92 " fill="none" id="url_mapping-acl_filter_rule" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="225.71,950.92,232.7869,952.3046,236.7869,946.3046,229.71,944.92,225.71,950.92" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="233.429" y="943.6371">1</text><!--link url_mapping to std::vector<RemapPluginInfo*>--><path d="M658.39,859.65 C595.12,891.98 491.83,944.76 434.72,973.94 " fill="none" id="url_mapping-std::vector&lt;RemapPluginInfo*&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="422.93,979.96,430.0931,980.7911,433.6152,974.4987,426.4522,973.6676,422.93,979.96" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="423.6716" y="968.9578">1</text><!--link url_mapping to std::vector<void*>--><path d="M686.32,877.4 C669.4,906.74 647.98,943.89 633.78,968.5 " fill="none" id="url_mapping-std::vector&lt;void*&gt;" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="627.27,979.8,633.7342,976.6041,633.2705,969.408,626.8062,972.6038,627.27,979.8" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="620.8501" y="969.0383">1</text><!--link url_mapping to referrer_info--><path d="M738.96,877.4 C753.71,902.71 771.85,933.83 785.76,957.7 " fill="none" id="url_mapping-referrer_info" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="792.41,969.11,792.8453,961.912,786.3685,958.7418,785.9332,965.9397,792.41,969.11" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="779.9954" y="958.2621">1</text><!--link url_mapping to redirect_tag_str--><path d="M766.65,867.51 C772.27,870.84 777.96,874.06 783.5,877 C842.59,908.33 863.13,904.35 921.5,937 C939.89,947.29 959.27,960.66 974.66,971.98 " fill="none" id="url_mapping-redirect_tag_str" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="985.1,979.77,982.6895,972.9737,975.4889,972.5848,977.8994,979.3811,985.1,979.77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="969.3488" y="968.9983">1</text><!--link url_mapping to URL--><path d="M766.84,869.27 C772.33,872.17 777.93,874.81 783.5,877 C918.98,930.26 981.21,861.21 1105.5,937 C1118.02,944.63 1128.37,957.12 1135.98,968.55 " fill="none" id="url_mapping-URL" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1142.89,979.84,1143.1692,972.6343,1136.6251,969.6052,1136.346,976.8109,1142.89,979.84" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1130.8991" y="968.7966">2</text><!--link std::vector<RemapPluginInfo*> to RemapPluginInfo--><path d="M393.5,1012.26 C393.5,1034 393.5,1074.3 393.5,1101.63 " fill="none" id="std::vector&lt;RemapPluginInfo*&gt;-RemapPluginInfo" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="393.5,1114.92,397.5,1108.92,393.5,1102.92,389.5,1108.92,393.5,1114.92" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="385.2969" y="1103.9041">*</text><!--link redirect_tag_str to redirect_tag_str--><path d="M1027.72,979.97 C1062.04,963.83 1105,969.17 1105,996 C1105,1019.68 1071.52,1026.62 1040.05,1016.82 " fill="none" id="redirect_tag_str-redirect_tag_str" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1027.72,1012.03,1031.8693,1017.9277,1038.9092,1016.366,1034.76,1010.4683,1027.72,1012.03" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="1002.8894" y="1032.2082">next</text><!--link referrer_info to referrer_info--><path d="M886.01,971.18 C906,972.81 921,981.08 921,996 C921,1007.42 912.2,1014.95 899.11,1018.58 " fill="none" id="referrer_info-referrer_info" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="886.01,1020.82,892.6003,1023.7471,897.837,1018.7895,891.2467,1015.8624,886.01,1020.82" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="893.9601" y="1019.3894">next</text><!--link UrlMappingPathIndex to UrlMappingGroup--><path d="M808.21,458.24 C806.29,470.98 803.45,489.86 800.77,507.65 " fill="none" id="UrlMappingPathIndex-UrlMappingGroup" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="798.82,520.6,803.6716,515.265,800.613,508.7347,795.7614,514.0697,798.82,520.6" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="791.0551" y="509.8994">1</text><!--link UrlMappingGroup to UrlMappingTrie--><path d="M788.09,593.18 C785.89,607.49 783.31,624.25 780.93,639.68 " fill="none" id="UrlMappingGroup-UrlMappingTrie" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="778.92,652.79,783.7898,647.4717,780.7536,640.9309,775.8838,646.2493,778.92,652.79" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="772.274" y="641.8519">*</text><!--link UrlMappingTrie to url_mapping--><path d="M758.11,725.33 C751.84,739.72 744.42,756.73 737.42,772.81 " fill="none" id="UrlMappingTrie-url_mapping" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="732.17,784.87,738.2361,780.971,736.9701,773.8719,730.904,777.7709,732.17,784.87" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="727.545" y="774.0393">*</text><!--link RegexMappingList to url_mapping--><path d="M625.77,461.15 C638.7,516.14 677.85,682.64 698.85,771.94 " fill="none" id="RegexMappingList-url_mapping" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="701.87,784.79,704.3856,778.0319,699.1149,773.1106,696.5993,779.8686,701.87,784.79" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="7" x="692.7947" y="773.9476">*</text><!--
@startuml

hide empty members

class UrlRewrite << RefCountObj >> {
  forward_mappings
  reverse_mappings
  permanent_redirects
  temporary_redirects
  forward_mappings_with_recv_port
}

UrlRewrite - -* MappingStore

class MappingStore {
  Rule collection
}

MappingStore - -* "1" RegexMappingList
MappingStore - -* "1" URLTable

class URLTable <<std::unordered_map>> {
  key: FQDN
  value: UrlMappingPathIndex
}

URLTable - -* "*" UrlMappingPathIndex

class acl_filter_rule {
  Access check
  ============
  string name
  IpMap src_ip
  IpMap proxy_ip
  std::vector<RemapArg> argv
}

acl_filter_rule - -* "next" acl_filter_rule

class url_mapping {
  rewrite rule
  ================
  URL from
  URL to
}
note right: Mapping type is determined by\nwhich MappingStore owns\nthis mapping.

url_mapping - -* "1" acl_filter_rule
note bottom: Local rule and copies of defined filters

url_mapping - -* "1" "std::vector<RemapPluginInfo*>"
url_mapping - -* "1" "std::vector<void*>"
note bottom: "Plugin instance data"
url_mapping - -* "1" referrer_info
url_mapping - -* "1" redirect_tag_str
url_mapping - -* "2" URL

"std::vector<RemapPluginInfo*>" - -o "*" RemapPluginInfo

redirect_tag_str - -* "next" redirect_tag_str
note bottom: Redirect URL format elements

class referrer_info {
  Host rewrite Referer data
}

referrer_info - -* "next" referrer_info

class UrlMappingPathIndex {
}

class UrlMappingTrie << Trie >> {
  key: path
  value: url_mapping
}

class UrlMappingGroup << std::map >> {
  key: { scheme, port }
  value: UrlMappingTrie
}

UrlMappingPathIndex - -* "1" UrlMappingGroup
UrlMappingGroup - -* "*" UrlMappingTrie
UrlMappingTrie - -* "*" url_mapping

RegexMappingList - -* "*" url_mapping

class RegexMappingList << Queue >> {
}

@enduml

PlantUML version 1.2018.01(Sun Jan 28 18:08:22 GMT 2018)
(APACHE source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.9.1+11
Operating System: Linux
OS Version: 5.10.7-200.fc33.x86_64
Default Encoding: UTF-8
Language: en
Country: IE
--></g></svg>