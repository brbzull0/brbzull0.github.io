<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1065px" preserveAspectRatio="none" style="width:982px;height:1065px;" version="1.1" viewBox="0 0 982 1065" width="982px" zoomAndPan="magnify"><defs><filter height="300%" id="ffpqnsr3a6t8e" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="308.9375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="437.5" y="84.2969"/><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="450.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="437.5" y="549.8984"/><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="345.9375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="759.5" y="349.2969"/><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="131.3359" style="stroke: #000000; stroke-width: 2.0;" width="315.5" x="408" y="141.6953"/><rect fill="#FFFFFF" height="56.9375" style="stroke: none; stroke-width: 1.0;" width="315.5" x="408" y="216.0938"/><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="721.4063" style="stroke: #000000; stroke-width: 2.0;" width="957.5" x="13" y="287.0313"/><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="90.2031" style="stroke: #000000; stroke-width: 2.0;" width="395.5" x="408" y="311.1641"/><rect fill="#FFFFFF" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="395.5" x="408" y="357.4297"/><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="445.7344" style="stroke: #000000; stroke-width: 2.0;" width="907.5" x="23" y="511.7656"/><rect fill="#FFFFFF" height="370.3359" style="stroke: none; stroke-width: 1.0;" width="907.5" x="23" y="587.1641"/><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="197.8672" style="stroke: #000000; stroke-width: 2.0;" width="454" x="33" y="752.6328"/><rect fill="#FFFFFF" height="151.6016" style="stroke: none; stroke-width: 1.0;" width="454" x="33" y="798.8984"/><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="135.6016" style="stroke: #000000; stroke-width: 2.0;" width="434" x="43" y="807.8984"/><rect fill="#FFFFFF" height="59.0703" style="stroke: none; stroke-width: 1.0;" width="434" x="43" y="884.4297"/><rect fill="#FFFFFF" height="43.9375" style="stroke: none; stroke-width: 1.0;" width="957.5" x="13" y="964.5"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="71" x2="71" y1="38.2969" y2="1025.4375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="442" x2="442" y1="38.2969" y2="1025.4375"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="764.5" x2="764.5" y1="38.2969" y2="1025.4375"/><rect fill="#FEFECE" filter="url(#ffpqnsr3a6t8e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="33" x="53" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="19" x="60" y="22.9951">UA</text><rect fill="#FEFECE" filter="url(#ffpqnsr3a6t8e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="33" x="53" y="1024.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="19" x="60" y="1044.4326">UA</text><rect fill="#FEFECE" filter="url(#ffpqnsr3a6t8e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="45" x="418" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="425" y="22.9951">CDN</text><rect fill="#FEFECE" filter="url(#ffpqnsr3a6t8e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="45" x="418" y="1024.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="425" y="1044.4326">CDN</text><rect fill="#FEFECE" filter="url(#ffpqnsr3a6t8e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="735.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="742.5" y="22.9951">Origin</text><rect fill="#FEFECE" filter="url(#ffpqnsr3a6t8e)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="735.5" y="1024.4375"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="742.5" y="1044.4326">Origin</text><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="308.9375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="437.5" y="84.2969"/><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="450.4063" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="437.5" y="549.8984"/><rect fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" height="345.9375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="759.5" y="349.2969"/><polygon fill="#A80036" points="425.5,80.2969,435.5,84.2969,425.5,88.2969,429.5,84.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="71.5" x2="431.5" y1="84.2969" y2="84.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="78.5" y="71.9302">&lt;01&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="122.5" y="64.3638">GET https://example-cdn.com/path/object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="122.5" y="79.4966">[Cookie: TokenCookie=&lt;access_token&gt;]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="447.5" x2="489.5" y1="113.6953" y2="113.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="489.5" x2="489.5" y1="113.6953" y2="126.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="489.5" y1="126.6953" y2="126.6953"/><polygon fill="#A80036" points="458.5,122.6953,448.5,126.6953,458.5,130.6953,454.5,126.6953" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="454.5" y="108.6294">&lt;02&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="498.5" y="108.6294">validate access_token</text><path d="M408,141.6953 L472,141.6953 L472,148.6953 L462,158.6953 L408,158.6953 L408,141.6953 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="131.3359" style="stroke: #000000; stroke-width: 2.0;" width="315.5" x="408" y="141.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="423" y="154.7622">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="131" x="487" y="153.9058">[valid access_token]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="447.5" x2="489.5" y1="195.0938" y2="195.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="489.5" x2="489.5" y1="195.0938" y2="208.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="489.5" y1="208.0938" y2="208.0938"/><polygon fill="#A80036" points="458.5,204.0938,448.5,208.0938,458.5,212.0938,454.5,208.0938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="454.5" y="182.4614">&lt;03&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="498.5" y="174.895">extract access_token</text><text fill="#000000" font-family="sans-serif" font-size="13" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="46" x="638.5" y="174.895">subject</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="149" x="498.5" y="190.0278">and add it to cache key</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="408" x2="723.5" y1="217.0938" y2="217.0938"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="163" x="413" y="227.3042">[missing or invalid token]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="447.5" x2="489.5" y1="252.0313" y2="252.0313"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="489.5" x2="489.5" y1="252.0313" y2="265.0313"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="489.5" y1="265.0313" y2="265.0313"/><polygon fill="#A80036" points="458.5,261.0313,448.5,265.0313,458.5,269.0313,454.5,265.0313" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="454.5" y="246.9653">&lt;04&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="498.5" y="246.9653">skip cache (same as cache-miss)</text><path d="M13,287.0313 L77,287.0313 L77,294.0313 L67,304.0313 L13,304.0313 L13,287.0313 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="721.4063" style="stroke: #000000; stroke-width: 2.0;" width="957.5" x="13" y="287.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="28" y="300.0981">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="241" x="92" y="299.2417">[invalid access_token OR cache-miss]</text><path d="M408,311.1641 L472,311.1641 L472,318.1641 L462,328.1641 L408,328.1641 L408,311.1641 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="90.2031" style="stroke: #000000; stroke-width: 2.0;" width="395.5" x="408" y="311.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="423" y="324.231">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="487" y="323.3745">[config:use_redirect=</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="624" y="323.3745">true</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5" x="649" y="323.3745">]</text><polygon fill="#A80036" points="747.5,345.2969,757.5,349.2969,747.5,353.2969,751.5,349.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="447.5" x2="753.5" y1="349.2969" y2="349.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="454.5" y="344.3638">&lt;05&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="498.5" y="344.3638">HEAD https://example.com/path/object</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="408" x2="803.5" y1="358.4297" y2="358.4297"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="413" y="368.6401">[config:use_redirect=</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="550" y="368.6401">false</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5" x="580" y="368.6401">]</text><polygon fill="#A80036" points="747.5,389.2344,757.5,393.2344,747.5,397.2344,751.5,393.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="442.5" x2="753.5" y1="393.2344" y2="393.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="449.5" y="388.3013">&lt;06&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="493.5" y="388.3013">GET https://example.com/path/object</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="769.5" x2="811.5" y1="444.6328" y2="444.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="811.5" x2="811.5" y1="444.6328" y2="457.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="770.5" x2="811.5" y1="457.6328" y2="457.6328"/><polygon fill="#A80036" points="780.5,453.6328,770.5,457.6328,780.5,461.6328,776.5,457.6328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="776.5" y="432.0005">&lt;07&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="820.5" y="424.4341">trigger authentication</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="820.5" y="439.5669">+ authorization flow</text><path d="M50,470.6328 L50,495.6328 L785,495.6328 L785,480.6328 L775,470.6328 L50,470.6328 " fill="#FFFFFF" filter="url(#ffpqnsr3a6t8e)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M775,470.6328 L775,480.6328 L785,480.6328 L775,470.6328 " fill="#FFFFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="493" x="164.75" y="487.6997">Origin &lt;=&gt; UA authentication and authorization flow using IdMS and DS, etc.</text><path d="M23,511.7656 L87,511.7656 L87,518.7656 L77,528.7656 L23,528.7656 L23,511.7656 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="445.7344" style="stroke: #000000; stroke-width: 2.0;" width="907.5" x="23" y="511.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="38" y="524.8325">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="127" x="102" y="523.9761">[user unauthorized]</text><polygon fill="#A80036" points="458.5,545.8984,448.5,549.8984,458.5,553.8984,454.5,549.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="758.5" y1="549.8984" y2="549.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="464.5" y="544.9653">&lt;08&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="508.5" y="544.9653">401 Unauthorized</text><polygon fill="#A80036" points="82.5,575.0313,72.5,579.0313,82.5,583.0313,78.5,579.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="76.5" x2="436.5" y1="579.0313" y2="579.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="88.5" y="574.0981">&lt;09&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="132.5" y="574.0981">401 Unauthorized</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="930.5" y1="588.1641" y2="588.1641"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="28" y="598.3745">[user authorized]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="769.5" x2="811.5" y1="638.2344" y2="638.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="811.5" x2="811.5" y1="638.2344" y2="651.2344"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="770.5" x2="811.5" y1="651.2344" y2="651.2344"/><polygon fill="#A80036" points="780.5,647.2344,770.5,651.2344,780.5,655.2344,776.5,651.2344" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="776.5" y="625.6021">&lt;10&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="820.5" y="618.0356">create or reuse</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="820.5" y="633.1685">access_token</text><polygon fill="#A80036" points="458.5,691.2344,448.5,695.2344,458.5,699.2344,454.5,695.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="452.5" x2="763.5" y1="695.2344" y2="695.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="464.5" y="682.8677">&lt;11&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="508.5" y="675.3013">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="508.5" y="690.4341">TokenRespHdr: &lt;access_token&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="447.5" x2="489.5" y1="724.6328" y2="724.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="489.5" x2="489.5" y1="724.6328" y2="737.6328"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448.5" x2="489.5" y1="737.6328" y2="737.6328"/><polygon fill="#A80036" points="458.5,733.6328,448.5,737.6328,458.5,741.6328,454.5,737.6328" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="454.5" y="719.5669">&lt;12&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="498.5" y="719.5669">validate access_token</text><path d="M33,752.6328 L97,752.6328 L97,759.6328 L87,769.6328 L33,769.6328 L33,752.6328 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="197.8672" style="stroke: #000000; stroke-width: 2.0;" width="454" x="33" y="752.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="48" y="765.6997">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="143" x="112" y="764.8433">[invalid access_token]</text><polygon fill="#A80036" points="82.5,786.7656,72.5,790.7656,82.5,794.7656,78.5,790.7656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="76.5" x2="436.5" y1="790.7656" y2="790.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="88.5" y="785.8325">&lt;13&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="59" x="132.5" y="785.8325">520 Error</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="33" x2="487" y1="799.8984" y2="799.8984"/><path d="M43,807.8984 L107,807.8984 L107,814.8984 L97,824.8984 L43,824.8984 L43,807.8984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.6016" style="stroke: #000000; stroke-width: 2.0;" width="434" x="43" y="807.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="58" y="820.9653">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="122" y="820.1089">[config:use_redirect=</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="259" y="820.1089">true</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5" x="284" y="820.1089">]</text><polygon fill="#A80036" points="82.5,872.0313,72.5,876.0313,82.5,880.0313,78.5,876.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="76.5" x2="436.5" y1="876.0313" y2="876.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="88.5" y="856.231">&lt;14&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="132.5" y="841.0981">302 Redirect</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="132.5" y="856.231">Set-Cookie: TokenCookie=&lt;access_token&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="298" x="132.5" y="871.3638">Location: https://example-cdn.com/path/object</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="43" x2="477" y1="885.4297" y2="885.4297"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="137" x="48" y="895.6401">[config:use_redirect=</text><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="30" x="185" y="895.6401">false</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="5" x="215" y="895.6401">]</text><polygon fill="#A80036" points="82.5,931.2344,72.5,935.2344,82.5,939.2344,78.5,935.2344" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="76.5" x2="436.5" y1="935.2344" y2="935.2344"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="88.5" y="922.8677">&lt;15&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="132.5" y="915.3013">200 OK</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="279" x="132.5" y="930.4341">Set-Cookie: TokenCookie=&lt;access_token&gt;</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="13" x2="970.5" y1="965.5" y2="965.5"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="225" x="18" y="975.7104">[valid access_token AND cache-hit]</text><polygon fill="#A80036" points="82.5,996.3047,72.5,1000.3047,82.5,1004.3047,78.5,1000.3047" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="76.5" x2="441.5" y1="1000.3047" y2="1000.3047"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="88.5" y="995.3716">&lt;16&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="132.5" y="995.3716">200 OK</text><!--
@startuml

participant UA
participant CDN
participant Origin

autonumber "<b><00>"
UA -> CDN : GET https://example-cdn.com/path/object\n[Cookie: TokenCookie=<access_token>]
activate CDN

CDN->CDN:validate access_token

alt valid access_token
  CDN -> CDN: extract access_token //subject//\nand add it to cache key
else missing or invalid token
  CDN -> CDN: skip cache (same as cache-miss)
end

alt invalid access_token OR cache-miss
  alt config:use_redirect=//true//
    CDN -> Origin : HEAD https://example.com/path/object
    activate Origin
  else config:use_redirect=//false//
    CDN -> Origin : GET https://example.com/path/object
    deactivate CDN
  end

  Origin -> Origin: trigger authentication\n+ authorization flow
  note over UA,Origin #white
    Origin <=> UA authentication and authorization flow using IdMS and DS, etc.
  endnote

  alt user unauthorized
    Origin -> CDN : 401 Unauthorized
    activate CDN
    CDN -> UA : 401 Unauthorized
  else user authorized

    Origin -> Origin:create or reuse\naccess_token

    Origin -> CDN: 200 OK\nTokenRespHdr: <access_token>
    deactivate Origin

    CDN->CDN:validate access_token

    alt invalid access_token
      CDN -> UA : 520 Error
    else
      alt config:use_redirect=//true//
        CDN -> UA : 302 Redirect\nSet-Cookie: TokenCookie=<access_token>\nLocation: https://example-cdn.com/path/object
      else config:use_redirect=//false//
        CDN -> UA : 200 OK\nSet-Cookie: TokenCookie=<access_token>
      end
    end

  end
else valid access_token AND cache-hit
  CDN -> UA : 200 OK
  deactivate CDN
end


@enduml

PlantUML version 1.2018.01(Sun Jan 28 18:08:22 GMT 2018)
(APACHE source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.9.1+11
Operating System: Linux
OS Version: 5.10.7-200.fc33.x86_64
Default Encoding: UTF-8
Language: en
Country: IE
--></g></svg>