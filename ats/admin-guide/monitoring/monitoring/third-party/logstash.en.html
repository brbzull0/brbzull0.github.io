


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Logstash &mdash; Apache Traffic Server 10.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/override.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Error Messages" href="../../error-messages.en.html" />
    <link rel="prev" title="Circonus" href="circonus.en.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home"> Apache Traffic Server
          

          
            
            <img src="../../../../_static/trans_logo_tm_380x69.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.en.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../introduction.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../installation/index.en.html">Installing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuration/index.en.html">Proxy Cache Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../interaction/index.en.html">Interacting with Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../security/index.en.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../storage/index.en.html">Cache Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plugins/index.en.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../logging/index.en.html">Logging</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.en.html">Monitoring</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../alarms.en.html">Traffic Manager Alarms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../statistics/index.en.html">Statistics</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.en.html">Monitoring</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../builtin.en.html">Using Built-in Tools</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.en.html">Integrating Third-Party Tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../error-messages.en.html">Error Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../diagnostic-files.en.html">traffic.out</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../diagnostic-files.en.html#diags-log">diags.log</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../diagnostic-files.en.html#error-log">error.log</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../configuring-traffic-server.en.html">Configuring Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../layer-4-routing.en.html">Layer 4 Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../performance/index.en.html">Performance Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../files/index.en.html">Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../jsonrpc/index.en.html">JSONRPC API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.en.html#audience">Audience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer-guide/index.en.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../appendices/index.en.html">Appendices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Apache Traffic Server</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.en.html">Administrator’s Guide</a> &raquo;</li>
        
          <li><a href="../../index.en.html">Monitoring</a> &raquo;</li>
        
          <li><a href="../index.en.html">Monitoring</a> &raquo;</li>
        
          <li><a href="index.en.html">Integrating Third-Party Tools</a> &raquo;</li>
        
      <li>Logstash</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/admin-guide/monitoring/monitoring/third-party/logstash.en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="logstash">
<span id="admin-monitoring-logstash"></span><h1>Logstash<a class="headerlink" href="#logstash" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://www.elastic.co/products/logstash">Logstash</a> is a powerful, open
source, unstructured data processing program that can accept text data from
many different sources (directly over TCP/UDP, via Unix sockets, or by reading
in files from disk for example), in many different formats and transform those
inputs into structured, searchable documents.</p>
<p>One of the most common use cases is to take text based system and application
logs, extract individual fields (e.g. host names, error codes, timing data, and
so on), and make the data available in Elasticsearch for searching and
reporting.</p>
<p>In this guide, we will cover the basics of getting your Traffic Server log data into
Logstash. Going the next step and building fancy Kibana dashboards on top of
that is currently left as an exercise for the reader.</p>
<div class="section" id="ts-log-formats">
<h2>Traffic Server Log Formats<a class="headerlink" href="#ts-log-formats" title="Permalink to this headline">¶</a></h2>
<p>Traffic Server provides a very flexible set of logging outputs. Almost any format can be
constructed. The full range of options is covered in the <a class="reference internal" href="../../../logging/index.en.html#admin-logging"><span class="std std-ref">Logging</span></a>
chapter.</p>
<p>This guide will walk you through using the appropriate filters in Logstash for
the common logging formats in Traffic Server. If you have constructed your own custom log
formats, you will need to build upon these examples and refer to the Logstash
documentation to produce custom filters capable of parsing your own formats.</p>
</div>
<div class="section" id="logstash-input">
<h2>Logstash Input<a class="headerlink" href="#logstash-input" title="Permalink to this headline">¶</a></h2>
<p>For the on-disk logs produced by Traffic Server, you will want to use Logstash’s <code class="docutils literal notranslate"><span class="pre">file</span></code>
input plugin. Note that your logs must be in <code class="docutils literal notranslate"><span class="pre">ASCII</span></code> format, not <code class="docutils literal notranslate"><span class="pre">binary</span></code>,
for the plugin to work.</p>
<p>Assuming that your Traffic Server event logs are named <code class="docutils literal notranslate"><span class="pre">access-&lt;rotationtimestamp&gt;.log</span></code>
and stored at <code class="docutils literal notranslate"><span class="pre">/var/log/trafficserver/</span></code>, the following Logstash input
configuration should work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">input</span> <span class="p">{</span>
  <span class="n">file</span> <span class="p">{</span>
    <span class="n">path</span> <span class="o">=&gt;</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">trafficserver</span><span class="o">/</span><span class="n">access</span><span class="o">-*.</span><span class="n">log</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Logstash provides some additional tweaking options, which are explained in the
<a class="reference external" href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-file.html">file plugin documentation</a>
but the above provides the bare minimum required to have Logstash read log data
from local disks.</p>
</div>
<div class="section" id="logstash-filters">
<h2>Logstash Filters<a class="headerlink" href="#logstash-filters" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.elastic.co/guide/en/logstash/current/plugins-filters-grok.html">grok filter</a>
in Logstash allows you to completely tailor the parsing of your source data and
extract as many or as few fields as you like.</p>
<p>Some patterns are already built and can be used very easily. If you have built
custom log formats for Traffic Server, you may need to write your own patterns, however.</p>
<div class="section" id="squid-compatible">
<h3>Squid Compatible<a class="headerlink" href="#squid-compatible" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../../../logging/examples.en.html#admin-logging-examples-squid"><span class="std std-ref">Squid</span></a> log format includes, unsurprisingly, a
few useful fields for proxy servers. Using the following grok pattern will
extract this information from your Traffic Server logs if you employ the Squid compatible
log format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span> <span class="p">{</span>
  <span class="n">grok</span> <span class="p">{</span>
    <span class="n">match</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;%{NUMBER:timestamp} %{NUMBER:timetoserve} %{IPORHOST:clientip} %{WORD:cachecode}/%{NUMBER:response} %{NUMBER:bytes} %{WORD:verb} %{NOTSPACE:request} %{USER:auth} %{NOTSPACE:route} %{DATA:contenttype}&quot;</span> <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">date</span> <span class="p">{</span>
    <span class="n">match</span> <span class="o">=&gt;</span> <span class="p">[</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;UNIX&quot;</span> <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The resulting structured document will contain the following fields:</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>timestamp</td>
<td>Date and time of the client request.</td>
</tr>
<tr class="row-odd"><td>timetoserve</td>
<td>Time, in seconds, from initial client connection to Traffic Server until the
last byte has been sent back to client from Traffic Server.</td>
</tr>
<tr class="row-even"><td>clientip</td>
<td>Client IP address or hostname.</td>
</tr>
<tr class="row-odd"><td>cachecode</td>
<td><a class="reference internal" href="../../../logging/cache-results.en.html#admin-logging-crc"><span class="std std-ref">Cache Result Codes</span></a>.</td>
</tr>
<tr class="row-even"><td>response</td>
<td>HTTP response status code sent by Traffic Server to the client.</td>
</tr>
<tr class="row-odd"><td>bytes</td>
<td>Length, in bytes, of the Traffic Server response to the client, including
headers.</td>
</tr>
<tr class="row-even"><td>verb</td>
<td>HTTP method (e.g. <code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code>, etc.) of the client request.</td>
</tr>
<tr class="row-odd"><td>request</td>
<td>URL specified by the client request.</td>
</tr>
<tr class="row-even"><td>auth</td>
<td>Authentication username supplied by the client, if present.</td>
</tr>
<tr class="row-odd"><td>route</td>
<td>Proxy hierarchy route; the route used by Traffic Server to retrieve the cache
object.</td>
</tr>
<tr class="row-even"><td>contenttype</td>
<td>Content type of the response.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="netscape-common">
<h3>Netscape Common<a class="headerlink" href="#netscape-common" title="Permalink to this headline">¶</a></h3>
<p>If your Traffic Server instance is already outputting <a class="reference internal" href="../../../logging/examples.en.html#admin-logging-examples-netscape"><span class="std std-ref">Netscape Common</span></a>
format logs, then Logstash’s <code class="docutils literal notranslate"><span class="pre">COMMONAPACHELOG</span></code> pattern will handle your logs
out of the box. Add the following filter block to your Logstash configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span> <span class="p">{</span>
  <span class="n">grok</span> <span class="p">{</span>
    <span class="n">match</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;%</span><span class="si">{COMMONAPACHELOG}</span><span class="s2">&quot;</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This will produce a structured document for each log entry with the following
fields:</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>clientip</td>
<td>Client IP address or hostname.</td>
</tr>
<tr class="row-odd"><td>ident</td>
<td>Always a literal <code class="docutils literal notranslate"><span class="pre">-</span></code> character for Traffic Server logs.</td>
</tr>
<tr class="row-even"><td>auth</td>
<td>The authentication username for the client request. A <code class="docutils literal notranslate"><span class="pre">-</span></code> means
no authentication was required (or supplied).</td>
</tr>
<tr class="row-odd"><td>timestamp</td>
<td>The date and time of the client request.</td>
</tr>
<tr class="row-even"><td>verb</td>
<td>HTTP method used for the request (e.g. <code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code>, etc.).</td>
</tr>
<tr class="row-odd"><td>request</td>
<td>URL specified by the client request.</td>
</tr>
<tr class="row-even"><td>httpversion</td>
<td>HTTP version (e.g. <code class="docutils literal notranslate"><span class="pre">1.1</span></code>) used by the client.</td>
</tr>
<tr class="row-odd"><td>rawrequest</td>
<td><em>See note below.</em></td>
</tr>
<tr class="row-even"><td>response</td>
<td>HTTP status code used for Traffic Server response (not the origin’s response
code).</td>
</tr>
<tr class="row-odd"><td>bytes</td>
<td>Length of Traffic Server response to client, in bytes.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">rawrequest</span></code> is populated when the usual <code class="docutils literal notranslate"><span class="pre">&quot;&lt;verb&gt;</span> <span class="pre">&lt;request&gt;</span> <span class="pre">http/&lt;httpversion&gt;&quot;</span></code>
pattern was not matched. In that event, those three fields will be missing
from the document, and instead <code class="docutils literal notranslate"><span class="pre">rawrequest</span></code> will have the original string.</p>
</div>
</div>
<div class="section" id="netscape-extended">
<h3>Netscape Extended<a class="headerlink" href="#netscape-extended" title="Permalink to this headline">¶</a></h3>
<p>The following pattern adds to Common Apache to support the additional fields
found in <a class="reference internal" href="../../../logging/examples.en.html#admin-logging-examples-extended"><span class="std std-ref">Netscape Extended</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">filter</span> <span class="p">{</span>
  <span class="n">grok</span> <span class="p">{</span>
    <span class="n">match</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s2">&quot;message&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;%</span><span class="si">{COMMONAPACHELOG}</span><span class="s2"> %{NUMBER:originstatus} %{NUMBER:originrespbytes} %{NUMBER:clientreqbytes} %{NUMBER:proxyreqbytes} %{NUMBER:clienthdrbytes} %{NUMBER:proxyresphdrbytes} %{NUMBER:proxyreqhdrbytes} %{NUMBER:originhdrbytes} %{NUMBER:timetoserve}&quot;</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Because this starts out with the <code class="docutils literal notranslate"><span class="pre">COMMONAPACHELOG</span></code> pattern, you will get all
of the fields mentioned in <a class="reference internal" href="#netscape-common">Netscape Common</a> above, as well as the following:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>originstatus</td>
<td>HTTP status code returned by origin server.</td>
</tr>
<tr class="row-odd"><td>originrespbytes</td>
<td>Body length, in bytes, of origin’s response to Traffic Server.</td>
</tr>
<tr class="row-even"><td>clientreqbytes</td>
<td>Body length, in bytes, of client request to Traffic Server.</td>
</tr>
<tr class="row-odd"><td>proxyreqbytes</td>
<td>Body length, in bytes, of Traffic Server request to origin.</td>
</tr>
<tr class="row-even"><td>clienthdrbytes</td>
<td>Header length, in bytes, of client request to Traffic Server.</td>
</tr>
<tr class="row-odd"><td>proxyresphdrbytes</td>
<td>Header length, in bytes, of Traffic Server response to client.</td>
</tr>
<tr class="row-even"><td>proxyreqhdrbytes</td>
<td>Header length, in bytes, of Traffic Server request to origin.</td>
</tr>
<tr class="row-odd"><td>originhdrbytes</td>
<td>Header length, in bytes, of origin’s response to Traffic Server.</td>
</tr>
<tr class="row-even"><td>timetoserve</td>
<td>Time, in seconds, from initial client connection to Traffic Server
until the last byte has been sent back to client from Traffic Server.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://www.elastic.co/guide/en/logstash/current/index.html">Logstash Documentation</a></li>
<li><a class="reference external" href="https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns">Grok Patterns</a></li>
<li><a class="reference external" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">Elasticsearch Documentation</a></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../error-messages.en.html" class="btn btn-neutral float-right" title="Error Messages" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="circonus.en.html" class="btn btn-neutral float-left" title="Circonus" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, dev@trafficserver.apache.org

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>
 


</body>
</html>