


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Logging Cache Results &mdash; Apache Traffic Server 10.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/override.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Log Rotation and Retention" href="rotation.en.html" />
    <link rel="prev" title="Formatting Log Files" href="formatting.en.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Apache Traffic Server
          

          
            
            <img src="../../_static/trans_logo_tm_380x69.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.en.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.en.html">Installing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.en.html">Proxy Cache Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interaction/index.en.html">Interacting with Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.en.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.en.html">Cache Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.en.html">Plugins</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.en.html">Logging</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="understanding.en.html">Understanding Traffic Server Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="destinations.en.html">Log Destinations</a></li>
<li class="toctree-l3"><a class="reference internal" href="formatting.en.html">Formatting Log Files</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Logging Cache Results</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#interpreting-cache-results">Interpreting Cache Results</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cache-result-codes">Cache Result Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cache-result-sub-codes">Cache Result Sub-Codes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="rotation.en.html">Log Rotation and Retention</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.en.html">Log Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="examples.en.html">Configuration Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.en.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuring-traffic-server.en.html">Configuring Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layer-4-routing.en.html">Layer 4 Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/index.en.html">Performance Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../files/index.en.html">Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jsonrpc/index.en.html">JSONRPC API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.en.html#audience">Audience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-guide/index.en.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/index.en.html">Appendices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apache Traffic Server</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.en.html">Administrator’s Guide</a> &raquo;</li>
        
          <li><a href="index.en.html">Logging</a> &raquo;</li>
        
      <li>Logging Cache Results</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/logging/cache-results.en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="logging-cache-results">
<span id="admin-logging-cache-results"></span><h1>Logging Cache Results<a class="headerlink" href="#logging-cache-results" title="Permalink to this headline">¶</a></h1>
<p>In addition to recording information about client and origin requests and
responses, Traffic Server exposes detailed information about cache interactions for every
request which passes through a node. This information is incredibly important
to establishing an efficient caching configuration, though it is only present
in your logging output if the <a class="reference internal" href="formatting.en.html#crc"><span class="std std-ref">crc</span></a> logging field is used. For even
more detail, see <a class="reference internal" href="formatting.en.html#crsc"><span class="std std-ref">crsc</span></a>.</p>
<div class="section" id="interpreting-cache-results">
<h2>Interpreting Cache Results<a class="headerlink" href="#interpreting-cache-results" title="Permalink to this headline">¶</a></h2>
<p>An immediate benefit to including cache result codes in your logging output is
the ability to trace and diagnose specific problems. You may be able to tell
without any help that a particular request takes much longer than it should,
and HTTP response inspection reveals a very small (or possibly zero)
value for the Age header, but you may still be left wondering why. If it’s
possible to correlate the problematic request(s) with access log entries, the
cache result code may help shed significant light.</p>
<p>Misconfigured headers from your origin may be resulting in clients aggressively
sending <code class="docutils literal notranslate"><span class="pre">no-cache</span></code> requests, or cache objects may be going stale too rapidly
and IMS (<code class="docutils literal notranslate"><span class="pre">If-Modified-Since</span></code>) requests are reaching back to the origin server
more often than you anticipated. Perhaps this isn’t a regular web browser
request, but part of an application’s API and the HTTP method being used isn’t
understood by Traffic Server and instead just gets passed blindly through to the origin.
These and other situations can all be revealed pretty quickly by logging and
inspecting Traffic Server cache results.</p>
<p>Even more useful as an overall monitoring and optimization strategy is to log
the cache results, and then produce reports through log aggregation and
analysis tools. Such an approach can reveal larger trends and unearth problems
or inefficiencies that don’t necessarily result in outright client errors or
bug reports from users.</p>
<p>A high ratio of <a class="reference internal" href="#crc-tcp-miss"><span class="std std-ref">TCP_MISS</span></a> to <a class="reference internal" href="#crc-tcp-hit"><span class="std std-ref">TCP_HIT</span></a> events can indicate
that your cache is sized too small and objects are being evicted too quickly
for your Traffic Server cache to reduce traffic to your origin servers - largely
defeating the purpose of having a caching layer at all. Here <em>too small</em> could
be anything from simply not sized appropriately despite your hopes and
intentions otherwise (hopefully because you’re still fine-tuning your
configuration based on monitoring and reporting results) to the difficult
situation in which you operate very large sets of cacheable data that see too
sparse access patterns to easily create a single cache policy.</p>
<p>In the latter scenario, you may need to investigate tiered caching policies on
subsets of your data to better tune the eviction rates, or partition data
across different storage volumes to keep less-frequently, but very large
objects (e.g. hours-long, archived training videos from years past) from
suddenly evicting large numbers of more moderately visited, much smaller, but
infrequently-changing objects (e.g. costly HTML pages of your semester course
schedules generated by an unruly SQL query in your aging CMS).</p>
<p>Large numbers of <a class="reference internal" href="#crc-tcp-client-refresh"><span class="std std-ref">TCP_CLIENT_REFRESH</span></a> events for objects which are supposed to be
served primarily (or perhaps almost exclusively) from your Traffic Server cache may
indicate that something, possibly a misconfiguration of the caching headers in
your origin server responses, is triggering clients to submit requests with
<code class="docutils literal notranslate"><span class="pre">no-cache</span></code> enabled.</p>
<p>Almost any non-trivial occurrence of <a class="reference internal" href="#crc-tcp-ref-fail-hit"><span class="std std-ref">TCP_REF_FAIL_HIT</span></a> requests is a
signal that your origin servers are not responding to proxied requests from
Traffic Server when they should. Traffic Server has found an object in its cache, but determining
it to be stale attempted to refresh the object from an origin and was met with
failure. The client still received an object back, but there was a chance it
may have been outdated as a result of the origin failure.</p>
</div>
<div class="section" id="cache-result-codes">
<span id="admin-logging-crc"></span><h2>Cache Result Codes<a class="headerlink" href="#cache-result-codes" title="Permalink to this headline">¶</a></h2>
<p>The following are all possible cache result codes you will currently encounter
in Traffic Server logging output, and what each one means.</p>
<div class="section" id="tcp-hit">
<span id="crc-tcp-hit"></span><h3>TCP_HIT<a class="headerlink" href="#tcp-hit" title="Permalink to this headline">¶</a></h3>
<p>A valid copy of the requested object was in the cache and Traffic Server sent
the object to the client.</p>
</div>
<div class="section" id="tcp-miss">
<span id="crc-tcp-miss"></span><h3>TCP_MISS<a class="headerlink" href="#tcp-miss" title="Permalink to this headline">¶</a></h3>
<p>The requested object was not in cache, so Traffic Server retrieved
the object from the origin server (or a parent proxy) and sent it to
the client.</p>
</div>
<div class="section" id="tcp-refresh-hit">
<span id="crc-tcp-refresh-hit"></span><h3>TCP_REFRESH_HIT<a class="headerlink" href="#tcp-refresh-hit" title="Permalink to this headline">¶</a></h3>
<p>The object was in the cache, but it was stale. Traffic Server made an
<code class="docutils literal notranslate"><span class="pre">if-modified-since</span></code> request to the origin server and the
origin server sent a <code class="docutils literal notranslate"><span class="pre">304</span></code> not-modified response. Traffic
Server sent the cached object to the client.</p>
</div>
<div class="section" id="tcp-ref-fail-hit">
<span id="crc-tcp-ref-fail-hit"></span><h3>TCP_REF_FAIL_HIT<a class="headerlink" href="#tcp-ref-fail-hit" title="Permalink to this headline">¶</a></h3>
<p>The object was in the cache but was stale. Traffic Server made an
<code class="docutils literal notranslate"><span class="pre">if-modified-since</span></code> request to the origin server but the server
did not respond. Traffic Server sent the cached object to the
client.</p>
</div>
<div class="section" id="tcp-refresh-miss">
<span id="crc-tcp-refresh-miss"></span><h3>TCP_REFRESH_MISS<a class="headerlink" href="#tcp-refresh-miss" title="Permalink to this headline">¶</a></h3>
<p>The object was in the cache but was stale. Traffic Server made an
<code class="docutils literal notranslate"><span class="pre">if-modified-since</span></code> request to the origin server and the server
returned a new object. Traffic Server served the new object to the
client.</p>
</div>
<div class="section" id="tcp-client-refresh">
<span id="crc-tcp-client-refresh"></span><h3>TCP_CLIENT_REFRESH<a class="headerlink" href="#tcp-client-refresh" title="Permalink to this headline">¶</a></h3>
<p>The client issued a request with a <code class="docutils literal notranslate"><span class="pre">no-cache</span></code> header. Traffic
Server obtained the requested object from the origin server and sent
a copy to the client. Traffic Server deleted the previous copy of
the object from cache.</p>
</div>
<div class="section" id="tcp-ims-hit">
<span id="crc-tcp-ims-hit"></span><h3>TCP_IMS_HIT<a class="headerlink" href="#tcp-ims-hit" title="Permalink to this headline">¶</a></h3>
<p>The client issued an <code class="docutils literal notranslate"><span class="pre">if-modified-since</span></code> request and the object
was in cache and fresher than the IMS date, or an
<code class="docutils literal notranslate"><span class="pre">if-modified-since</span></code> request to the origin server revealed the
cached object was fresh. Traffic Server served the cached object to
the client.</p>
</div>
<div class="section" id="tcp-ims-miss">
<span id="crc-tcp-ims-miss"></span><h3>TCP_IMS_MISS<a class="headerlink" href="#tcp-ims-miss" title="Permalink to this headline">¶</a></h3>
<p>The client issued an
<code class="docutils literal notranslate"><span class="pre">if-modified-since</span> <span class="pre">request</span></code> and the object was either not in
cache or was stale in cache. Traffic Server sent an
<code class="docutils literal notranslate"><span class="pre">if-modified-since</span> <span class="pre">request</span></code> to the origin server and received the
new object. Traffic Server sent the updated object to the client.</p>
</div>
<div class="section" id="tcp-swapfail">
<span id="crc-tcp-swapfail"></span><h3>TCP_SWAPFAIL<a class="headerlink" href="#tcp-swapfail" title="Permalink to this headline">¶</a></h3>
<p>The object was in the cache but could not be accessed. The client
did not receive the object.</p>
</div>
<div class="section" id="err-client-abort">
<span id="crc-err-client-abort"></span><h3>ERR_CLIENT_ABORT<a class="headerlink" href="#err-client-abort" title="Permalink to this headline">¶</a></h3>
<p>The client disconnected before the complete object was sent.</p>
</div>
<div class="section" id="err-client-read-error">
<span id="crc-err-client-read-error"></span><h3>ERR_CLIENT_READ_ERROR<a class="headerlink" href="#err-client-read-error" title="Permalink to this headline">¶</a></h3>
<p>The client had read errors (network problems).</p>
</div>
<div class="section" id="err-connect-fail">
<span id="crc-err-connect-fail"></span><h3>ERR_CONNECT_FAIL<a class="headerlink" href="#err-connect-fail" title="Permalink to this headline">¶</a></h3>
<p>Traffic Server could not reach the origin server.</p>
</div>
<div class="section" id="err-dns-fail">
<span id="crc-err-dns-fail"></span><h3>ERR_DNS_FAIL<a class="headerlink" href="#err-dns-fail" title="Permalink to this headline">¶</a></h3>
<p>The Domain Name Server (DNS) could not resolve the origin server
name, or no DNS could be reached.</p>
</div>
<div class="section" id="err-invalid-req">
<span id="crc-err-invalid-req"></span><h3>ERR_INVALID_REQ<a class="headerlink" href="#err-invalid-req" title="Permalink to this headline">¶</a></h3>
<p>The client HTTP request was invalid. (Traffic Server forwards
requests with unknown methods to the origin server.)</p>
</div>
<div class="section" id="err-read-timeout">
<span id="crc-err-read-timeout"></span><h3>ERR_READ_TIMEOUT<a class="headerlink" href="#err-read-timeout" title="Permalink to this headline">¶</a></h3>
<p>The origin server did not respond to Traffic Server’s request within
the timeout interval.</p>
</div>
<div class="section" id="err-proxy-denied">
<span id="crc-err-proxy-denied"></span><h3>ERR_PROXY_DENIED<a class="headerlink" href="#err-proxy-denied" title="Permalink to this headline">¶</a></h3>
<p>Client service was denied.</p>
</div>
<div class="section" id="err-unknown">
<span id="crc-err-unknown"></span><h3>ERR_UNKNOWN<a class="headerlink" href="#err-unknown" title="Permalink to this headline">¶</a></h3>
<p>The client connected, but subsequently disconnected without sending
a request.</p>
</div>
</div>
<div class="section" id="cache-result-sub-codes">
<span id="admin-logging-crsc"></span><h2>Cache Result Sub-Codes<a class="headerlink" href="#cache-result-sub-codes" title="Permalink to this headline">¶</a></h2>
<p>The following are all possible cache result sub-codes you will currently
encounter in Traffic Server logging output, and what each one means. These sub-codes can
offer more specific details that are not exposed in cache result codes.</p>
<div class="section" id="num-redirections-exceeded">
<span id="crsc-num-redirects-exceeded"></span><h3>NUM_REDIRECTIONS_EXCEEDED<a class="headerlink" href="#num-redirections-exceeded" title="Permalink to this headline">¶</a></h3>
<p>The origin server responded with a redirect, but following this redirect would
exceed the configured maximum number of redirects allowed:
<a class="reference internal" href="../files/records.config.en.html#proxy-config-http-number-of-redirections" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.http.number_of_redirections</span></code></a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rotation.en.html" class="btn btn-neutral float-right" title="Log Rotation and Retention" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="formatting.en.html" class="btn btn-neutral float-left" title="Formatting Log Files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, dev@trafficserver.apache.org

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>
 


</body>
</html>