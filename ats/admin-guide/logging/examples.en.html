


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration Examples &mdash; Apache Traffic Server 10.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/override.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Monitoring" href="../monitoring/index.en.html" />
    <link rel="prev" title="Log Filters" href="filters.en.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Apache Traffic Server
          

          
            
            <img src="../../_static/trans_logo_tm_380x69.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.en.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.en.html">Installing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.en.html">Proxy Cache Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interaction/index.en.html">Interacting with Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.en.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.en.html">Cache Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.en.html">Plugins</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.en.html">Logging</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="understanding.en.html">Understanding Traffic Server Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="destinations.en.html">Log Destinations</a></li>
<li class="toctree-l3"><a class="reference internal" href="formatting.en.html">Formatting Log Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="cache-results.en.html">Logging Cache Results</a></li>
<li class="toctree-l3"><a class="reference internal" href="rotation.en.html">Log Rotation and Retention</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.en.html">Log Filters</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Configuration Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#online-event-log-builder">Online Event Log Builder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#emulating-other-http-server-formats">Emulating Other HTTP Server Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hourly-rotated-squid-proxy-logs">Hourly Rotated Squid Proxy Logs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summarizing-number-of-requests-and-total-bytes-sent-every-10-seconds">Summarizing Number of Requests and Total Bytes Sent Every 10 Seconds</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dual-output-to-compact-binary-logs-and-ascii-pipes">Dual Output to Compact Binary Logs and ASCII Pipes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filtering-events-to-ascii-pipe-for-alerting">Filtering Events to ASCII Pipe for Alerting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-ascii-pipe-buffer-size">Configuring ASCII Pipe Buffer Size</a></li>
<li class="toctree-l4"><a class="reference internal" href="#summarizing-origin-responses-by-hour">Summarizing Origin Responses by Hour</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.en.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuring-traffic-server.en.html">Configuring Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layer-4-routing.en.html">Layer 4 Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/index.en.html">Performance Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../files/index.en.html">Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jsonrpc/index.en.html">JSONRPC API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.en.html#audience">Audience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-guide/index.en.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/index.en.html">Appendices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apache Traffic Server</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.en.html">Administrator’s Guide</a> &raquo;</li>
        
          <li><a href="index.en.html">Logging</a> &raquo;</li>
        
      <li>Configuration Examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/logging/examples.en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="configuration-examples">
<span id="admin-logging-examples"></span><h1>Configuration Examples<a class="headerlink" href="#configuration-examples" title="Permalink to this headline">¶</a></h1>
<p>This section provides examples for a wide range of logging scenarios. While not
exhaustive of all possibilities (Traffic Server logging is quite flexible), these entries
should hopefully get most administrators headed onto the right path.</p>
<p>Unless otherwise noted, the example configurations here are to be applied in
<a class="reference internal" href="../files/logging.yaml.en.html#std:configfile-logging.yaml"><code class="xref std std-file docutils literal notranslate"><span class="pre">logging.yaml</span></code></a>.</p>
<div class="section" id="online-event-log-builder">
<h2>Online Event Log Builder<a class="headerlink" href="#online-event-log-builder" title="Permalink to this headline">¶</a></h2>
<p>If you need any assistance building your event log, you can try out our
<a class="reference external" href="https://trafficserver.apache.org/logbuilder/">online log builder</a>. This is a
work in progress, so any comments, critique or suggestions are most welcome.</p>
</div>
<div class="section" id="emulating-other-http-server-formats">
<h2>Emulating Other HTTP Server Formats<a class="headerlink" href="#emulating-other-http-server-formats" title="Permalink to this headline">¶</a></h2>
<div class="section" id="netscape-common">
<span id="admin-logging-examples-netscape"></span><h3>Netscape Common<a class="headerlink" href="#netscape-common" title="Permalink to this headline">¶</a></h3>
<p>The following figure shows a sample log entry in a Netscape Common log file.</p>
<div class="figure align-center">
<img alt="Sample Netscape Common log entry" src="../../_images/netscape_common_format.jpg" />
</div>
<p>The numbered sections correspond to the following log fields in Traffic Server:</p>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="8%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">No.</th>
<th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>chi</td>
<td>The IP address of the client’s host machine.</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>–</td>
<td>This hyphen (<code class="docutils literal notranslate"><span class="pre">-</span></code>) is always present in Netscape log entries.</td>
</tr>
<tr class="row-even"><td>3</td>
<td>caun</td>
<td>The authenticated client username. A hyphen (<code class="docutils literal notranslate"><span class="pre">-</span></code>) means no
authentication was required.</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>cqtn</td>
<td>The date and time of the client request, enclosed in brackets.</td>
</tr>
<tr class="row-even"><td>5</td>
<td>cqtx</td>
<td>The request line, enclosed in quotes.</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>pssc</td>
<td>The proxy response status code (HTTP reply code).</td>
</tr>
<tr class="row-even"><td>7</td>
<td>pscl</td>
<td>The length of the Traffic Server response to the client in bytes.</td>
</tr>
</tbody>
</table>
<p>To recreate this as a log format in <a class="reference internal" href="../files/logging.yaml.en.html#std:configfile-logging.yaml"><code class="xref std std-file docutils literal notranslate"><span class="pre">logging.yaml</span></code></a> you would define the
following format object:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">formats</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">common</span>
  <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;%&lt;chi&gt; - %&lt;caun&gt; [%&lt;cqtn&gt;] &quot;%&lt;cqtx&gt;&quot; %&lt;pssc&gt; %&lt;pscl&gt;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="netscape-extended">
<span id="admin-logging-examples-extended"></span><h3>Netscape Extended<a class="headerlink" href="#netscape-extended" title="Permalink to this headline">¶</a></h3>
<p>The following figure shows a sample log entry in a Netscape Extended log file.</p>
<div class="figure align-center">
<img alt="Sample Netscape Extended log entry" src="../../_images/netscape_extended_format.jpg" />
</div>
<p>In addition to fields 1-7 from the Netscape Common log format, the Extended
format adds the following fields:</p>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="6%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">No.</th>
<th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>8</td>
<td>sssc</td>
<td>The origin server response status code.</td>
</tr>
<tr class="row-odd"><td>9</td>
<td>sshl</td>
<td>The server response transfer length; the body length in the
origin server response to Traffic Server, in bytes.</td>
</tr>
<tr class="row-even"><td>10</td>
<td>cqcl</td>
<td>The client request transfer length; the body length in the
client request to Traffic Server, in bytes.</td>
</tr>
<tr class="row-odd"><td>11</td>
<td>pqcl</td>
<td>The proxy request transfer length; the body length in the Traffic Server
request to the origin server.</td>
</tr>
<tr class="row-even"><td>12</td>
<td>cqhl</td>
<td>The client request header length; the header length in the
client request to Traffic Server.</td>
</tr>
<tr class="row-odd"><td>13</td>
<td>pshl</td>
<td>The proxy response header length; the header length in the
Traffic Server response to the client.</td>
</tr>
<tr class="row-even"><td>14</td>
<td>pqhl</td>
<td>The proxy request header length; the header length in Traffic Server
request to the origin server.</td>
</tr>
<tr class="row-odd"><td>15</td>
<td>sshl</td>
<td>The server response header length; the header length in the
origin server response to Traffic Server.</td>
</tr>
<tr class="row-even"><td>16</td>
<td>tts</td>
<td>The time Traffic Server spent processing the client request; the number
of seconds between the time that the client established the
connection with Traffic Server and the time that Traffic Server sent the last byte
of the response back to the client.</td>
</tr>
</tbody>
</table>
<p>To recreate this as a log format in <a class="reference internal" href="../files/logging.yaml.en.html#std:configfile-logging.yaml"><code class="xref std std-file docutils literal notranslate"><span class="pre">logging.yaml</span></code></a> you would define the
following format object:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">formats</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">extended</span>
  <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;%&lt;chi&gt; - %&lt;caun&gt; [%&lt;cqtn&gt;] &quot;%&lt;cqtx&gt;&quot; %&lt;pssc&gt; %&lt;pscl&gt; %&lt;sssc&gt; %&lt;sscl&gt; %&lt;cqcl&gt; %&lt;pqcl&gt; %&lt;cqhl&gt; %&lt;pshl&gt; %&lt;pqhl&gt; %&lt;sshl&gt; %&lt;tts&gt;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="netscape-extended-2">
<span id="admin-logging-examples-extended2"></span><h3>Netscape Extended-2<a class="headerlink" href="#netscape-extended-2" title="Permalink to this headline">¶</a></h3>
<p>The following figure shows a sample log entry in a Netscape Extended2 log file.</p>
<div class="figure align-center">
<img alt="Sample Netscape Extended-2 log entry" src="../../_images/netscape_extended2_format.jpg" />
</div>
<p>In addition to fields 1-16 from the Netscape Common and Netscape Extended log
formats above, the Extended-2 format adds the following fields:</p>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="8%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">No.</th>
<th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>17</td>
<td>phr</td>
<td>The proxy hierarchy route; the route Traffic Server used to retrieve
the object.</td>
</tr>
<tr class="row-odd"><td>18</td>
<td>cfsc</td>
<td>The client finish status code: <code class="docutils literal notranslate"><span class="pre">FIN</span></code> if the client request
completed successfully or <code class="docutils literal notranslate"><span class="pre">INTR</span></code> if the client request was
interrupted.</td>
</tr>
<tr class="row-even"><td>19</td>
<td>pfsc</td>
<td>The proxy finish status code: <code class="docutils literal notranslate"><span class="pre">FIN</span></code> if the Traffic Server request to
the origin server completed successfully or <code class="docutils literal notranslate"><span class="pre">INTR</span></code> if the
request was interrupted.</td>
</tr>
<tr class="row-odd"><td>20</td>
<td>crc</td>
<td>The cache result code; how the Traffic Server cache responded to the
request: <code class="docutils literal notranslate"><span class="pre">HIT</span></code>, <code class="docutils literal notranslate"><span class="pre">MISS</span></code>, and so on. Cache result codes are
listed in <a class="reference internal" href="cache-results.en.html#admin-logging-crc"><span class="std std-ref">Cache Result Codes</span></a>.</td>
</tr>
</tbody>
</table>
<p>To recreate this as a log format in <a class="reference internal" href="../files/logging.yaml.en.html#std:configfile-logging.yaml"><code class="xref std std-file docutils literal notranslate"><span class="pre">logging.yaml</span></code></a> you would define the
following format object:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">formats</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">extended2</span>
  <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;%&lt;chi&gt; - %&lt;caun&gt; [%&lt;cqtn&gt;] &quot;%&lt;cqtx&gt;&quot; %&lt;pssc&gt; %&lt;pscl&gt; %&lt;sssc&gt; %&lt;sscl&gt; %&lt;cqcl&gt; %&lt;pqcl&gt; %&lt;cqhl&gt; %&lt;pshl&gt; %&lt;pqhl&gt; %&lt;sshl&gt; %&lt;tts&gt; %&lt;phr&gt; %&lt;cfsc&gt; %&lt;pfsc&gt; %&lt;crc&gt;&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="squid">
<span id="admin-logging-examples-squid"></span><h3>Squid<a class="headerlink" href="#squid" title="Permalink to this headline">¶</a></h3>
<p>The following figure shows a sample log entry in a Squid log file.</p>
<div class="figure align-center">
<img alt="Sample Squid log entry" src="../../_images/squid_format.jpg" />
</div>
<p>The numbered sections correspond to the following log fields in Traffic Server:</p>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="10%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">No.</th>
<th class="head">Field</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>cqtq</td>
<td>The client request timestamp in Squid format. The time of the
client request in seconds since January 1, 1970 UTC (with
millisecond resolution).</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>ttms</td>
<td>The time Traffic Server spent processing the client request. The number
of milliseconds between the time the client established the
connection with Traffic Server and the time Traffic Server sent the last byte of
the response back to the client.</td>
</tr>
<tr class="row-even"><td>3</td>
<td>chi</td>
<td>The IP address of the client’s host machine.</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>crc/pssc</td>
<td>The cache result code; how the cache responded to the request:
<code class="docutils literal notranslate"><span class="pre">HIT</span></code>, <code class="docutils literal notranslate"><span class="pre">MISS</span></code>, and so on. Cache result codes are described
in <a class="reference internal" href="cache-results.en.html#admin-logging-cache-results"><span class="std std-ref">Logging Cache Results</span></a>. The
proxy response status code (HTTP response status code from
Traffic Server to client).</td>
</tr>
<tr class="row-even"><td>5</td>
<td>psql</td>
<td>The length of the Traffic Server response to the client in bytes,
including headers and content.</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>cqhm</td>
<td>The client request method: <code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">POST</span></code>, and so on.</td>
</tr>
<tr class="row-even"><td>7</td>
<td>cauc</td>
<td>The client request canonical URL; blanks and other characters
that might not be parsed by log analysis tools are replaced by
escape sequences. The escape sequence is a percentage sign
followed by the ASCII code number of the replaced character in
hex.</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>caun</td>
<td>The username of the authenticated client. A hyphen (<code class="docutils literal notranslate"><span class="pre">-</span></code>)
means that no authentication was required.</td>
</tr>
<tr class="row-even"><td>9</td>
<td>phr/shn</td>
<td>The proxy hierarchy route. The route Traffic Server used to retrieve the
object.</td>
</tr>
<tr class="row-odd"><td>10</td>
<td>psct</td>
<td>The proxy response content type. The object content type taken
from the Traffic Server response header.</td>
</tr>
</tbody>
</table>
<p>To recreate this as a log format in <a class="reference internal" href="../files/logging.yaml.en.html#std:configfile-logging.yaml"><code class="xref std std-file docutils literal notranslate"><span class="pre">logging.yaml</span></code></a> you would define the
following format object:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">formats</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">squid</span>
  <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;%&lt;cqtq&gt; %&lt;ttms&gt; %&lt;chi&gt; %&lt;crc&gt;/%&lt;pssc&gt; %&lt;psql&gt; %&lt;cqhm&gt; %&lt;cquc&gt; %&lt;caun&gt; %&lt;phr&gt;/%&lt;shn&gt; %&lt;psct&gt;&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hourly-rotated-squid-proxy-logs">
<h2>Hourly Rotated Squid Proxy Logs<a class="headerlink" href="#hourly-rotated-squid-proxy-logs" title="Permalink to this headline">¶</a></h2>
<p>The following example demonstrates the creation of a Squid-compatible log
format, which is then applied to a log object containing an hourly rotation
policy.</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">formats</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">squid</span>
  <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;%&lt;cqtq&gt; %&lt;ttms&gt; %&lt;chi&gt; %&lt;crc&gt;/%&lt;pssc&gt; %&lt;psql&gt; %&lt;cqhm&gt; %&lt;cquc&gt; %&lt;caun&gt; %&lt;phr&gt;/%&lt;shn&gt; %&lt;psct&gt;&#39;</span>

<span class="n">logs</span><span class="p">:</span>
<span class="o">-</span> <span class="n">mode</span><span class="p">:</span> <span class="n">ascii</span>
  <span class="nb">format</span><span class="p">:</span> <span class="n">squid</span>
  <span class="n">filename</span><span class="p">:</span> <span class="n">squid</span>
  <span class="n">rolling_enabled</span><span class="p">:</span> <span class="n">time</span>
  <span class="n">rolling_interval_sec</span><span class="p">:</span> <span class="mi">3600</span>
  <span class="n">rolling_offset_hr</span><span class="p">:</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="summarizing-number-of-requests-and-total-bytes-sent-every-10-seconds">
<h2>Summarizing Number of Requests and Total Bytes Sent Every 10 Seconds<a class="headerlink" href="#summarizing-number-of-requests-and-total-bytes-sent-every-10-seconds" title="Permalink to this headline">¶</a></h2>
<p>The following example format generates one entry every 10 seconds. Each entry
contains the timestamp of the last entry of the interval, a count of the number
of entries seen within that 10-second interval, and the sum of all bytes sent
to clients:</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">formats</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">mysummary</span>
  <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;%&lt;LAST(cqts)&gt;:%&lt;COUNT(*)&gt;:%&lt;SUM(psql)&gt;&#39;</span>
  <span class="n">interval</span><span class="p">:</span> <span class="mi">10</span>
</pre></div>
</div>
</div>
<div class="section" id="dual-output-to-compact-binary-logs-and-ascii-pipes">
<h2>Dual Output to Compact Binary Logs and ASCII Pipes<a class="headerlink" href="#dual-output-to-compact-binary-logs-and-ascii-pipes" title="Permalink to this headline">¶</a></h2>
<p>This example demonstrates logging the same event data to multiple locations, in
a hypothetical scenario where we may wish to keep a compact form of our logs
available for archival purposes, while performing live log analysis on a stream
of the event data.</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ourformat</span> <span class="o">=</span> <span class="nb">format</span> <span class="p">{</span>
  <span class="n">Format</span> <span class="o">=</span> <span class="s1">&#39;%&lt;chi&gt; - %&lt;caun&gt; [%&lt;cqtn&gt;] &quot;%&lt;cqtx&gt;&quot; %&lt;pssc&gt; %&lt;pscl&gt;&#39;</span>
<span class="p">}</span>

<span class="n">log</span><span class="o">.</span><span class="n">binary</span> <span class="p">{</span>
  <span class="n">Format</span> <span class="o">=</span> <span class="n">ourformat</span><span class="p">,</span>
  <span class="n">Filename</span> <span class="o">=</span> <span class="s1">&#39;archived_events&#39;</span>
<span class="p">}</span>
<span class="n">log</span><span class="o">.</span><span class="n">pipe</span> <span class="p">{</span>
  <span class="n">Format</span> <span class="o">=</span> <span class="n">ourformat</span><span class="p">,</span>
  <span class="n">Filename</span> <span class="o">=</span> <span class="s1">&#39;streaming_log&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="filtering-events-to-ascii-pipe-for-alerting">
<h2>Filtering Events to ASCII Pipe for Alerting<a class="headerlink" href="#filtering-events-to-ascii-pipe-for-alerting" title="Permalink to this headline">¶</a></h2>
<p>This example illustrates a situation in which our Traffic Server cache contains <em>canary</em>
objects, which upon their access we want an external alerting system to fire
off all sorts of alarms. To accomplish this, we demonstrate the use of a filter
object that matches events against these particular canaries and emits log data
for them to a UNIX pipe that the alerting software can constantly read from.</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">formats</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">canaryformat</span>
  <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;%&lt;chi&gt; - %&lt;caun&gt; [%&lt;cqtn&gt;] &quot;%&lt;cqtx&gt;&quot; %&lt;pssc&gt; %&lt;pscl&gt;&#39;</span>

<span class="n">filters</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">canaryfilter</span>
  <span class="n">accept</span><span class="p">:</span> <span class="n">cqup</span> <span class="n">MATCH</span> <span class="s2">&quot;/nightmare/scenario/dont/touch&quot;</span>

<span class="n">logs</span><span class="p">:</span>
<span class="o">-</span> <span class="n">mode</span><span class="p">:</span> <span class="n">ascii_pipe</span>
  <span class="nb">format</span><span class="p">:</span> <span class="n">canaryformat</span>
  <span class="n">filters</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">canaryfilter</span>
  <span class="n">filename</span><span class="p">:</span> <span class="n">alerting_canaries</span>
</pre></div>
</div>
</div>
<div class="section" id="configuring-ascii-pipe-buffer-size">
<h2>Configuring ASCII Pipe Buffer Size<a class="headerlink" href="#configuring-ascii-pipe-buffer-size" title="Permalink to this headline">¶</a></h2>
<p>This example mirrors the one above but also sets a <code class="docutils literal notranslate"><span class="pre">`pipe_buffer_size`</span></code> of
1024 * 1024 for the pipe. This can be set on a per-pipe basis but is only
available on Linux (later than 2.6.35). If this field is not set, the pipe buffer
will default to the OS default size.</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">logs</span><span class="p">:</span>
<span class="o">-</span> <span class="n">mode</span><span class="p">:</span> <span class="n">ascii_pipe</span>
  <span class="nb">format</span><span class="p">:</span> <span class="n">canaryformat</span>
  <span class="n">filters</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">canaryfilter</span>
  <span class="n">filename</span><span class="p">:</span> <span class="n">alerting_canaries</span>
  <span class="n">pipe_buffer_size</span><span class="p">:</span> <span class="mi">1048576</span>
</pre></div>
</div>
</div>
<div class="section" id="summarizing-origin-responses-by-hour">
<h2>Summarizing Origin Responses by Hour<a class="headerlink" href="#summarizing-origin-responses-by-hour" title="Permalink to this headline">¶</a></h2>
<p>This example demonstrates a simple use of aggregation operators to produce an
hourly event line reporting on the total number of requests made to origin
servers (where we assume that any cache result code without the string <code class="docutils literal notranslate"><span class="pre">HIT</span></code>
in it signals origin access), as well as the average time it took to fulfill
the request to clients during that hour.</p>
<div class="code yaml highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">logging</span><span class="p">:</span>
  <span class="n">formats</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">originrepformat</span>
    <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;%&lt;FIRST(cqtq)&gt; %&lt;COUNT(*)&gt; %&lt;AVG(ttms)&gt;&#39;</span>
    <span class="n">interval</span><span class="p">:</span> <span class="mi">3600</span>

  <span class="n">filters</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">originfilter</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">reject</span>
    <span class="n">condition</span><span class="p">:</span> <span class="n">crc</span> <span class="n">CONTAINS</span> <span class="s2">&quot;HIT&quot;</span>

  <span class="n">logs</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">mode</span><span class="p">:</span> <span class="n">ascii</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">originrepformat</span>
    <span class="n">filters</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">originfilter</span>
    <span class="n">filename</span><span class="p">:</span> <span class="n">origin_access_summary</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../monitoring/index.en.html" class="btn btn-neutral float-right" title="Monitoring" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="filters.en.html" class="btn btn-neutral float-left" title="Log Filters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, dev@trafficserver.apache.org

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>
 


</body>
</html>