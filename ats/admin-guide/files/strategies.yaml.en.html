


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>strategies.yaml &mdash; Apache Traffic Server 10.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/override.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="volume.config" href="volume.config.en.html" />
    <link rel="prev" title="storage.config" href="storage.config.en.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Apache Traffic Server
          

          
            
            <img src="../../_static/trans_logo_tm_380x69.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.en.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.en.html">Installing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.en.html">Proxy Cache Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interaction/index.en.html">Interacting with Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.en.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.en.html">Cache Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.en.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.en.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.en.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuring-traffic-server.en.html">Configuring Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layer-4-routing.en.html">Layer 4 Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/index.en.html">Performance Tuning</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.en.html">Configuration Files</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cache.config.en.html">cache.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="hosting.config.en.html">hosting.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="ip_allow.yaml.en.html">ip_allow.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="logging.yaml.en.html">logging.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="parent.config.en.html">parent.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="plugin.config.en.html">plugin.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="records.config.en.html">records.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="remap.config.en.html">remap.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="splitdns.config.en.html">splitdns.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="ssl_multicert.config.en.html">ssl_multicert.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="sni.yaml.en.html">sni.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="storage.config.en.html">storage.config</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">strategies.yaml</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#format">Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hosts-definitions">Hosts definitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#groups-definitions">Groups definitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#strategies-definitions">Strategies definitions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="volume.config.en.html">volume.config</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../jsonrpc/index.en.html">JSONRPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.en.html#audience">Audience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-guide/index.en.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/index.en.html">Appendices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apache Traffic Server</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.en.html">Administrator’s Guide</a> &raquo;</li>
        
          <li><a href="index.en.html">Configuration Files</a> &raquo;</li>
        
      <li>strategies.yaml</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/admin-guide/files/strategies.yaml.en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="strategies-yaml">
<h1>strategies.yaml<a class="headerlink" href="#strategies-yaml" title="Permalink to this headline">¶</a></h1>
<span class="target" id="std-configfile-strategies.yaml"><span id="std:configfile-strategies.yaml"></span></span><p>The <a class="reference internal" href="#std-configfile-strategies.yaml"><code class="xref std std-file docutils literal notranslate"><span class="pre">strategies.yaml</span></code></a> file identifies the next hop proxies used in an
cache hierarchy and the algorithms used to select the next hop proxy. Use
this file to perform the following configuration:</p>
<ul class="simple">
<li><p>Set up next hop cache hierarchies, with multiple parents and parent
failover</p></li>
</ul>
<p>Traffic Server uses the <a class="reference internal" href="#std-configfile-strategies.yaml"><code class="xref std std-file docutils literal notranslate"><span class="pre">strategies.yaml</span></code></a> file only when one or more
remap lines in remap.config specifies the use of a strategy with the &#64;strategy tag.
remap.config Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">com</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">bar</span><span class="o">.</span><span class="n">com</span> <span class="nd">@strategy</span><span class="o">=</span><span class="s1">&#39;mid-tier-north&#39;</span>
</pre></div>
</div>
<p>After you modify the <a class="reference internal" href="#std-configfile-strategies.yaml"><code class="xref std std-file docutils literal notranslate"><span class="pre">strategies.yaml</span></code></a> file, run the <a class="reference internal" href="../../appendices/command-line/traffic_ctl_jsonrpc.en.html#cmdoption-traffic_ctl-config-arg-reload"><code class="xref std std-option docutils literal notranslate"><span class="pre">traffic_ctl</span> <span class="pre">config</span> <span class="pre">reload</span></code></a>
command to apply your changes.</p>
<div class="section" id="format">
<h2>Format<a class="headerlink" href="#format" title="Permalink to this headline">¶</a></h2>
<p>The <cite>strategies.yaml</cite> is a YAML document with three top level namespaces: <strong>hosts</strong>, <strong>groups</strong>
and <strong>strategies</strong>.  These name spaces may be in separate files.  When in separate files, use
<strong>#include filename</strong> in the <cite>strategies.yaml</cite> so that they are concatenated by the strategy
factory into a single YAML document in the order, <strong>hosts</strong>, <strong>groups</strong>, and the <strong>strategies</strong>.</p>
<p>Alternatively if the config parameter <cite>proxy.config.url_remap.strategies.filename</cite> refers to
a directory, the NextHopStrategyFactory will alphanumerically concatenate all files in that directory that end in <cite>.yaml</cite> by name into a single document stream for parsing.  The final document must be a valid <cite>YAML</cite> document with single <cite>strategies</cite> node and optionally a single <cite>hosts</cite> and <cite>groups</cite> node.  Any <strong>#include filename</strong> strings are ignored when reading <cite>.yaml</cite> files in a directory.</p>
</div>
<div class="section" id="hosts-definitions">
<h2>Hosts definitions<a class="headerlink" href="#hosts-definitions" title="Permalink to this headline">¶</a></h2>
<p>The <strong>hosts</strong> definitions is a <strong>YAML</strong> list of hosts.  This list is <strong>optional</strong> but if not used, the
<strong>groups</strong> list <strong>must</strong> include complete definitions for hosts.  See the <strong>group</strong> examples below.</p>
<p>In the example below, <strong>hosts</strong> is a <strong>YAML</strong> list of hosts.  Each host entry  uses a <strong>YAML</strong> anchor,
<strong>&amp;p1</strong> and <strong>&amp;p2</strong> that may be used elsewhere in the <strong>YAML</strong> document to refer to hosts <strong>p1</strong> and <strong>p2</strong>.</p>
<ul class="simple">
<li><p><strong>host</strong>: the host value is a hostname string</p></li>
<li><p><strong>protocol</strong>: a list of schemes, ports, and health check urls for  the host.</p></li>
<li><p><strong>healthcheck</strong>: health check information with the <strong>url</strong> used to check
the hosts health by some external health check agent.</p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hosts</span><span class="p">:</span>
  <span class="o">-</span> <span class="o">&amp;</span><span class="n">p1</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">p1</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">com</span>
    <span class="n">protocol</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">http</span>
        <span class="n">port</span><span class="p">:</span> <span class="mi">80</span>
        <span class="n">health_check_url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span><span class="mi">80</span>
      <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">https</span>
        <span class="n">port</span><span class="p">:</span> <span class="mi">443</span>
        <span class="n">health_check_url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span><span class="mi">443</span>
  <span class="o">-</span> <span class="o">&amp;</span><span class="n">p2</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">p2</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">com</span>
    <span class="n">protocol</span><span class="p">:</span>
      <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">http</span>
        <span class="n">port</span><span class="p">:</span> <span class="mi">80</span>
        <span class="n">health_check_url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span><span class="p">:</span><span class="mi">80</span>
</pre></div>
</div>
</div>
<div class="section" id="groups-definitions">
<h2>Groups definitions<a class="headerlink" href="#groups-definitions" title="Permalink to this headline">¶</a></h2>
<p>The <strong>groups</strong> definitions is a <strong>YAML</strong> list of host groups.  host groups are used as the primary and secondary groups used by nexthop to choose hosts from.  The first group is the <strong>primary</strong> group next hop chooses hosts from.  The remaining groups are used failover.  The <strong>strategies</strong> <strong>policy</strong> specifies how the groups are used.</p>
<p>Below are examples of group definitions.  The first example is using <strong>YAML</strong> anchors and references.
When using <strong>references</strong>, the complete <strong>YAML</strong> document must include the <strong>anchors</strong> portion of the document first.</p>
<p>The second example shows a complete <strong>groups</strong> definition without the use of a <strong>hosts</strong> name space and it’s <strong>YAML</strong> anchors.</p>
<p>The field definitions in the examples below are defined in the <strong>hosts</strong> section.</p>
<p>Example using <strong>YAML</strong> anchors and references:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span><span class="p">:</span>
  <span class="o">-</span> <span class="o">&amp;</span><span class="n">g1</span>
    <span class="o">-</span> <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">p1</span>
      <span class="n">weight</span><span class="p">:</span> <span class="mf">1.5</span>
    <span class="o">-</span> <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">p2</span>
      <span class="n">weight</span><span class="p">:</span> <span class="mf">0.5</span>
  <span class="o">-</span> <span class="o">&amp;</span><span class="n">g2</span>
    <span class="o">-</span> <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">p3</span>
      <span class="n">weight</span><span class="p">:</span> <span class="mf">0.5</span>
    <span class="o">-</span> <span class="o">&lt;&lt;</span><span class="p">:</span> <span class="o">*</span><span class="n">p4</span>
      <span class="n">weight</span><span class="p">:</span> <span class="mf">1.5</span>
</pre></div>
</div>
<p>Explicitly defined Example, no <strong>YAML</strong> references:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span><span class="p">:</span>
  <span class="o">-</span> <span class="o">&amp;</span><span class="n">g1</span>
    <span class="o">-</span> <span class="n">host</span><span class="p">:</span> <span class="n">p1</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">com</span>
      <span class="n">protocol</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">http</span>
          <span class="n">port</span><span class="p">:</span> <span class="mi">80</span>
          <span class="n">health_check_url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span><span class="mi">80</span>
        <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">https</span>
          <span class="n">port</span><span class="p">:</span> <span class="mi">443</span>
          <span class="n">health_check_url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span><span class="p">:</span><span class="mi">443</span>
      <span class="n">weight</span><span class="p">:</span> <span class="mf">0.5</span>
    <span class="o">-</span> <span class="n">host</span><span class="p">:</span> <span class="n">p2</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">com</span>
      <span class="n">protocol</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">http</span>
          <span class="n">port</span><span class="p">:</span> <span class="mi">80</span>
          <span class="n">health_check_url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span><span class="p">:</span><span class="mi">80</span>
        <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">https</span>
          <span class="n">port</span><span class="p">:</span> <span class="mi">443</span>
          <span class="n">health_check_url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span><span class="p">:</span><span class="mi">443</span>
      <span class="n">weight</span><span class="p">:</span> <span class="mf">0.5</span>
  <span class="o">-</span> <span class="o">&amp;</span><span class="n">g2</span>
    <span class="o">-</span> <span class="n">host</span><span class="p">:</span> <span class="n">p3</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">com</span>
      <span class="n">protocol</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">http</span>
          <span class="n">port</span><span class="p">:</span> <span class="mi">80</span>
          <span class="n">health_check_url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.3</span><span class="p">:</span><span class="mi">80</span>
        <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">https</span>
          <span class="n">port</span><span class="p">:</span> <span class="mi">443</span>
          <span class="n">health_check_url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.3</span><span class="p">:</span><span class="mi">443</span>
      <span class="n">weight</span><span class="p">:</span> <span class="mf">0.5</span>
    <span class="o">-</span> <span class="n">host</span><span class="p">:</span> <span class="n">p4</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">com</span>
      <span class="n">protocol</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">http</span>
          <span class="n">port</span><span class="p">:</span> <span class="mi">80</span>
          <span class="n">health_check_url</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.4</span><span class="p">:</span><span class="mi">80</span>
        <span class="o">-</span> <span class="n">scheme</span><span class="p">:</span> <span class="n">https</span>
          <span class="n">port</span><span class="p">:</span> <span class="mi">443</span>
          <span class="n">health_check_url</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">1.4</span><span class="p">:</span><span class="mi">443</span>
      <span class="n">weight</span><span class="p">:</span> <span class="mf">0.5</span>
</pre></div>
</div>
</div>
<div class="section" id="strategies-definitions">
<h2>Strategies definitions<a class="headerlink" href="#strategies-definitions" title="Permalink to this headline">¶</a></h2>
<p>The <strong>strategies</strong> namespace defines a <strong>YAML</strong> list of strategies that may be applied to a <strong>remap</strong>
entry using the <strong>&#64;strategy</strong> tag in remap.config.</p>
<p>Each <strong>strategy</strong> in the list may using the following parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="o">**</span><span class="n">strategy</span><span class="o">**</span><span class="p">:</span> <span class="n">The</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">strategy</span><span class="o">.</span>
<span class="o">-</span> <span class="o">**</span><span class="n">policy</span><span class="o">**</span><span class="p">:</span> <span class="n">The</span> <span class="n">algorithm</span> <span class="n">the</span> <span class="o">**</span><span class="n">strategy</span><span class="o">**</span> <span class="n">uses</span> <span class="n">to</span> <span class="n">select</span> <span class="n">hosts</span><span class="o">.</span> <span class="n">Currently</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span><span class="p">:</span>
</pre></div>
</div>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>rr_ip</strong>: round robin selection using the modulus of the client IP</p></li>
<li><p><strong>rr_strict</strong>: strict round robin over the list of hosts in the primary group.</p></li>
<li><p><strong>first_live</strong>: always selects the first host in the primary group.  Other hosts are selected when the first host fails.</p></li>
<li><p><strong>latched</strong>:  Same as <strong>first_live</strong> but primary selection sticks to whatever host was used by a previous transaction.</p></li>
<li><p><strong>consistent_hash</strong>: hosts are selected using a <strong>hash_key</strong>.</p></li>
</ol>
</div></blockquote>
<ul>
<li><p><strong>hash_key</strong>: The hashing key used by the <strong>consistent_hash</strong> policy. If not specified, defaults to <strong>path</strong> which is the
same policy used in the <strong>parent.config</strong> implementation. Use one of:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>hostname</strong>: Creates a hash using the <strong>hostname</strong> in the request URL.</p></li>
<li><p><strong>path</strong>: (<strong>default</strong>) Creates a hash over the path portion of the request URL.</p></li>
<li><p><strong>path+query</strong>: Same as <strong>path</strong> but adds the <strong>query string</strong> in the request URL.</p></li>
<li><p><strong>path+fragment</strong>: Same as <strong>path</strong> but adds the fragment portion of the URL.</p></li>
<li><p><strong>cache_key</strong>: Uses the hash key from the <strong>cachekey</strong> plugin.  defaults to <strong>path</strong> if the <strong>cachekey</strong> plugin is not configured on the <strong>remap</strong>.</p></li>
<li><p><strong>url</strong>: Creates a hash from the entire request url.</p></li>
</ol>
</div></blockquote>
</li>
<li><p><strong>go_direct</strong> - A boolean value indicating whether a transaction may bypass proxies and go direct to the origin. Defaults to <strong>true</strong></p></li>
<li><p><strong>parent_is_proxy</strong>: A boolean value which indicates if the groups of hosts are proxy caches or origins.  <strong>true</strong> (default) means all the hosts used in the remap are Traffic Server caches.  <strong>false</strong> means the hosts are origins that the next hop strategies may use for load balancing and/or failover.</p></li>
<li><p><strong>cache_peer_result</strong> - A boolean value that is only used when the <strong>policy</strong> is ‘consistent_hash’ and a <strong>peering_ring</strong> mode is used for the strategy. When set to true, the default, all responses from upstream and peer endpoints are allowed to be cached.  Setting this to false will disable caching responses received from a peer host. Only responses from upstream origins or parents will be cached for this strategy.</p></li>
<li><p><strong>scheme</strong> Indicates which scheme the strategy supports, <em>http</em> or <em>https</em>
- <strong>failover</strong>: A map of <strong>failover</strong> information.
- <strong>max_simple_retries</strong>: Part of the <strong>failover</strong> map and is an integer value of the maximum number of retries for a <strong>simple retry</strong> on the list of indicated response codes.  <strong>simple retry</strong> is used to retry an upstream request using another upstream server if the response received on from the original upstream request matches any of the response codes configured for this strategy in the <strong>failover</strong> map.  If no failover response codes are configured, no <strong>simple retry</strong> is attempted.
- <strong>max_unavailable_retries Part of the **failover</strong> map and is an integer value of the maximum number of retries for a <strong>unavailable retry</strong> on the list of indicated markdown response codes.  <strong>unavailable retry</strong> is used to retry an upstream request using another upstream server if the response received on from the original upstream request matches any of the markdown response codes configured for this strategy in the <strong>failover</strong> map.  If no failover markdown response codes are configured, no <strong>unavailable retry</strong> is attempted.  <strong>unavailable retry</strong> differs from <strong>simple retry</strong> in that if a failover for retry is done, the previously retried server is marked down for rety.</p>
<ul class="simple">
<li><p><strong>ring_mode</strong>: Part of the <strong>failover</strong> map. The host ring selection mode.  Use either <strong>exhaust_ring</strong>,  <strong>alternate_ring</strong> or <strong>peering_ring</strong></p></li>
</ul>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>exhaust_ring</strong>: when a host normally selected by the policy fails, another host is selected from the same group.  A new group is not selected until all hosts on the previous group have been exhausted</p></li>
<li><p><strong>alternate_ring</strong>: retry hosts are selected from groups in an alternating group fashion.</p></li>
<li><p><strong>peering_ring</strong> This mode is only implemented for a policy of <strong>consistent_hash</strong> and requires that two host groups are defined. The first host group is a list of peer caches and “this” host itself, the second group is a list of upstream caches.  Parents are always selected from the peer list however, if the selected parent is “this” host itself a new parent from the upstream list is chosen.  In addition, if any peer host is unreachable or times out, a host from the upstream list is chosen for retries.</p></li>
</ol>
</div></blockquote>
<ul class="simple">
<li><p><strong>response_codes</strong>: Part of the <strong>failover</strong> map.  This is a list of <strong>http</strong> response codes that may be used for <strong>simple retry</strong>.</p></li>
<li><p><strong>markdown_codes</strong>: Part of the <strong>failover</strong> map.  This is a list of <strong>http</strong> response codes that may be used for <strong>unavailable retry</strong> which will cause a parent markdown.</p></li>
<li><p><strong>health_check</strong>: Part of the <strong>failover</strong> map.  A list of health checks. <strong>passive</strong> is the default and means that the state machine marks down <strong>hosts</strong> when a transaction timeout or connection error is detected.  <strong>passive</strong> is always used by the next hop strategies.  <strong>active</strong> means that some external process may actively health check the hosts using the defined <strong>health check url</strong> and mark them down using <strong>traffic_ctl</strong>.</p></li>
</ul>
</li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include unit-tests/hosts.yaml</span>
<span class="c1">#</span>
<span class="n">strategies</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">strategy</span><span class="p">:</span> <span class="s1">&#39;strategy-1&#39;</span>
    <span class="n">policy</span><span class="p">:</span> <span class="n">consistent_hash</span>
    <span class="n">hash_key</span><span class="p">:</span> <span class="n">cache_key</span>
    <span class="n">go_direct</span><span class="p">:</span> <span class="n">false</span>
    <span class="n">groups</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">*</span><span class="n">g1</span>
      <span class="o">-</span> <span class="o">*</span><span class="n">g2</span>
    <span class="n">scheme</span> <span class="n">http</span>
    <span class="n">failover</span><span class="p">:</span>
      <span class="n">ring_mode</span><span class="p">:</span> <span class="n">exhaust_ring</span>
      <span class="n">response_codes</span><span class="p">:</span>
        <span class="o">-</span> <span class="mi">404</span>
      <span class="n">markdown_codes</span><span class="p">:</span>
        <span class="o">-</span> <span class="mi">503</span>
      <span class="n">health_check</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">passive</span>
  <span class="o">-</span> <span class="n">strategy</span><span class="p">:</span> <span class="s1">&#39;strategy-2&#39;</span>
    <span class="n">policy</span><span class="p">:</span> <span class="n">rr_strict</span>
    <span class="n">hash_key</span><span class="p">:</span> <span class="n">cache_key</span>
    <span class="n">go_direct</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">groups</span><span class="p">:</span>
      <span class="o">-</span> <span class="o">*</span><span class="n">g1</span>
      <span class="o">-</span> <span class="o">*</span><span class="n">g2</span>
    <span class="n">scheme</span> <span class="n">http</span>
    <span class="n">failover</span><span class="p">:</span>
      <span class="n">ring_mode</span><span class="p">:</span> <span class="n">exhaust_ring</span>
      <span class="n">response_codes</span><span class="p">:</span>
        <span class="o">-</span> <span class="mi">404</span>
      <span class="n">markdown_codes</span><span class="p">:</span>
        <span class="o">-</span> <span class="mi">503</span>
      <span class="n">health_check</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">passive</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="volume.config.en.html" class="btn btn-neutral float-right" title="volume.config" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="storage.config.en.html" class="btn btn-neutral float-left" title="storage.config" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, dev@trafficserver.apache.org

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>
 


</body>
</html>