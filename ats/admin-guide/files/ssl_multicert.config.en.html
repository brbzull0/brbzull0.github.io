

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ssl_multicert.config &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/override.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="sni.yaml" href="sni.yaml.en.html" />
    <link rel="prev" title="splitdns.config" href="splitdns.config.en.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="ssl-multicert-config">
<h1>ssl_multicert.config<a class="headerlink" href="#ssl-multicert-config" title="Permalink to this headline">¶</a></h1>
<p id="std:configfile-ssl_multicert.config">The <a class="reference internal" href="#std:configfile-ssl_multicert.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">ssl_multicert.config</span></code></a> file lets you configure Traffic
Server to use multiple SSL server certificates to terminate the SSL
sessions. If you have a Traffic Server system with more than one
IP address assigned to it, then you can assign a different SSL
certificate to be served when a client requests a particular IP
address or host name.</p>
<p>At configuration time, certificates are parsed to extract the
certificate subject and all the DNS <a class="reference external" href="http://en.wikipedia.org/wiki/SubjectAltName">subject alternative names</a>.  A certificate
will be presented for connections requesting any of the hostnames
found in the certificate. Wildcard names are supported, but only
of the form <cite>*.domain.com</cite>, ie. where <cite>*</cite> is the leftmost domain
component.</p>
<p>Changes to <a class="reference internal" href="#std:configfile-ssl_multicert.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">ssl_multicert.config</span></code></a> can be applied to a running
Traffic Server using <a class="reference internal" href="../../appendices/command-line/traffic_ctl.en.html#cmdoption-traffic-ctl-config-arg-reload"><code class="xref std std-option docutils literal notranslate"><span class="pre">traffic_ctl</span> <span class="pre">config</span> <span class="pre">reload</span></code></a>.</p>
<div class="section" id="format">
<h2>Format<a class="headerlink" href="#format" title="Permalink to this headline">¶</a></h2>
<p>Each <a class="reference internal" href="#std:configfile-ssl_multicert.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">ssl_multicert.config</span></code></a> line consists of a sequence of
<cite>key=value</cite> fields that specify how Traffic Server should use a
particular SSL certificate.</p>
<dl class="docutils">
<dt>ssl_cert_name=FILENAME[,FILENAME …]</dt>
<dd><p class="first">The name of the file containing the TLS certificate. <em>FILENAME</em>
is located relative to the directory specified by the
<a class="reference internal" href="records.config.en.html#proxy-config-ssl-server-cert-path" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.ssl.server.cert.path</span></code></a> configuration variable.
It may also include the intermediate CA certificates, sorted from
leaf to root.  At a minimum, the file must include a leaf
certificate.</p>
<p>When running with OpenSSL 1.0.2 or later, this directive can be
used to configure the intermediate CA chain on a per-certificate
basis.  Multiple chain files are separated by comma character.
For example, it is possible able to configure a ECDSA certificate
chain and a RSA certificate chain and serve them simultaneously,
allowing OpenSSL to determine which certificate would be used
when the TLS session cipher suites are negotiated.  Note that the
leaf certs in <cite>FILENAME1</cite> and <cite>FILENAME2</cite> must have the same
subjects and alternate names. The first certificate is used to
to match the client’s SNI request.</p>
<p>You can also configure multiple leaf certificates in a same chain
with OpenSSL 1.0.1.</p>
<p class="last">This is the only field that is required to be present.</p>
</dd>
<dt>dest_ip=ADDRESS (optional)</dt>
<dd>The IP (v4 or v6) address that the certificate should be presented
on. This is now only used as a fallback in the case that the TLS
ServerNameIndication extension is not supported. If <em>ADDRESS</em> is
<cite>*</cite>, the corresponding certificate will be used as the global
default fallback if no other match can be made. The address may
contain a port specifier, in which case the corresponding certificate
will only match for connections accepted on the specified port.
IPv6 addresses must be enclosed by square brackets if they have
a port, eg, [::1]:80. Care should be taken to make each ADDRESS unique.</dd>
<dt>ssl_key_name=FILENAME (optional)</dt>
<dd>The name of the file containing the private key for this certificate.
If the key is contained in the certificate file, this field can
be omitted, otherwise <em>FILENAME</em> is resolved relative to the
<a class="reference internal" href="records.config.en.html#proxy-config-ssl-server-private-key-path" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.ssl.server.private_key.path</span></code></a> configuration variable.</dd>
<dt>ssl_ca_name=FILENAME (optional)</dt>
<dd>If the certificate is issued by an authority that is not in the
system CA bundle, additional certificates may be needed to validate
the certificate chain. <em>FILENAME</em> is resolved relative to the
<a class="reference internal" href="records.config.en.html#proxy-config-ssl-ca-cert-path" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.ssl.CA.cert.path</span></code></a> configuration variable.</dd>
<dt>ssl_ocsp_name=FILENAME (optional)</dt>
<dd>The name of the file containing the prefetched OCSP stapling response
for this certificate. This field can be omitted to let trafficserver
fetch OCSP responses dynamically. Otherwise, when included, the administrator is
responsible for updating the file’s content. <em>FILENAME</em> is resolved
relative to the <a class="reference internal" href="records.config.en.html#proxy-config-ssl-ocsp-response-path" title="records.config"><code class="xref ts ts-cv docutils literal notranslate"><span class="pre">proxy.config.ssl.ocsp.response.path</span></code></a>
configuration variable.</dd>
<dt>ssl_ticket_enabled=1|0 (optional)</dt>
<dd>Enable <a class="reference external" href="https://tools.ietf.org/html/rfc5077.html">RFC 5077</a> stateless TLS session tickets. To support this,
OpenSSL should be upgraded to version 0.9.8f or higher. This
option must be set to <cite>0</cite> to disable session ticket support.</dd>
<dt>ssl_ticket_number=INTEGER (optional)</dt>
<dd>Specifies the number of TLSv1.3 session tickets that are issued.
This defaults to 2 (the OpenSSL default)</dd>
<dt>ssl_key_dialog=builtin|”exec:/path/to/program [args]” (optional)</dt>
<dd><p class="first">Method used to provide a pass phrase for encrypted private keys.  If the
pass phrase is incorrect, SSL negotiation for this dest_ip will fail for
clients who attempt to connect.
Two options are supported: builtin and exec:</p>
<blockquote class="last">
<div><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builtin</span></code> - Requests pass phrase via stdin/stdout. User will be</dt>
<dd>provided the ssl_cert_name and be prompted for the pass phrase.
Useful for debugging.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">exec:</span></code> - Executes program /path/to/program and passes args, if</dt>
<dd>specified, to the program and reads the output from stdout for
the pass phrase.  If args are provided then the entire exec: string
must be quoted with “” (see examples).  Arguments with white space
are supported by single quoting (‘).  The intent is that this
program runs a security check to ensure that the system is not
compromised by an attacker before providing the pass phrase.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</div>
<div class="section" id="certificate-selection">
<h2>Certificate Selection<a class="headerlink" href="#certificate-selection" title="Permalink to this headline">¶</a></h2>
<p>Traffic Server attempts two certificate selections during SSL
connection setup. An initial selection is made when a TCP connection
is accepted. This selection examines the IP address and port that
the client is connecting to and chooses the best certificate from
the those that have a <code class="docutils literal notranslate"><span class="pre">dest_ip</span></code> specification. If no matching
certificates are found, a default certificate is chosen.  The final
certificate selection is made during the SSL handshake.  At this
point, the client may use <a class="reference external" href="http://en.wikipedia.org/wiki/Server_Name_Indication">Server Name Indication</a> to request
a specific hostname. Traffic Server will use this request to select
a certificate with a matching subject or subject alternative name.
Failing that, a wildcard certificate match is attempted. If no match
can be made, the initial certificate selection remains in force.</p>
<p>In all cases, Traffic Server attempts to select the most specific
match. An address specification that contains a port number will
take precedence over a specification that does not contain a port
number. A specific certificate subject will take precedence over a
wildcard certificate. In the case of multiple matching certificates
the first match will be returned to non-SNI capable clients.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>The following example configures Traffic Server to use the SSL
certificate <code class="docutils literal notranslate"><span class="pre">server.pem</span></code> for all requests to the IP address
111.11.11.1 and the SSL certificate <code class="docutils literal notranslate"><span class="pre">server1.pem</span></code> for all requests
to the IP address 11.1.1.1. Connections from all other IP addresses
are terminated with the <code class="docutils literal notranslate"><span class="pre">default.pem</span></code> certificate.
Since the private key is included in the certificate files, no
private key name is specified.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dest_ip</span><span class="o">=</span><span class="mf">111.11</span><span class="o">.</span><span class="mf">11.1</span> <span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">server</span><span class="o">.</span><span class="n">pem</span>
<span class="n">dest_ip</span><span class="o">=</span><span class="mf">11.1</span><span class="o">.</span><span class="mf">1.1</span> <span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">server1</span><span class="o">.</span><span class="n">pem</span>
<span class="n">dest_ip</span><span class="o">=*</span> <span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">default</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p>The following example configures Traffic Server to use the ECDSA
certificate chain <code class="docutils literal notranslate"><span class="pre">ecdsa.pem</span></code> or RSA certificate chain <code class="docutils literal notranslate"><span class="pre">rsa.pem</span></code>
for all requests.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dest_ip</span><span class="o">=*</span> <span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">ecdsa</span><span class="o">.</span><span class="n">pem</span><span class="p">,</span><span class="n">rsa</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p>The following example configures Traffic Server to use the ECDSA
certificate chain <code class="docutils literal notranslate"><span class="pre">ecdsa.pem</span></code> or RSA certificate chain <code class="docutils literal notranslate"><span class="pre">rsa.pem</span></code>
for all requests, the public key and private key are in separate PEM files.
Note that the number of files in ssl_key_name must match the files in ssl_cert_name,
and they should be presented in the same order.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dest_ip</span><span class="o">=*</span> <span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">ecdsa_pub</span><span class="o">.</span><span class="n">pem</span><span class="p">,</span><span class="n">rsa_pub</span><span class="o">.</span><span class="n">pem</span> <span class="n">ssl_key_name</span><span class="o">=</span><span class="n">ecdsa_private</span><span class="o">.</span><span class="n">pem</span><span class="p">,</span><span class="n">rsa_private</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p>The following example configures Traffic Server to use the SSL
certificate <code class="docutils literal notranslate"><span class="pre">server.pem</span></code> and the private key <code class="docutils literal notranslate"><span class="pre">serverKey.pem</span></code>
for all requests to port 8443 on IP address 111.11.11.1. The
<code class="docutils literal notranslate"><span class="pre">general.pem</span></code> certificate is used for server name matches.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dest_ip</span><span class="o">=</span><span class="mf">111.11</span><span class="o">.</span><span class="mf">11.1</span><span class="p">:</span><span class="mi">8443</span> <span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">server</span><span class="o">.</span><span class="n">pem</span> <span class="n">ssl_key_name</span><span class="o">=</span><span class="n">serverKey</span><span class="o">.</span><span class="n">pem</span> <span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">general</span><span class="o">.</span><span class="n">pem</span>
</pre></div>
</div>
<p>The following example configures Traffic Server to use the SSL
certificate <code class="docutils literal notranslate"><span class="pre">server.pem</span></code> for all requests to the IP address
111.11.11.1. Session tickets are enabled with a persistent ticket
key.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dest_ip</span><span class="o">=</span><span class="mf">111.11</span><span class="o">.</span><span class="mf">11.1</span> <span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">server</span><span class="o">.</span><span class="n">pem</span> <span class="n">ssl_ticket_enabled</span><span class="o">=</span><span class="mi">1</span> <span class="n">ticket_key_name</span><span class="o">=</span><span class="n">ticket</span><span class="o">.</span><span class="n">key</span>
</pre></div>
</div>
<p>The following example configures Traffic Server to use the SSL
certificate <code class="docutils literal notranslate"><span class="pre">server.pem</span></code> and disable session tickets for all
requests to the IP address 111.11.11.1.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dest_ip</span><span class="o">=</span><span class="mf">111.11</span><span class="o">.</span><span class="mf">11.1</span> <span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">server</span><span class="o">.</span><span class="n">pem</span> <span class="n">ssl_ticket_enabled</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>The following examples configure Traffic Server to use the SSL
certificate <code class="docutils literal notranslate"><span class="pre">server.pem</span></code> which includes an encrypted private key.
The external program /usr/bin/mypass will be called on startup with one
parameter (foo) in the first example, and with two parameters (foo)
and (ba r) in the second example, the program (mypass) will return the
pass phrase to decrypt the keys.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">server1</span><span class="o">.</span><span class="n">pem</span> <span class="n">ssl_key_dialog</span><span class="o">=</span><span class="s2">&quot;exec:/usr/bin/mypass foo&quot;</span>
<span class="n">ssl_cert_name</span><span class="o">=</span><span class="n">server2</span><span class="o">.</span><span class="n">pem</span> <span class="n">ssl_key_dialog</span><span class="o">=</span><span class="s2">&quot;exec:/usr/bin/mypass foo &#39;ba r&#39;&quot;</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.en.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.en.html">Installing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.en.html">Proxy Cache Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interaction/index.en.html">Interacting with Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.en.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.en.html">Cache Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.en.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.en.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.en.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuring-traffic-server.en.html">Configuring Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layer-4-routing.en.html">Layer 4 Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/index.en.html">Performance Tuning</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.en.html">Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jsonrpc/index.en.html">JSONRPC API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.en.html#audience">Audience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-guide/index.en.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.en.html">Administrator’s Guide</a><ul>
  <li><a href="index.en.html">Configuration Files</a><ul>
      <li>Previous: <a href="splitdns.config.en.html" title="previous chapter">splitdns.config</a></li>
      <li>Next: <a href="sni.yaml.en.html" title="next chapter">sni.yaml</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/files/ssl_multicert.config.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>