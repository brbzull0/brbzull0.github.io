


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Regex Remap Plugin &mdash; Apache Traffic Server 10.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/override.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Regex Revalidate Plugin" href="regex_revalidate.en.html" />
    <link rel="prev" title="Lua Plugin" href="lua.en.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Apache Traffic Server
          

          
            
            <img src="../../_static/trans_logo_tm_380x69.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.en.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.en.html">Installing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.en.html">Proxy Cache Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interaction/index.en.html">Interacting with Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.en.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.en.html">Cache Storage</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.en.html">Plugins</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.en.html#overview">Overview</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.en.html#stable-plugins">Stable plugins</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="s3_auth.en.html">AWS S3 Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="authproxy.en.html">AuthProxy</a></li>
<li class="toctree-l4"><a class="reference internal" href="background_fetch.en.html">Background Fetch</a></li>
<li class="toctree-l4"><a class="reference internal" href="cachekey.en.html">Cache Key Manipulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache_promote.en.html">Cache Promotion Policies</a></li>
<li class="toctree-l4"><a class="reference internal" href="cache_range_requests.en.html">Cache Range Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="combo_handler.en.html">Combo Handler</a></li>
<li class="toctree-l4"><a class="reference internal" href="conf_remap.en.html">Configuration Remap</a></li>
<li class="toctree-l4"><a class="reference internal" href="cookie_remap.en.html">Cookie Remap</a></li>
<li class="toctree-l4"><a class="reference internal" href="esi.en.html">ESI</a></li>
<li class="toctree-l4"><a class="reference internal" href="escalate.en.html">Escalate</a></li>
<li class="toctree-l4"><a class="reference internal" href="compress.en.html">Compress</a></li>
<li class="toctree-l4"><a class="reference internal" href="generator.en.html">Generator</a></li>
<li class="toctree-l4"><a class="reference internal" href="header_rewrite.en.html">Header Rewrite</a></li>
<li class="toctree-l4"><a class="reference internal" href="healthchecks.en.html">Health Checks</a></li>
<li class="toctree-l4"><a class="reference internal" href="lua.en.html">Lua</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Regex Remap</a></li>
<li class="toctree-l4"><a class="reference internal" href="regex_revalidate.en.html">Regex Revalidate</a></li>
<li class="toctree-l4"><a class="reference internal" href="remap_purge.en.html">Remap Purge</a></li>
<li class="toctree-l4"><a class="reference internal" href="stats_over_http.en.html">Stats over HTTP</a></li>
<li class="toctree-l4"><a class="reference internal" href="tcpinfo.en.html">TCPInfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="xdebug.en.html">XDebug</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.en.html#experimental-plugins">Experimental plugins</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.en.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.en.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuring-traffic-server.en.html">Configuring Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layer-4-routing.en.html">Layer 4 Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/index.en.html">Performance Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../files/index.en.html">Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.en.html#audience">Audience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-guide/index.en.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/index.en.html">Appendices</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Apache Traffic Server</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.en.html">Administrator’s Guide</a> &raquo;</li>
        
          <li><a href="index.en.html">Plugins</a> &raquo;</li>
        
      <li>Regex Remap Plugin</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/admin-guide/plugins/regex_remap.en.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="regex-remap-plugin">
<span id="admin-plugins-regex-remap"></span><h1>Regex Remap Plugin<a class="headerlink" href="#regex-remap-plugin" title="Permalink to this headline">¶</a></h1>
<p>This allows you to configure mapping rules based on regular expressions.
This is similar to what you can accomplish using mod_rewrite in Apache
httpd, but obviously not as flexible or sophisticated (yet).</p>
<p>To use this plugin, configure a remap.config rule like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">map</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">a</span><span class="o">.</span><span class="n">com</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">b</span><span class="o">.</span><span class="n">com</span> <span class="nd">@plugin</span><span class="o">=</span><span class="n">regex_remap</span><span class="o">.</span><span class="n">so</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">maps</span><span class="o">.</span><span class="n">reg</span>
</pre></div>
</div>
<p>The file name parameter is always required. Unless an absolute path
is specified, the file name is assumed to be a path relative to the
Traffic Server configuration directory.</p>
<p>The regular expressions listed in the configuration file are evaluated
sequentially. When a regular expression is positively matched against
a request URL, evaluation is stopped and the rewrite rule is applied.
If none of the regular expressions are a match, the default destination
URL is applied (<code class="docutils literal notranslate"><span class="pre">http://b.com</span></code> in the example above).</p>
<p>An optional argument (<code class="docutils literal notranslate"><span class="pre">&#64;pparam</span></code>) with the string “<code class="docutils literal notranslate"><span class="pre">profile</span></code>” will
enable profiling of this regex remap rule, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">maps</span><span class="o">.</span><span class="n">reg</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">profile</span>
</pre></div>
</div>
<p>Profiling is very low overhead, and the information is dumped to
<code class="docutils literal notranslate"><span class="pre">traffic.out</span></code>, located in the log directory. This information is
useful to optimize the order of your regular expression, such that the
most common matches appears early in the file. In order to force a
profile dump, you can do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo touch remap.config
$ sudo traffic_ctl config reload
</pre></div>
</div>
<p>By default, this plugin operates on the post-remap URL (including any
remappings done by preceding plugins in the remap rule).  This behavior
can be modified with the optional parameter</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pparam</span><span class="o">=</span><span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="p">]</span><span class="n">pristine</span>            <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">off</span><span class="p">]</span>
</pre></div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">&#64;pparam=pristine</span></code>, the plugin will operate on the pre-remap, or
pristine, URL.  (But, if no regular expression in the config file is
matched, the resulting URL will still be the post-remap URL.)</p>
<p>By default, only the path and query string of the URL are provided for
the regular expressions to match. The following optional parameters can
be used to modify the plugin instance behavior</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@pparam</span><span class="o">=</span><span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="p">]</span><span class="n">method</span>              <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">off</span><span class="p">]</span>
<span class="nd">@pparam</span><span class="o">=</span><span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="p">]</span><span class="n">query</span><span class="o">-</span><span class="n">string</span>        <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">on</span><span class="p">]</span>
<span class="nd">@pparam</span><span class="o">=</span><span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="p">]</span><span class="n">matrix</span><span class="o">-</span><span class="n">parameters</span>   <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">off</span><span class="p">]</span>
<span class="nd">@pparam</span><span class="o">=</span><span class="p">[</span><span class="n">no</span><span class="o">-</span><span class="p">]</span><span class="n">host</span>                <span class="p">[</span><span class="n">default</span><span class="p">:</span> <span class="n">off</span><span class="p">]</span>
</pre></div>
</div>
<p>If you wish to match on the HTTP method used (e.g. “<code class="docutils literal notranslate"><span class="pre">GET</span></code>“),
you must use the option <code class="docutils literal notranslate"><span class="pre">&#64;pparam=method</span></code>. e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">maps</span><span class="o">.</span><span class="n">reg</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">method</span>
</pre></div>
</div>
<p>With this enabled, the string that you will need to match will look
like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>GET/path?query=bar
</pre></div>
</div>
<p>The methods are always all upper-case, and always followed by one single
space. There is no space between the method and the rest of the URL (or
URI path).</p>
<p>By default, the query string is part of the string that is matched
again, to turn this off use the option ‘no-query-string’, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">maps</span><span class="o">.</span><span class="n">reg</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">no</span><span class="o">-</span><span class="n">query</span><span class="o">-</span><span class="n">string</span>
</pre></div>
</div>
<p>You can also include the matrix parameters in the string, using
the option ‘matrix-parameters’, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">maps</span><span class="o">.</span><span class="n">reg</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">matrix</span><span class="o">-</span><span class="n">parameters</span>
</pre></div>
</div>
<p>Finally, to match on the host as well, use the option ‘host’, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">maps</span><span class="o">.</span><span class="n">reg</span> <span class="nd">@pparam</span><span class="o">=</span><span class="n">host</span>
</pre></div>
</div>
<p>With this enabled, the string that you will need to match will look like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>//host/path?query=bar
</pre></div>
</div>
<p>A typical regex would look like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>^/(ogre.*)/more     http://www.ogre.com/$h/$0/$1
</pre></div>
</div>
<p>The regular expression must not contain any white spaces!</p>
<p>When the regular expression is matched, only the URL path + query string
is matched (without any of the optional configuration options). The path
will always start with a “/”. Various substitution strings are allowed
on the right hand side during evaluation</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$0     - The entire matched string
$1-9   - Regular expression groups ($1 first group etc.)
$h     - The host as used in the &quot;to&quot; portion of the remap rule. For a long time it was the original host header from the request.
$f     - The host as used in the &quot;from&quot; portion of the remap rule
$t     - The host as used in the &quot;to&quot; portion of the remap rule
$p     - The original port number
$s     - The scheme (e.g. http) of the request
$P     - The entire path of the request
$q     - The query part of the request
$r     - The path parameters of the request (not implemented yet)
$c     - The cookie string from the request
$i     - The client IP for this request
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">$0</span></code> substitution expands to the characters that were
matched by the regular expression, not to the entire string that
the regular expression was matched against.</p>
</div>
<p>You can also provide options, similar to how you configure your
remap.config. The following options are available</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>@status=&lt;nnn&gt;               - Force the response code to &lt;nnn&gt;
@active_timeout=&lt;nnn&gt;       - Active timeout (in ms)
@no_activity_timeout=&lt;nnn&gt;  - No activity timeout (in ms)
@connect_timeout=&lt;nnn&gt;      - Connect timeouts (in ms)
@dns_timeout=&lt;nnn&gt;          - Connect timeouts (in ms)

@overridable-config=&lt;value&gt; - see :ref:`ts-overridable-config`

@caseless                   - Make regular expressions case insensitive
@lowercase_substitutions    - Turn on (enable) lower case substitutions
</pre></div>
</div>
<p>This can be useful to force a particular response for some URLs, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">^/</span><span class="p">(</span><span class="n">ogre</span><span class="o">.*</span><span class="p">)</span><span class="o">/</span><span class="n">bad</span>      <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>  <span class="nd">@status</span><span class="o">=</span><span class="mi">404</span>
</pre></div>
</div>
<p>Or, to force a 302 redirect</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>^/oldurl/(.*)$      http://news.example.com/new/$1 @status=302
</pre></div>
</div>
<p>Setting the status to 301 or 302 will force the new URL to be used
as a redirect (Location:).</p>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="regex_revalidate.en.html" class="btn btn-neutral float-right" title="Regex Revalidate Plugin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="lua.en.html" class="btn btn-neutral float-left" title="Lua Plugin" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, dev@trafficserver.apache.org.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>
 


</body>
</html>