

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Traffic Dump Plugin &#8212; Apache Traffic Server 10.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/override.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Webp Transform Plugin" href="webp_transform.en.html" />
    <link rel="prev" title="System Stats Plugin" href="system_stats.en.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="traffic-dump-plugin">
<span id="admin-plugins-traffic-dump"></span><h1>Traffic Dump Plugin<a class="headerlink" href="#traffic-dump-plugin" title="Permalink to this headline">¶</a></h1>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Traffic</span> <span class="pre">Dump</span></code> captures traffic for a set of sampled sessions and records this traffic to replay files according to the <a class="reference external" href="https://github.com/apache/trafficserver/blob/master/tests/tools/traffic-replay/replay_schema.json">tests/tools/traffic-replay/replay_schema.json</a> schema. These replay files can be used to replay traffic for testing purposes. Further, since the traffic is written decrypted, they can be used to conveniently analyze HTTP traffic going through ATS.</p>
</div>
<div class="section" id="plugin-configuration">
<h2>Plugin Configuration<a class="headerlink" href="#plugin-configuration" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">traffic_dump.so</span></code></dt>
<dd><p class="first"><code class="docutils literal notranslate"><span class="pre">Traffic</span> <span class="pre">Dump</span></code> is a global plugin and is configured via <a class="reference internal" href="../files/plugin.config.en.html#std:configfile-plugin.config"><code class="xref std std-file docutils literal notranslate"><span class="pre">plugin.config</span></code></a>.</p>
<blockquote class="last">
<div><dl class="option">
<dt id="cmdoption-traffic-dump-so-logdir">
<code class="descname">--logdir</code><code class="descclassname"> &lt;path_to_dump&gt;</code><a class="headerlink" href="#cmdoption-traffic-dump-so-logdir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(<cite>required</cite>) - Specifies the directory for writing all dump files. If the path is relative it is considered relative to the Traffic Server directory. The plugin will use the first three characters of the client’s IP to create subdirs in an attempt to spread dumps evenly and avoid too many files in a single directory.</p>
<dl class="option">
<dt id="cmdoption-traffic-dump-so-sample">
<code class="descname">--sample</code><code class="descclassname"> &lt;N&gt;</code><a class="headerlink" href="#cmdoption-traffic-dump-so-sample" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(<cite>required</cite>) - Specifies the sampling ratio N. Traffic Dump will capture every one out of N sessions. This ratio can also be changed via <code class="docutils literal notranslate"><span class="pre">traffic_ctl</span></code> without restarting ATS.</p>
<dl class="option">
<dt id="cmdoption-traffic-dump-so-limit">
<code class="descname">--limit</code><code class="descclassname"> &lt;N&gt;</code><a class="headerlink" href="#cmdoption-traffic-dump-so-limit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(<cite>required</cite>) - Specifies the max disk usage to N bytes (approximate). Traffic Dump will stop capturing new sessions once disk usage exceeds this limit.</p>
<dl class="option">
<dt id="cmdoption-traffic-dump-so-sensitive-fields">
<code class="descname">--sensitive-fields</code><code class="descclassname"> &lt;field1,field2,...,fieldn&gt;</code><a class="headerlink" href="#cmdoption-traffic-dump-so-sensitive-fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(<cite>optional</cite>) - A comma separated list of HTTP case-insensitive field names whose values are considered sensitive information. Traffic Dump will not dump the incoming field values for any of these fields but will instead dump a generic value for them of the same length as the original. If this option is not used, a default list of “Cookie,Set-Cookie” is used. Providing this option overwrites that default list with whatever values the user provides. Pass a quoted empty string as the argument to specify that no fields are sensitive,</p>
<dl class="option">
<dt id="cmdoption-traffic-dump-so-sni-filter">
<code class="descname">--sni-filter</code><code class="descclassname"> &lt;SNI_Name&gt;</code><a class="headerlink" href="#cmdoption-traffic-dump-so-sni-filter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>(<cite>optional</cite>) - An SNI with which to filter sessions. Only HTTPS sessions with the provided SNI will be dumped. The sample option will apply a sampling rate to these filtered sessions. Thus, with a sample value of 2, 1/2 of all sessions with the specified SNI will be dumped.</p>
</div></blockquote>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">traffic_ctl</span></code> &lt;command&gt;</dt>
<dd><p class="first"><code class="docutils literal notranslate"><span class="pre">Traffic</span> <span class="pre">Dump</span></code> can be dynamically configured via <code class="docutils literal notranslate"><span class="pre">traffic_ctl</span></code>.</p>
<blockquote class="last">
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">traffic_ctl</span> <span class="pre">plugin</span> <span class="pre">msg</span> <span class="pre">traffic_dump.sample</span> <span class="pre">N</span></code> - changes the sampling ratio N as mentioned above.</li>
<li><code class="docutils literal notranslate"><span class="pre">traffic_ctl</span> <span class="pre">plugin</span> <span class="pre">msg</span> <span class="pre">traffic_dump.reset</span></code> - resets the disk usage counter.</li>
<li><code class="docutils literal notranslate"><span class="pre">traffic_ctl</span> <span class="pre">plugin</span> <span class="pre">msg</span> <span class="pre">traffic_dump.limit</span> <span class="pre">N</span></code> - changes the max disk usage to N bytes as mentioned above.</li>
</ul>
</div></blockquote>
</dd>
</dl>
</div>
<div class="section" id="replay-format">
<h2>Replay Format<a class="headerlink" href="#replay-format" title="Permalink to this headline">¶</a></h2>
<p>This replay files contain the following information:</p>
<ul class="simple">
<li>Each sampled session and all the transactions for those sessions.</li>
<li>Timestamps of each transaction.</li>
<li>The four sets of HTTP message headers (user agent request, proxy request, origin server response, proxy response).</li>
<li>The protocol stacks for the user agent and the origin server connections.</li>
<li>The number of body bytes for each message.</li>
</ul>
<p>For details, see the schema: <a class="reference external" href="https://github.com/apache/trafficserver/blob/master/tests/tools/lib/replay_schema.json">tests/tools/lib/replay_schema.json</a></p>
</div>
<div class="section" id="post-processing">
<h2>Post Processing<a class="headerlink" href="#post-processing" title="Permalink to this headline">¶</a></h2>
<p>Traffic Dump comes with a post processing script located at <a class="reference external" href="https://github.com/apache/trafficserver/blob/master/plugins/experimental/traffic_dump/post_process.py">plugins/experimental/traffic_dump/post_process.py</a>. This filters out incomplete sessions and transactions and merges a specifiable amount of sessions from a client into single replay files. It also optionally formats the single-line JSON files into a human readable format. It takes the following arguments:</p>
<ul class="simple">
<li>The first positional argument is the input directory containing the replay files captured by traffic_dump as described above.</li>
<li>The second positional argument is the output directory containing the processed replay files.</li>
<li><code class="docutils literal notranslate"><span class="pre">-n</span></code> is an optional argument specifying how many sessions will be attempted to be merged into single replay files. The default is 10.</li>
</ul>
<p>There are other options. Use <code class="docutils literal notranslate"><span class="pre">--help</span></code> for a description of these.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/trans_logo_tm_380x69.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../../index.html">Apache Traffic Server</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../preface/index.en.html">Preface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/index.en.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/index.en.html">Release Notes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.en.html">Administrator’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.en.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.en.html">Installing Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.en.html">Proxy Cache Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../interaction/index.en.html">Interacting with Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.en.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../storage/index.en.html">Cache Storage</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.en.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/index.en.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitoring/index.en.html">Monitoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuring-traffic-server.en.html">Configuring Traffic Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../layer-4-routing.en.html">Layer 4 Routing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/index.en.html">Performance Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../files/index.en.html">Configuration Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../jsonrpc/index.en.html">JSONRPC API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.en.html#audience">Audience</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer-guide/index.en.html">Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/index.en.html">Appendices</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.en.html">Administrator’s Guide</a><ul>
  <li><a href="index.en.html">Plugins</a><ul>
      <li>Previous: <a href="system_stats.en.html" title="previous chapter">System Stats Plugin</a></li>
      <li>Next: <a href="webp_transform.en.html" title="next chapter">Webp Transform Plugin</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Apache Traffic Server</span>
    v: 10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl id="lang-list">
      <dt>Languages</dt>
    </dl>
    <dl id="version-list">
      <dt>Versions</dt>
    </dl>
  </div>
</div>
<script>
$(function() {
  function update_langlist (json) {
    for (var lang in json) {
      $('#lang-list').append('<dd><a href="/' + lang + '/latest/">' + json[lang]['name'] + '</a></dd>');
    }
    for (var i in json[curlang]['versions']) {
      var ver = json[curlang]['versions'][i];
      $('#version-list').append('<dd><a href="/' + curlang + '/' + ver + '/">' + ver + '</a></dd>');
    }
  }
  var curlang = "None" == "None" ? "en" : "None";
  $.ajax({
    'url':      "/en/latest/_static/languages.json",
    'dataType': "json",
    'success':  function (json) { update_langlist(json) },
    'error':    function (xhr,errstr,e) {
      $.ajax({
        'url':      "/_static/languages.json",
        'dataType': "json",
        'success':  function (json) { update_langlist(json) }
      })
    }
  });
});
</script>

    <div class="footer">
      &copy;2021, dev@trafficserver.apache.org.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/admin-guide/plugins/traffic_dump.en.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    

  </body>
</html>